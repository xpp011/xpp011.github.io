<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon2.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon1.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"xpp011.cn","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":true,"color":"#836FFF","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":3,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Spring Boot可以帮助您创建可以运行的独立的，基于生产级的基于Spring的应用程序。我们对Spring平台和第三方库持固执己见的观点，这样您就可以以最小的麻烦开始使用。大多数Spring Boot应用程序只需要很少的Spring配置。">
<meta property="og:type" content="article">
<meta property="og:title" content="SpringBoot学习笔记">
<meta property="og:url" content="http://xpp011.cn/2021/11/06/SpringBoot%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="鸟窝">
<meta property="og:description" content="Spring Boot可以帮助您创建可以运行的独立的，基于生产级的基于Spring的应用程序。我们对Spring平台和第三方库持固执己见的观点，这样您就可以以最小的麻烦开始使用。大多数Spring Boot应用程序只需要很少的Spring配置。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200908144747433.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNDU4NTU1,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="http://xpp011.cn/.cn//Users/25001/AppData/Roaming/Typora/typora-user-images/image-20210505155450366.png">
<meta property="og:image" content="http://xpp011.cn/.cn//Users/25001/AppData/Roaming/Typora/typora-user-images/image-20210505155629256.png">
<meta property="og:image" content="http://xpp011.cn/.cn//win10桌面存放/Spring/笔记/SpringBoot.assets/SpringBoot自动装配.png">
<meta property="og:image" content="https://img-blog.csdn.net/20180630145817580?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0RvbmdndWFiYWk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210506183334831.png">
<meta property="og:image" content="https://pic3.zhimg.com/80/v2-ec490d9baecef2b0ff77af59598c8c12_720w.jpg">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210508172959315.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210508180355140.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210508180602998.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210508180852864.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210508180929186.png">
<meta property="og:image" content="https://pic3.zhimg.com/80/v2-f8bedc8a5eb6ff8b39aeddcf640f9fc6_720w.jpg">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210509152304246.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210509153147629.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210509153318859.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210509161046706.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210509164007672.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210509164117188.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210509164403500.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210511214220487.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210511214459312.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210511215019247.png">
<meta property="og:image" content="http://xpp011.cn/.cn//win10桌面存放/Spring/笔记/SpringBoot.assets/image-20210511221841918.png">
<meta property="og:image" content="http://xpp011.cn/.cn//win10桌面存放/Spring/笔记/SpringBoot.assets/image-20210511222020656.png">
<meta property="og:image" content="http://xpp011.cn/.cn//win10桌面存放/Spring/笔记/SpringBoot.assets/image-20210511222314623.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210511222520036.png">
<meta property="og:image" content="http://xpp011.cn/.cn//win10桌面存放/Spring/笔记/SpringBoot.assets/image-20210513002452883.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210513004439044.png">
<meta property="og:image" content="http://xpp011.cn/.cn//win10桌面存放/Spring/笔记/SpringBoot.assets/image-20210517112512280.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210517114952248.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20200213164518610.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210518142941023.png">
<meta property="og:image" content="http://xpp011.cn/.cn//win10桌面存放/Spring/笔记/SpringBoot.assets/image-20210518143051435.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210518161448878.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210518161540577.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210518163947193.png">
<meta property="og:image" content="http://xpp011.cn/.cn//win10桌面存放/Spring/笔记/SpringBoot.assets/image-20210518184646205.png">
<meta property="og:image" content="https://atts.w3cschool.cn/attachments/image/wk/shiro/1.png">
<meta property="og:image" content="https://atts.w3cschool.cn/attachments/image/wk/shiro/2.png">
<meta property="og:image" content="https://atts.w3cschool.cn/attachments/image/wk/shiro/3.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210519221703245.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210520143510203.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210522161627705.png">
<meta property="og:image" content="https://dubbo.apache.org/imgs/user/dubbo-architecture.jpg">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210522214910199.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210522215827776.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5Cimage-20210522220052435.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210522221032294.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210522221316160.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210522221433991.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210522222006051.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210522222331445.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210522222545148.png">
<meta property="og:image" content="https://upload-images.jianshu.io/upload_images/9487719-d9eb2035e204d817.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/717/format/webp">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210530131140246.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210530131253860.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210531135600115.png">
<meta property="og:image" content="http://www.javaboy.org/images/redis/p285.png">
<meta property="og:image" content="http://www.javaboy.org/images/redis/p286.png">
<meta property="og:image" content="http://www.javaboy.org/images/redis/p287.png">
<meta property="og:image" content="http://www.javaboy.org/images/redis/p288.png">
<meta property="og:image" content="http://www.javaboy.org/images/redis/p289.png">
<meta property="og:image" content="http://www.javaboy.org/images/redis/p290.png">
<meta property="og:image" content="http://www.javaboy.org/images/redis/p291.png">
<meta property="og:image" content="http://www.javaboy.org/images/redis/p292.png">
<meta property="og:image" content="http://www.javaboy.org/images/redis/p293.png">
<meta property="og:image" content="http://www.javaboy.org/images/redis/p294.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210608143105417.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210608143204943.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210608143650149.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210608143522343.png">
<meta property="og:image" content="https://mmbiz.qpic.cn/mmbiz_png/GvtDGKK4uYkpibiahNwFHSibibEXSgsIC66z1FRY3ib9y4egeVGJr6MmC4VXdQWb4lsicrpKHxqcNNUbJjszIBQNjgNw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1">
<meta property="og:image" content="https://mmbiz.qpic.cn/mmbiz_png/GvtDGKK4uYkpibiahNwFHSibibEXSgsIC66zd9ibwfNAHRttia7PNjUSUlSdSPd9ggLLeeV89kVQX91uuqdQGSicOX5GQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1">
<meta property="og:image" content="http://xpp011.cn/.cn//win10桌面存放/Spring/笔记/SpringBoot.assets/image-20210608145652056.png">
<meta property="og:image" content="http://xpp011.cn/.cn//win10桌面存放/Spring/笔记/SpringBoot.assets/image-20210608151109024.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210608151244337.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210608154457549.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210608154553630.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210608154624680.png">
<meta property="og:image" content="http://xpp011.cn/.cn//win10桌面存放/Spring/笔记/SpringBoot.assets/image-20210608154338339.png">
<meta property="og:image" content="http://www.javaboy.org/images/boot/14-8.png">
<meta property="og:image" content="http://www.javaboy.org/images/boot/14-9.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5C20190903141227300.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210611225137212.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210612110138478.png">
<meta property="og:image" content="http://xpp011.cn/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210610182151951.png">
<meta property="article:published_time" content="2021-11-06T07:45:49.000Z">
<meta property="article:modified_time" content="2021-11-06T08:46:37.882Z">
<meta property="article:author" content="xpp011">
<meta property="article:tag" content="笔记">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img-blog.csdnimg.cn/20200908144747433.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNDU4NTU1,size_16,color_FFFFFF,t_70#pic_center">

<link rel="canonical" href="http://xpp011.cn/2021/11/06/SpringBoot%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>SpringBoot学习笔记 | 鸟窝</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">鸟窝</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">一</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/xpp011" class="github-corner" title="叽叽叽叽" aria-label="叽叽叽叽" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://xpp011.cn/2021/11/06/SpringBoot%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/tx.png">
      <meta itemprop="name" content="xpp011">
      <meta itemprop="description" content="欢迎来到我的博客，希望你能在这里找到有用的东西">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鸟窝">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          SpringBoot学习笔记
        </h1>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-11-06 15:45:49 / 修改时间：16:46:37" itemprop="dateCreated datePublished" datetime="2021-11-06T15:45:49+08:00">2021-11-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring/" itemprop="url" rel="index"><span itemprop="name">Spring</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring/%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">笔记</span></a>
                </span>
            </span>

          
          
          <br>
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2021/11/06/SpringBoot%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/11/06/SpringBoot%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>94k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1:26</span>
            </span>
            <div class="post-description">Spring Boot可以帮助您创建可以运行的独立的，基于生产级的基于Spring的应用程序。我们对Spring平台和第三方库持固执己见的观点，这样您就可以以最小的麻烦开始使用。大多数Spring Boot应用程序只需要很少的Spring配置。</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1>SpringBoot</h1>
<h2 id="1，什么是Springboot">1，什么是Springboot</h2>
<p>Spring Boot可以帮助您创建可以运行的独立的，基于生产级的基于Spring的应用程序。我们对Spring平台和第三方库持固执己见的观点，这样您就可以以最小的麻烦开始使用。大多数Spring Boot应用程序只需要很少的Spring配置。</p>
<p>您可以使用Spring Boot创建Java应用程序，可以通过使用<code>java -jar</code>或更传统的战争部署来启动Java应用程序。我们还提供了运行“ spring脚本”的命令行工具。</p>
<p>我们的主要目标是：</p>
<ul>
<li>为所有Spring开发提供根本上更快且可广泛访问的入门体验。</li>
<li>开箱即用，但由于需求开始与默认值有所出入，因此请尽快避开。</li>
<li>提供一系列大型项目通用的非功能性功能（例如嵌入式服务器，安全性，指标，运行状况检查和外部化配置）。</li>
<li>完全没有代码生成，也不需要XML配置。</li>
</ul>
<h2 id="2，什么是微服务">2，什么是微服务</h2>
<p>原文是 Martin Flower 于 2014 年 3 月 25 日写的<a target="_blank" rel="noopener" href="https://martinfowler.com/articles/microservices.html">《Microservices》</a>。</p>
<p>文章链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43458555/article/details/108468384">https://blog.csdn.net/qq_43458555/article/details/108468384</a></p>
<h3 id="微服务">微服务</h3>
<p>“微服务架构（Microservice Architecture）”一词在过去几年里广泛的传播，它用于描述一种设计应用程序的特别方式，作为一套独立可部署的服务。目前，这种架构方式还没有准确的定义，但是在围绕业务能力的组织、自动部署（automated deployment）、端智能（intelligence in the endpoints）、语言和数据的分散控制，却有着某种共同的特征。</p>
<p>“微服务（Microservices）”——只不过在满大街充斥的软件架构中的一新名词而已。尽管我们非常鄙视这样的东西，但是这玩意所描述的软件风格，越来越引起我们的注意。在过去几年里，我们发现越来越多的项目开始使用这种风格，以至于我们身边的同事在构建企业级应用时，把它理所当然的认为这是一种默认开发形式。然而，很不幸，微服务风格是什么，应该怎么开发，关于这样的理论描述却很难找到。</p>
<p>简而言之，微服务架构风格，就像是把一个单独的应用程序开发为一套小服务，每个小服务运行在自己的进程中，并使用轻量级机制通信，通常是 HTTP API。这些服务围绕业务能力来构建，并通过完全自动化部署机制来独立部署。这些服务使用不同的编程语言书写，以及不同数据存储技术，并保持最低限度的集中式管理。</p>
<p>在开始介绍微服务风格（microservice style）前，比较一下整体风格（monolithic style）是很有帮助的：一个完整应用程序（monolithic application）构建成一个单独的单元。企业级应用通常被构建成三个主要部分：客户端用户界面（由运行在客户机器上的浏览器的 HTML 页面、Javascript 组成）、数据库（由许多的表构成一个通用的、相互关联的数据管理系统）、服务端应用。服务端应用处理 HTTP 请求，执行领域逻辑（domain logic），检索并更新数据库中的数据，使用适当的 HTML 视图发送给浏览器。服务端应用是完整的 ，是一个单独的的逻辑执行。任何对系统的改变都涉及到重新构建和部署一个新版本的服务端应用程序。</p>
<p>这样的整体服务（monolithic server）是一种构建系统很自然的方式。虽然你可以利用开发语基础特性把应用程序划分成类、函数、命名空间，但所有你处理请求的逻辑都运行在一个单独的进程中。在某些场景中，开发者可以在的笔计本上开发、测试应用，然后利用部署通道来保证经过正常测试的变更，发布到产品中。你也可以使用横向扩展，通过负载均衡将多个应用部署到多台服务器上。</p>
<p>整体应用程序（Monolithic applications）相当成功，但是越来越多的人感觉到有点不妥，特别是在云中部署时。变更发布周期被绑定了——只是变更应用程序的一小部分，却要求整个重新构建和部署。随着时间的推移，很难再保持一个好的模块化结构，使得一个模块的变更很难不影响到其它模块。扩展就需要整个应用程序的扩展，而不能进行部分扩展。<img src="https://img-blog.csdnimg.cn/20200908144747433.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQzNDU4NTU1,size_16,color_FFFFFF,t_70#pic_center" alt="描述"></p>
<p>这导致了微服务架构风格（microservice architectural style）的出现：把应用程序构建为一套服务。事实是，服务可以独立部署和扩展，每个服务提供了一个坚实的模块边界，甚至不同的服务可以用不同的编程语言编写。它们可以被不同的团队管理。</p>
<p>我们必须说，微服务风格不是什么新东西，它至少可以追溯到 Unix 的设计原则。但是并没有太多人考虑微服务架构，如果他们用了，那么很多软件都会更好。</p>
<h3 id="微服务风格的特性">微服务风格的特性</h3>
<p>微服务风格并没有一个正式的定义，但我们可以尝试描述一下微服务风格所具有的共同特点。并不是所有的微服务风格都要具有所有的特性，但我们期望常见的微服务都应该有这些特性。我们的意图是尝试描述我们工作中或者在其它我们了解的组件中所理解的微服务。特别是，我们不依赖于那些已经明确过的定义。</p>
<p>组件化（Componentization ）与服务（Services）<br>
自从我们开始软件行业以来，一直希望由组件构建系统，就像我们在物理世界所看到的一样。在过去的几十年里，我们已经看到了公共库的大量简编取得了相当的进步，这些库是大部分语言平台的一部分。</p>
<p>当我们谈论组件时，可能会陷入一个困境——什么是组件。我们的定义是，组件（component）是一个可独立替换和升级的软件单元。</p>
<p>微服务架构（Microservice architectures）会使用库（libraries），但组件化软件的主要方式是把它拆分成服务。我们把库（libraries）定义为组件，这些组件被链接到程序，并通过内存中函数调用（in-memory function calls）来调用，而服务（services ）是进程外组件（out-of-process components），他们利用某个机制通信，比如 WebService 请求，或远程过程调用（remote procedure call）。组件和服务在很多面向对象编程中是不同的概念。</p>
<p>把服务当成组件（而不是组件库）的一个主要原因是，服务可以独立部署。如果你的应用程序是由一个单独进程中的很多库组成，那么对任何一个组件的改变都将导致必须重新部署整个应用程序。但是如果你把应用程序拆分成很多服务，那你只需要重新部署那个改变的服务。当然，这也不是绝对的，有些服务会改变导致协调的服务接口，但是一个好的微服务架构的目标就是通过在服务契约（service contracts）中解耦服务的边界和进化机制来避免这些。</p>
<p>另一个考虑是，把服务当组件将拥有更清晰的组件接口。大多数开发语言都没有一个良好的机制来定义一个发布的接口（Published Interface）。发布的接口是指一个类向外公开的成员，比如 Java 中的声明为 Public 的成员，C# 中声明为非 Internal 的成员。通常只有在文档和规范中会说明，这是为了让避免客户端破坏组件的封装性，阻止组件间紧耦合。服务通过使用公开远程调用机制可以很容易避免这些。</p>
<p>像这样使用服务也有不足之处。远程调用比进制内调用更消耗资源，因此远程 API 需要粗粒度（coarser-grained），但这会比较难使用。如果你需要调整组件间的职责分配，当跨越进程边界时，这样做将会很难。</p>
<p>一个可能是，我们看到，服务可以映射到运行时进程（runtime processes）上，但也只是一个可能。服务可以由多个进程组成，它们会同时开发和部署，例如一个应用程序进程和一个只能由这个服务使用的数据库。</p>
<h2 id="3，创建一个SpringBoot项目">3，创建一个SpringBoot项目</h2>
<p>方式一（不推荐）</p>
<ul>
<li>可以通过官方的SpringBoot项目生成器https://start.spring.io/生成项目，然后使用IDEA导入zip包<img src="/.cn//Users\25001\AppData\Roaming\Typora\typora-user-images\image-20210505155450366.png" alt="image-20210505155450366" style="zoom: 33%;"></li>
</ul>
<p>方式二：</p>
<ul>
<li>IDEA内部已经集成了https://start.spring.io/网站，可以在IDEA中直接创建。<img src="/.cn//Users\25001\AppData\Roaming\Typora\typora-user-images\image-20210505155629256.png" alt="image-20210505155629256" style="zoom:33%;"></li>
</ul>
<h2 id="4，SpringBoot自动装配原理">4，SpringBoot自动装配原理</h2>
<h3 id="核心依赖">核心依赖</h3>
<p>如果我们想要查看SpringBoot的核心依赖，需要找到pom.xml文件，在pom.xml配置文件中寻找maven的父工程，顶级工程<code>spring-boot-dependencies</code>内部定义了足足两千多行的依赖</p>
<p>所以在我们创建SpringBoot时不需要指定个个详细的依赖，因为在顶级父工程中制定了版本</p>
<p>各个版本的SpringBoot所指定的依赖版本不同，不过都可以在官方文档中查看，2.4.5的SpringBoot可以在网址：<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/appendix-dependency-versions.html#dependency-versions-coordinates%E4%B8%AD%E6%9F%A5%E7%9C%8B">https://docs.spring.io/spring-boot/docs/current/reference/html/appendix-dependency-versions.html#dependency-versions-coordinates中查看</a></p>
<h3 id="启动器">启动器</h3>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>启动器：也就是SpringBoot的启动场景</li>
<li>SpringBoot将启动器封装起来，内部包含了该启动器的所有依赖</li>
<li>如果我们想要添加别的启动场景，我们就可以直接添加启动器即可，SprintBoot会自动帮我们导入所需场景的依赖</li>
<li>需要什么功能，直接导入启动器（spring-boot-starter-XXX）即可。</li>
</ul>
<h3 id="自动装配">自动装配</h3>
<p><strong>帮助文档</strong></p>
<p>CSDN：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_38526573/article/details/107084943">https://blog.csdn.net/qq_38526573/article/details/107084943</a></p>
<p>知乎：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/123343325%EF%BC%8Chttps://zhuanlan.zhihu.com/p/95217578%EF%BC%88%E8%BF%99%E4%B8%AA%E6%8C%BA%E5%A5%BD%EF%BC%89">https://zhuanlan.zhihu.com/p/123343325，https://zhuanlan.zhihu.com/p/95217578（这个挺好）</a></p>
<p>博客园：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/hhcode520/p/9450933.html%EF%BC%88%E4%B8%8D%E9%94%99%EF%BC%89">https://www.cnblogs.com/hhcode520/p/9450933.html（不错）</a></p>
<p><strong>SpringBoot完美的诠释了什么叫JavaConfig配置Spring</strong></p>
<p><strong>注解</strong></p>
<p>@SpringBootApplication——（标注该类是一个SpringBoot的应用）</p>
<ul>
<li>@SpringBootConfiguration——(SpringBoot的配置)
<ul>
<li>@Configuration——(Spring的JavaConfig的配置类)
<ul>
<li>@Component——（组件）</li>
</ul>
</li>
</ul>
</li>
<li>@ComponentScan——(帮助我们去寻找指定包下的@Component等等标签注册到IOC容器当中)</li>
<li><font color="red">@EnableAutoConfiguration</font>——（重点：启动自动JavaConfig配置类）
<ul>
<li>@AutoConfigurationPackage——(自动扫描@SpringBootApplication注解包下所有组件并注册)
<ul>
<li>@Import(AutoConfigurationPackages.Registrar.class)</li>
</ul>
</li>
<li>@Import(AutoConfigurationImportSelector.class)</li>
</ul>
</li>
</ul>
<p><strong>关键配置类</strong></p>
<ul>
<li>
<p>AutoConfigurationPackages</p>
</li>
<li>
<p>AutoConfigurationImportSelector</p>
</li>
<li>
<p>Registrar</p>
</li>
</ul>
<p><strong>关键方法</strong></p>
<ul>
<li>
<p>Registrar——determineImports</p>
<ul>
<li>
<p><code>Registrar</code> 类里一共有两个方法，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Registrar</span> <span class="keyword">implements</span> <span class="title">ImportBeanDefinitionRegistrar</span>, <span class="title">DeterminableImports</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerBeanDefinitions</span><span class="params">(AnnotationMetadata metadata, BeanDefinitionRegistry registry)</span> </span>&#123;</span><br><span class="line">        register(registry, <span class="keyword">new</span> PackageImports(metadata).getPackageNames().toArray(<span class="keyword">new</span> String[<span class="number">0</span>]));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;Object&gt; <span class="title">determineImports</span><span class="params">(AnnotationMetadata metadata)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Collections.singleton(<span class="keyword">new</span> PackageImports(metadata));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>分别是 <code>determineImports</code> 和 <code>registerBeanDefinitions</code> 。</p>
<p><code>determineImports</code> 方法在我的项目的启动过程中并没有触发断点，官方的文档描述这个方法返回的是一组代表要导入项的对象。</p>
<p><code>registerBeanDefinitions</code> 方法触发断点后发现</p>
<p><code>new AutoConfigurationPackages.PackageImport(metadata)).getPackageName()</code> 方法返回的就是 <code>@SpringBootApplication</code> 注解所在的类的包名。</p>
<p><strong>所以 <code>@AutoConfigurationPackage</code> 注解的作用应该是扫描与 <code>@SpringBootApplication</code> 标注的类同一包下的所有组件。</strong></p>
</li>
</ul>
</li>
<li>
<p>AutoConfigurationImportSelector——selectImports</p>
<ul>
<li>
<p><code>getAutoConfigurationEntry</code> 获取自动配置条目。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String[] selectImports(AnnotationMetadata annotationMetadata) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!isEnabled(annotationMetadata)) &#123;</span><br><span class="line">        <span class="keyword">return</span> NO_IMPORTS;</span><br><span class="line">    &#125;</span><br><span class="line">    AutoConfigurationEntry autoConfigurationEntry = getAutoConfigurationEntry(annotationMetadata);</span><br><span class="line">    <span class="keyword">return</span> StringUtils.toStringArray(autoConfigurationEntry.getConfigurations());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后我们再进入到这个叫做 <code>getCandidateConfigurations</code> 的方法中，这个方法名告诉我们这个方法的作用是获取候选配置。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//getCandidateConfigurations 的定义</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> List&lt;String&gt; <span class="title">getCandidateConfigurations</span><span class="params">(AnnotationMetadata metadata, AnnotationAttributes attributes)</span> </span>&#123;</span><br><span class="line">    List&lt;String&gt; configurations = SpringFactoriesLoader.loadFactoryNames(<span class="keyword">this</span>.getSpringFactoriesLoaderFactoryClass(), <span class="keyword">this</span>.getBeanClassLoader());</span><br><span class="line">    Assert.notEmpty(configurations, <span class="string">&quot;No auto configuration classes found in META-INF/spring.factories. If you are using a custom packaging, make sure that file is correct.&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> configurations;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从这个方法中的 <code>Assert.notEmpty()</code> 中我们可以反推得出，Spring Boot 除了扫描自己 jar 包中 <code>META-INF/spring.factories</code> 之外，还会去找别的 jar 包中是否存在 <code>META-INF/spring.factories</code> 。这也为第三方开发自己的 <code>spring-boot-starter</code> 提供了便利。</p>
</li>
</ul>
</li>
</ul>
<img src="/.cn//win10桌面存放\Spring\笔记\SpringBoot.assets\SpringBoot自动装配.png" alt="SpringBoot自动装配" style="zoom:200%;">
<p>图片链接地址：<a target="_blank" rel="noopener" href="http://assets.processon.com/chart_image/6093bca41e0853762874bea6.png">http://assets.processon.com/chart_image/6093bca41e0853762874bea6.png</a></p>
<p><img src="https://img-blog.csdn.net/20180630145817580?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0RvbmdndWFiYWk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="img"></p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210506183334831.png" alt="image-20210506183334831"></p>
<h3 id="总结"><strong>总结</strong></h3>
<p><strong>当我们的SpringBoot项目启动的时候，会先导入AutoConfigurationImportSelector，这个类会帮我们选择所有候选的配置，我们需要导入的配置都是SpringBoot帮我们写好的一个一个的配置类，那么这些配置类的位置，存在与META-INF/spring.factories文件中，通过这个文件，Spring可以找到这些配置类的位置，于是去加载其中的配置。</strong></p>
<p><strong><img src="https://pic3.zhimg.com/80/v2-ec490d9baecef2b0ff77af59598c8c12_720w.jpg" alt="img" style="zoom: 50%;"></strong></p>
<p>SpringBoot所有的自动配置会在启动时去扫描并加载，<code>META-INF/spring.factories</code>文件装载了所有的自动配置类（JavaConfig类），但是并不是所有的自动配置类都会生效，装配，只有项目有对应的启动器时（也就是加入了对应的依赖如：web依赖），对应的自动装配类才会生效，具体实现是：<strong>@ConditionalOnXXX</strong>注解</p>
<ol>
<li>SpringBoot在启动时，会在类的路径下<code>META-INF/spring.factories</code>文件获取指定的值</li>
<li>通过值将指定的自动配置类导入至IOC容器，那么自动配置就会生效，帮助我们进行配置</li>
<li>整个JavaEE，解救方案和自动配置的东西都在spring-boot-autoconfigure-2.4.5.jar下</li>
<li>它会把所有需要导入的组件，以类名的方式返回，这些组件就会被添加到容器中</li>
<li>spring.factories文件存在非常多的XXXAutoConfiguration的文件（@Bean），这些类就是自动装配类，存在这个场景需要的所有组件，并自动装配(JavaConfig配置类)</li>
</ol>
<h2 id="5，多环境多配置">5，多环境多配置</h2>
<p><strong>优先级</strong></p>
<p>#application.properties 优先级从高到低，application.yml文件优先级也一样<br>
#级别高的会覆盖级别低的，级别高没有的，级别低有的配置项会同样生效</p>
<p>1、-- 项目根目录config文件夹里面（优先级最高）<br>
./config/</p>
<p>2、–项目根目录<br>
./</p>
<p>3、-- src/main/resources/config/文件夹里面<br>
classpath:/config</p>
<p>4、-- src/main/resources/<br>
classpath:/</p>
<p>1-4优先级从高到低，优先级高的配置内容会覆盖优先级低的配置内容<br>
server.port=8081</p>
<p><strong>如何选择配置文件</strong></p>
<p>在不同的环境下需要选择不同的配置文件（生产环境，测试环境）</p>
<p>那么我们应该如何选择配置文件呢</p>
<p>我们只需要在application.yaml加入</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br></pre></td></tr></table></figure>
<p>其中dev是其他配置文件的后缀名(后缀名可以看作配置文件的别名)</p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210508172959315.png" alt="image-20210508172959315"></p>
<h2 id="6，SpringBoot自动装配再理解">6，SpringBoot自动装配再理解</h2>
<p>为什么我们SpringBoot的配置文件application.yaml可以修改SpringBoot原有配置呢</p>
<p>如：可以修改端口</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8082</span></span><br></pre></td></tr></table></figure>
<p><strong>原理</strong></p>
<p>背后的原理其实就是yaml去给我们的JavaConfig类属性赋值</p>
<p>以字符编码配置类举例</p>
<p><code>org.springframework.boot.autoconfigure.web.servlet.HttpEncodingAutoConfiguration,\</code></p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210508180355140.png" alt="image-20210508180355140"></p>
<p>通过注解<code>@EnableConfigurationProperties(ServerProperties.class)</code></p>
<p>去指定我们的JavaConfig配置类，也就是ServerProperties类</p>
<p>我们点开这个类来看一看</p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210508180602998.png" alt="image-20210508180602998"></p>
<p>我们可以看到一个非常熟悉的注解<code>@ConfigurationProperties</code></p>
<p>该注解的功能就是去yaml配置文件中去寻找server的属性并通过server以下的属性给该类的属性赋值</p>
<p><strong>举例</strong></p>
<p>如：现在我们想给prot属性赋值</p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210508180852864.png" alt="image-20210508180852864"></p>
<p>那么我需要再yaml配置文件中去写即可</p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210508180929186.png" alt="image-20210508180929186"></p>
<h2 id="7，-Conditional注解">7，@Conditional注解</h2>
<p>@Conditional是Spring4新提供的注解，它的作用是按照一定的条件进行判断，满足条件给容器注册bean。</p>
<p><img src="https://pic3.zhimg.com/80/v2-f8bedc8a5eb6ff8b39aeddcf640f9fc6_720w.jpg" alt="img"></p>
<h2 id="8，WEB开发">8，WEB开发</h2>
<h3 id="处理静态资源">处理静态资源</h3>
<p>在JavaConfig配置类<code>WebMvcAutoConfiguration.java</code>类的<code>addResourceHandlers</code>添加资源处理器方法中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.addResourceHandlers(registry);</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.resourceProperties.isAddMappings()) &#123;</span><br><span class="line">        logger.debug(<span class="string">&quot;Default resource handling disabled&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ServletContext servletContext = getServletContext();</span><br><span class="line">    addResourceHandler(registry, <span class="string">&quot;/webjars/**&quot;</span>, <span class="string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>);</span><br><span class="line">    addResourceHandler(registry, <span class="keyword">this</span>.mvcProperties.getStaticPathPattern(), (registration) -&gt; &#123;</span><br><span class="line">        registration.addResourceLocations(<span class="keyword">this</span>.resourceProperties.getStaticLocations());</span><br><span class="line">        <span class="keyword">if</span> (servletContext != <span class="keyword">null</span>) &#123;</span><br><span class="line">            registration.addResourceLocations(<span class="keyword">new</span> ServletContextResource(servletContext, SERVLET_LOCATION));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第一步判断我们是否自定义配置了类静态资源路径<code> if (!this.resourceProperties.isAddMappings())</code></p>
<p>如果配置了则直接返回</p>
<p>然后它将静态资源路径<code>/META-INF/resources/webjars/</code>缩减成了路径<code>/webjars/**</code></p>
<p>也就是将静态资源请求地址从原先的<code>localhost:8080/META-INF/resources/webjars/**</code>变成了</p>
<p><code>localhost:8080/webjars/**</code></p>
<p>哪会有什么静态资源会放在<code>/META-INF/resources/webjars/</code>下呢</p>
<p>以jquery举例（这里我们使用webjars导入jquery，而不是之前的直接导入js文件）</p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210509152304246.png" alt="image-20210509152304246"></p>
<p>现在我们去寻找jquery.js不需要写全路径，而是写<code>http://localhost:8080/webjars/jquery/3.6.0/jquery.js</code></p>
<p>因为/webjars已经代替了/META-INF/resources/webjars/</p>
<p><strong>这是jar的静态资源</strong></p>
<p>那我们项目当中的静态资源应该放在那里呢</p>
<p>在<code>Resources</code>类中就可以看到我们的静态资源可以放在那了<img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210509153147629.png" alt="image-20210509153147629"></p>
<p>所以我们的静态资源可以放在&quot;classpath:/resources/&quot;, “classpath:/static/”, &quot;classpath:/public/&quot;目录</p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210509153318859.png" alt="image-20210509153318859"></p>
<p><strong>优先级</strong></p>
<p>resources=&gt;static=&gt;public</p>
<h2 id="9，模板引擎">9，模板引擎</h2>
<p>Thymeleaf模板引擎是SpringBoot推荐的模板引擎</p>
<p>（一）Thymeleaf 是个什么？</p>
<pre><code> 简单说， Thymeleaf 是一个跟 Velocity、FreeMarker 类似的模板引擎，它可以完全替代 JSP 。相较与其他的模板引擎，它有如下三个极吸引人的特点：

1.Thymeleaf 在有网络和无网络的环境下皆可运行，即它可以让美工在浏览器查看页面的静态效果，也可以让程序员在服务器查看带数据的动态页面效果。这是由于它支持 html 原型，然后在 html 标签里增加额外的属性来达到模板+数据的展示方式。浏览器解释 html 时会忽略未定义的标签属性，所以 thymeleaf 的模板可以静态地运行；当有数据返回到页面时，Thymeleaf 标签会动态地替换掉静态内容，使页面动态显示。

2.Thymeleaf 开箱即用的特性。它提供标准和spring标准两种方言，可以直接套用模板实现JSTL、 OGNL表达式效果，避免每天套模板、该jstl、改标签的困扰。同时开发人员也可以扩展和创建自定义的方言。

3. Thymeleaf 提供spring标准方言和一个与 SpringMVC 完美集成的可选模块，可以快速的实现表单绑定、属性编辑器、国际化等功能。
</code></pre>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210509161046706.png" alt="image-20210509161046706"></p>
<h3 id="使用Thymeleaf"><strong>使用Thymeleaf</strong></h3>
<h4 id="前提"><strong>前提</strong></h4>
<p>官方文档：<a target="_blank" rel="noopener" href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html">https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html</a></p>
<p>在SpringBoot项目的pom文件中导入Thymeleaf</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在我们创建的所有html文件中加入约束/命名空间</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="使用"><strong>使用</strong></h4>
<p>使用和jsp相似</p>
<p>通过model携带数据</p>
<p>返回字符串，经过视图解析器解析</p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210509164007672.png" alt="image-20210509164007672"></p>
<p>指定页面，通过Thymeleaf语法接收数据</p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210509164117188.png" alt="image-20210509164117188"></p>
<h4 id="查看配置类">查看配置类</h4>
<p>我们可以看一下Thymeleaf的JavaConfig配置类<code>ThymeleafProperties</code></p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210509164403500.png" alt="image-20210509164403500"></p>
<p><font color="red">可以看到Thymeleaf会去扫描资源包下的templates路径，然后拼接.html后缀</font></p>
<p>所以我们的所有页面必须放在templates路径下，同时页面以html后缀结尾</p>
<p>这里可以深刻体会到<font color="red">约定大于配置</font></p>
<h4 id="语法">语法</h4>
<ul>
<li>简单表达式：
<ul>
<li>变量表达式： <code>$&#123;...&#125;</code></li>
<li>选择变量表达式： <code>*&#123;...&#125;</code></li>
<li>消息表达： <code>#&#123;...&#125;</code></li>
<li>链接URL表达式： <code>@&#123;...&#125;</code></li>
<li>片段表达式： <code>~&#123;...&#125;</code></li>
</ul>
</li>
<li>文字
<ul>
<li>文本文字：<code>'one text'</code>，<code>'Another one!'</code>，…</li>
<li>数字文字：<code>0</code>，<code>34</code>，<code>3.0</code>，<code>12.3</code>，…</li>
<li>布尔文字：<code>true</code>，<code>false</code></li>
<li>空文字： <code>null</code></li>
<li>文字标记：<code>one</code>，<code>sometext</code>，<code>main</code>，…</li>
</ul>
</li>
<li>文字操作：
<ul>
<li>字符串串联： <code>+</code></li>
<li>文字替换： <code>|The name is $&#123;name&#125;|</code></li>
</ul>
</li>
<li>算术运算：
<ul>
<li>二元运算符：<code>+</code>，<code>-</code>，<code>*</code>，<code>/</code>，<code>%</code></li>
<li>减号（一元运算符）： <code>-</code></li>
</ul>
</li>
<li>布尔运算：
<ul>
<li>二元运算符：<code>and</code>，<code>or</code></li>
<li>布尔否定（一元运算符）： <code>!</code>，<code>not</code></li>
</ul>
</li>
<li>比较和平等：
<ul>
<li>比较：<code>&gt;</code>，<code>&lt;</code>，<code>&gt;=</code>，<code>&lt;=</code>（<code>gt</code>，<code>lt</code>，<code>ge</code>，<code>le</code>）</li>
<li>等号运算符：<code>==</code>，<code>!=</code>（<code>eq</code>，<code>ne</code>）</li>
</ul>
</li>
<li>条件运算符：
<ul>
<li>如果-则： <code>(if) ? (then)</code></li>
<li>如果-则-否则： <code>(if) ? (then) : (else)</code></li>
<li>默认： <code>(value) ?: (defaultvalue)</code></li>
</ul>
</li>
</ul>
<h2 id="10，扩展SpringMVC配置">10，扩展SpringMVC配置</h2>
<p>在SpringBoot自定义设置我们的SpringMVC</p>
<p>文档地址：<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-spring-mvc">https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-spring-mvc</a></p>
<p>我们可以先看自动配置视图解析</p>
<p>如果我们要自定义视图解析器的话，可以先看官方默认的视图解析器<code>ContentNegotiatingViewResolver</code>是怎么写的</p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210511214220487.png" alt="image-20210511214220487"></p>
<p>官方的视图解析器实现了<code>ViewResolver</code>接口</p>
<p><code>ContentNegotiatingViewResolver</code>实现了<code>ViewResolver</code>接口的<code>resolveViewName</code>方法</p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210511214459312.png" alt="image-20210511214459312"></p>
<p><code>getCandidateViews</code> 得到候选视图</p>
<p><code>getBestView</code> 得到最好视图</p>
<p><strong>自定义视图解析器</strong></p>
<p>那么我们自定义的视图解析器需要实现<code>ViewResolver</code>接口并且实现了<code>ViewResolver</code>接口的<code>resolveViewName</code>方法</p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210511215019247.png" alt="image-20210511215019247"></p>
<p>最后将自定义的视图解析器注册到IOC容器当中</p>
<h3 id="关于注解-EnableWebMvc">关于注解@EnableWebMvc</h3>
<p>在官方文档我们可以看到这样一句话</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">If you want to keep those Spring Boot MVC customizations and make more [MVC customizations](interceptors, formatters, view controllers, and other features), you can add your own `@Configuration` class of type `WebMvcConfigurer` but **without** `@EnableWebMvc`</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">如果要保留这些Spring Boot MVC定制并进行更多的MVC定制（拦截器，格式化程序，视图控制器和其他功能），则可以添加自己@Configuration的注解，同时实现WebMvcConfigurer接口，但不添加 @EnableWebMvc注解。</span><br></pre></td></tr></table></figure>
<p>为什么我们扩展配置类的时候不能添加 @EnableWebMvc注解呢</p>
<p>官方是这样解释的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">If you want to take complete control of Spring MVC, you can add your own @Configuration annotated with @EnableWebMvc, or alternatively add your own @Configuration-annotated DelegatingWebMvcConfiguration as described in the Javadoc of @EnableWebMvc.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">如果你想利用Spring MVC中的完全控制，你可以添加自己配置类添加@Configuration注解和@EnableWebMvc，或者添加自己的@Configuration-annotatedDelegatingWebMvcConfiguration中的Javadoc中所述@EnableWebMvc。</span><br></pre></td></tr></table></figure>
<p>所以一旦我们加上@EnableWebMvc注解我们的配置类就会完全接管MVC配置，<font color="red">官方的自动配置类就会失效</font></p>
<p>那SpringBoot是怎么实现的呢，看看源码！</p>
<p><strong>源码分析</strong></p>
<p>1，先看看注解@EnableWebMvc</p>
<img src="/.cn//win10桌面存放\Spring\笔记\SpringBoot.assets\image-20210511221841918.png" alt="image-20210511221841918" style="zoom:50%;">
<p>该注解导入了一个<code>DelegatingWebMvcConfiguration</code>类</p>
<p>看看<code>DelegatingWebMvcConfiguration</code>类</p>
<img src="/.cn//win10桌面存放\Spring\笔记\SpringBoot.assets\image-20210511222020656.png" alt="image-20210511222020656" style="zoom:50%;">
<p><code>DelegatingWebMvcConfiguration</code>类继承了<code>WebMvcConfigurationSupport</code>类</p>
<p>好的，注解@EnableWebMvc先到这里，不过要记住<code>WebMvcConfigurationSupport</code>类</p>
<p>2，再来看看SpringBoot官方的Web配置类<code>WebMvcAutoConfiguration</code>类</p>
<img src="/.cn//win10桌面存放\Spring\笔记\SpringBoot.assets\image-20210511222314623.png" alt="image-20210511222314623" style="zoom:50%;">
<p>在最上方我们看到了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)</span></span><br></pre></td></tr></table></figure>
<p>之前我们一再强调@ConditionalXXX系列注解的重要性</p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210511222520036.png" alt="image-20210511222520036"></p>
<p><strong>现在我们就知道了原理</strong></p>
<p>只有容器中不存在<code>WebMvcConfigurationSupport</code>类那么<code>WebMvcAutoConfiguration</code>类才会生效，</p>
<p>那么再看@EnableWebMvc注解，它内部继承了<code>WebMvcConfigurationSupport</code>类</p>
<p>也就是现在IOC容器内存在了<code>WebMvcConfigurationSupport</code>类，</p>
<p>所以官方的Web配置类<code>WebMvcAutoConfiguration</code>类不会生效</p>
<h2 id="11，练习">11，练习</h2>
<h3 id="1，国际化">1，国际化</h3>
<p>我们先定义一个页面的语言包内部包含中英文</p>
<img src="/.cn//win10桌面存放\Spring\笔记\SpringBoot.assets\image-20210513002452883.png" alt="image-20210513002452883" style="zoom:50%;">
<p>然后再SpringBoot配置文件中配置语言包</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#指定消息国际化的资源包</span></span><br><span class="line"><span class="meta">spring.messages.basename</span>=<span class="string">i18n/login</span></span><br></pre></td></tr></table></figure>
<p>然后我们自定义配置文件的话我们可以参考官方的国际化包<code>AcceptHeaderLocaleResolver</code>类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyLocaleResolver</span> <span class="keyword">implements</span> <span class="title">LocaleResolver</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Locale <span class="title">resolveLocale</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取标志位</span></span><br><span class="line">        String l = request.getParameter(<span class="string">&quot;l&quot;</span>);</span><br><span class="line">        <span class="comment">//获取默认配置</span></span><br><span class="line">        Locale locale = Locale.getDefault();</span><br><span class="line">        <span class="comment">//判断标志是否不合法</span></span><br><span class="line">        <span class="keyword">if</span> (l!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="comment">//得到国家和语言</span></span><br><span class="line">            String[] s = l.split(<span class="string">&quot;_&quot;</span>);</span><br><span class="line">            locale =<span class="keyword">new</span> Locale(s[<span class="number">0</span>],s[<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> locale;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLocale</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Locale locale)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后将我们自己配置的类装配到扩展配置类中</p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210513004439044.png" alt="image-20210513004439044"></p>
<p>@Bean</p>
<p>注意方法名必须是<code>localeResolver</code></p>
<h3 id="2，拦截器">2，拦截器</h3>
<p>实现连接器接口<code>HandlerInterceptor</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Interceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        HttpSession session = request.getSession();</span><br><span class="line">        String user = (String) session.getAttribute(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (user==<span class="keyword">null</span>)&#123;</span><br><span class="line">            response.sendRedirect(<span class="string">&quot;/index.html&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将自己的拦截器添加到自己的扩展配置类中</p>
<p>扩展配置类重写<code>addInterceptors</code>方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//拦截器</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">    registry.addInterceptor(<span class="keyword">new</span> Interceptor()).addPathPatterns(<span class="string">&quot;/**&quot;</span>).excludePathPatterns(<span class="string">&quot;/user/login&quot;</span>,<span class="string">&quot;/index.html&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>new一个自己的拦截器，拦截&quot;/**“的所有请求，排除”/user/login&quot;,&quot;/index.html&quot;请求</p>
<h2 id="12，数据库的连接与配置">12，数据库的连接与配置</h2>
<h3 id="1，JDBC">1，JDBC</h3>
<p><strong>1,1</strong>  创建SpringBoot项目时勾选JDBC和Mysql数据库的支持</p>
<img src="/.cn//win10桌面存放\Spring\笔记\SpringBoot.assets\image-20210517112512280.png" alt="image-20210517112512280" style="zoom:50%;">
<p><strong>1,2</strong>  在yaml配置文件中配置数据库的用户名，密码，连接地址，Driver</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/mybatis?serverTimezone=UTC&amp;characterEncoding=utf8&amp;useSSl=true</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br></pre></td></tr></table></figure>
<p><strong>1,3</strong>  如何使用</p>
<p>在SpringBoot中使用JDBC不需要再像之前的JavaEE阶段从获取连接 <code>connection</code>，预编译sql语句<code>PreparedStatement</code> ，结果集<code>ResultSet</code>等等</p>
<p>而是使用SpringBoot集成的模板XXXTemplate</p>
<p>JDBC的模板是jdbcTemplate，使用它可以直接执行sql语句，传入值集合，也可以预编译</p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210517114952248.png" alt="image-20210517114952248"></p>
<h3 id="2，集成Druid">2，集成Druid</h3>
<p>文档：<a target="_blank" rel="noopener" href="https://github.com/alibaba/druid/wiki/Druid%E8%BF%9E%E6%8E%A5%E6%B1%A0%E4%BB%8B%E7%BB%8D">https://github.com/alibaba/druid/wiki/Druid连接池介绍</a></p>
<h4 id="Druid-简介">Druid 简介</h4>
<p>更新时间： 2020-01-18</p>
<p>Apache Druid 是一个分布式内存实时分析系统，用于解决如何在大规模数据集下进行快速的、交互式的查询和分析的问题。Apache Druid 由 Metamarkets 公司（一家为在线媒体或广告公司提供数据分析服务的公司）开发，在2019年春季被捐献给 Apache 软件基金会。</p>
<h4 id="基本特点">基本特点</h4>
<p>Apache Druid 具有以下特点：</p>
<ul>
<li>亚秒级 OLAP 查询，包括多维过滤、Ad-hoc 的属性分组、快速聚合数据等等。</li>
<li>实时的数据消费，真正做到数据摄入实时、查询结果实时。</li>
<li>高效的多租户能力，最高可以做到几千用户同时在线查询。</li>
<li>扩展性强，支持 PB 级数据、千亿级事件快速处理，支持每秒数千查询并发。</li>
<li>极高的高可用保障，支持滚动升级。</li>
</ul>
<h4 id="应用场景">应用场景</h4>
<p>实时数据分析是 Apache Druid 最典型的使用场景。该场景涵盖的面很广，例如：</p>
<ul>
<li>实时指标监控</li>
<li>推荐模型</li>
<li>广告平台</li>
<li>搜索模型</li>
</ul>
<p>这些场景的特点都是拥有大量的数据，且对数据查询的时延要求非常高。在实时指标监控中，系统问题需要在出现的一刻被检测到并被及时给出报警。在推荐模型中，用户行为数据需要实时采集，并及时反馈到推荐系统中。用户几次点击之后系统就能够识别其搜索意图，并在之后的搜索中推荐更合理的结果。</p>
<h4 id="使用Druid">使用Druid</h4>
<p>1，首先在SpringBoot项目中导入Druid的starter，如果我们Druid配置了log4j的日志打，还需要加入log4j的依赖</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;dependency&gt;</span></span><br><span class="line">    <span class="attr">&lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span></span><br><span class="line">    <span class="attr">&lt;artifactId&gt;druid-spring-boot-starter&lt;/artifactId&gt;</span></span><br><span class="line">    <span class="attr">&lt;version&gt;1.1.10&lt;/version&gt;</span></span><br><span class="line"><span class="attr">&lt;/dependency&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!--</span> <span class="string">https://mvnrepository.com/artifact/log4j/log4j --&gt;</span></span><br><span class="line"><span class="attr">&lt;dependency&gt;</span></span><br><span class="line">    <span class="attr">&lt;groupId&gt;log4j&lt;/groupId&gt;</span></span><br><span class="line">    <span class="attr">&lt;artifactId&gt;log4j&lt;/artifactId&gt;</span></span><br><span class="line">    <span class="attr">&lt;version&gt;1.2.17&lt;/version&gt;</span></span><br><span class="line"><span class="attr">&lt;/dependency&gt;</span></span><br></pre></td></tr></table></figure>
<p>2，通过yaml配置Druid</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">druidDataSource</span></span><br><span class="line">    <span class="comment">#指定使用Druid的数据源</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="attr">druid:</span></span><br><span class="line">      <span class="comment">#注意版本</span></span><br><span class="line">      <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/mybatis?serverTimezone=UTC&amp;characterEncoding=utf8&amp;useSSl=true</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">      <span class="comment">#注意此处密码为纯数字需要引用</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">#-配置监控统计拦截器</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">#配置中,stat监控统计,wall防御sql注入,log4日志记录</span></span><br><span class="line">      <span class="comment">#如果报错检查是否导入log4j</span></span><br><span class="line">      <span class="attr">filters:</span> <span class="string">stat,wall,log4j</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="comment">#-连接池设置</span></span><br><span class="line">      <span class="comment">#最大连接池数量 maxIdle已经不再使用</span></span><br><span class="line">      <span class="attr">max-active:</span> <span class="number">100</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">#初始化时建立物理连接的个数</span></span><br><span class="line">      <span class="attr">initial-size:</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">#获取连接时最大等待时间，单位毫秒</span></span><br><span class="line">      <span class="attr">max-wait:</span> <span class="number">60000</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">#最小连接池数量</span></span><br><span class="line">      <span class="attr">min-idle:</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">#既作为检测的间隔时间又作为testWhileIdel执行的依据</span></span><br><span class="line">      <span class="attr">time-between-eviction-runs-millis:</span> <span class="number">60000</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">#销毁线程时检测当前连接的最后活动时间和当前时间差大于该值时，关闭当前连接</span></span><br><span class="line">      <span class="attr">min-evictable-idle-time-millis:</span> <span class="number">300000</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">#用来检测连接是否有效的sql 必须是一个查询语句</span></span><br><span class="line">      <span class="comment">#mysql中为 select &#x27;x&#x27;</span></span><br><span class="line">      <span class="comment">#oracle中为 select 1 from dual</span></span><br><span class="line">      <span class="attr">validation-query:</span> <span class="string">select</span> <span class="string">&#x27;x&#x27;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">#申请连接的时候检测，如果空闲时间大于timeBetweenEvictionRunsMillis，执行validationQuery检测连接是否有效</span></span><br><span class="line">      <span class="attr">test-while-idle:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">#申请连接时会执行validationQuery检测连接是否有效,开启会降低性能,默认为true</span></span><br><span class="line">      <span class="attr">test-on-borrow:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">#归还连接时会执行validationQuery检测连接是否有效,开启会降低性能,默认为true</span></span><br><span class="line">      <span class="attr">test-on-return:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">#是否缓存preparedStatement,mysql5.5+建议开启</span></span><br><span class="line">      <span class="attr">pool-prepared-statements:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">#当值大于0时poolPreparedStatements会自动修改为true</span></span><br><span class="line">      <span class="attr">max-pool-prepared-statement-per-connection-size:</span> <span class="number">20</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">#合并多个DruidDataSource的监控数据</span></span><br><span class="line">      <span class="attr">use-global-data-source-stat:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">#设置访问druid监控页的账号和密码,默认没有</span></span><br><span class="line">      <span class="attr">stat-view-servlet:</span></span><br><span class="line">        <span class="attr">login-username:</span> <span class="string">admin</span></span><br><span class="line">        <span class="attr">login-password:</span> <span class="string">admin</span></span><br></pre></td></tr></table></figure>
<p>3，如果报了图片的错误</p>
<p><img src="https://img-blog.csdnimg.cn/20200213164518610.png" alt="在这里插入图片描述"></p>
<p>则需要在资源包下添加名为：<code>log4j.properties</code>  log4j的properties配置文件</p>
<p>并将以下内容复制进去</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">log4j.rootLogger</span>=<span class="string">DEBUG, stdout</span></span><br><span class="line"><span class="meta">log4j.appender.stdout</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout.ConversionPattern</span>=<span class="string">%5p [%t] - %m%n</span></span><br></pre></td></tr></table></figure>
<h3 id="3，整合Mybatis框架">3，整合Mybatis框架</h3>
<p>Mybatis框架可以和Druid共存，只需要分别配置即可</p>
<p><strong>导入依赖</strong></p>
<p>这是Maven的mybatis自己写的依赖，所以命名是spring-boot-starter在后面，官方是以spring-boot-starter开头的</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--mybatis SpringBoot的依赖--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.mybatis.spring.boot/mybatis-spring-boot-starter --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>配置Mybatis</strong></p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210518142941023.png" alt="image-20210518142941023"></p>
<p><strong>编写Mapper接口</strong></p>
<img src="/.cn//win10桌面存放\Spring\笔记\SpringBoot.assets\image-20210518143051435.png" alt="image-20210518143051435" style="zoom:50%;">
<p>值得注意的是我们需要在接口上加上@Repository注解将其交给IOC容器管理</p>
<h4 id="Mapper注解的的作用">@Mapper注解的的作用</h4>
<p>1:为了把mapper这个DAO交給Spring管理 <a target="_blank" rel="noopener" href="http://412887952-qq-com.iteye.com/blog/2392672">http://412887952-qq-com.iteye.com/blog/2392672</a></p>
<p>2:为了不再写mapper映射文件 <a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_39666581/article/details/103899495">https://blog.csdn.net/weixin_39666581/article/details/103899495</a></p>
<p>3:为了给mapper接口 自动根据一个添加@Mapper注解的接口生成一个实现类 <a target="_blank" rel="noopener" href="http://www.tianshouzhi.com/api/tutorials/mapstruct/292">http://www.tianshouzhi.com/api/tutorials/mapstruct/292</a></p>
<p>但是在一个dao层接口写上@Mapper明显比较繁琐，那么在工程较大时，可以在<font color="red">SpringBoot的主启动类加上@MapperScan() 注解</font>，只要在注解内部写上dao层接口的路径，就会自动扫描并注册</p>
<p>可参考：<a target="_blank" rel="noopener" href="https://www.iteye.com/blog/412887952-qq-com-2392672">https://www.iteye.com/blog/412887952-qq-com-2392672</a></p>
<h2 id="13，SpringSecurity">13，SpringSecurity</h2>
<p>Spring Security 是 Spring 家族中的一个安全管理框架，实际上，在 Spring Boot 出现之前，Spring Security 就已经发展了多年了，但是使用的并不多，安全管理这个领域，一直是 Shiro 的天下。</p>
<p>相对于 Shiro，在 SSM/SSH 中整合 Spring Security 都是比较麻烦的操作，所以，Spring Security 虽然功能比 Shiro 强大，但是使用反而没有 Shiro 多（Shiro 虽然功能没有 Spring Security 多，但是对于大部分项目而言，Shiro 也够用了）。</p>
<p>自从有了 Spring Boot 之后，Spring Boot 对于 Spring Security 提供了 自动化配置方案，可以零配置使用 Spring Security。</p>
<p>因此，一般来说，常见的安全管理技术栈的组合是这样的：</p>
<ul>
<li>SSM + Shiro</li>
<li>Spring Boot/Spring Cloud + Spring Security</li>
</ul>
<p><strong>注意，这只是一个推荐的组合而已，如果单纯从技术上来说，无论怎么组合，都是可以运行的。</strong></p>
<p>**帮助文档：**<a target="_blank" rel="noopener" href="https://www.cnblogs.com/lenve/p/11242055.html">https://www.cnblogs.com/lenve/p/11242055.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/felordcn/p/12142549.html">https://www.cnblogs.com/felordcn/p/12142549.html</a></p>
<p><strong>使用SpringSecurity</strong></p>
<p>在pom配置文件中导入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-security --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>当我们添加依赖后，Security会直接生效</p>
<p>访问请求时，会要求我们登录</p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210518161448878.png" alt="image-20210518161448878"></p>
<p>默认的用户名是user ，而密码会在每一次启动项目时生成</p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210518161540577.png" alt="image-20210518161540577"></p>
<p><strong>配置文件指定用户名和密码</strong></p>
<p>我们也可以自定义密码和用户名，这样就不会每一次靠Security生成</p>
<p>在yaml配置文件中指定用户名和密码</p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210518163947193.png" alt="image-20210518163947193"></p>
<p><strong>Java配置文件指定用户名和密码</strong></p>
<p>首先我们创建一个JavaConfig的配置类，将配置类继承<code>WebSecurityConfigurerAdapter</code>类</p>
<p>并且在配置类上方加上@EnableWebSecurity注解，开启web安全</p>
<p>@EnableWebSecurity注解内部有一个@Configuration注解了，所以不需要在加了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//配置请求的权限 过滤器</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        http.authorizeRequests()</span><br><span class="line">                <span class="comment">//&quot;/&quot;,&quot;/toLogin&quot; 的请求所有人都可以通过</span></span><br><span class="line">                .antMatchers(<span class="string">&quot;/&quot;</span>,<span class="string">&quot;/toLogin&quot;</span>).permitAll()</span><br><span class="line">                <span class="comment">///views/1/** 请求 必须有权限1</span></span><br><span class="line">                .antMatchers(<span class="string">&quot;/views/1/**&quot;</span>).hasRole(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">                .antMatchers(<span class="string">&quot;/views/2/**&quot;</span>).hasRole(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">                .antMatchers(<span class="string">&quot;/views/3/**&quot;</span>).hasRole(<span class="string">&quot;3&quot;</span>);</span><br><span class="line">        http.formLogin();<span class="comment">//.loginPage(&quot;/toLogin&quot;).loginProcessingUrl(&quot;/logon&quot;);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//认证用户</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//从内存中读取用户</span></span><br><span class="line">        <span class="comment">//passwordEncoder(new BCryptPasswordEncoder()) 设置密码加密格式为BCryptPasswordEncoder</span></span><br><span class="line">        auth.inMemoryAuthentication().passwordEncoder(<span class="keyword">new</span> BCryptPasswordEncoder())</span><br><span class="line">                <span class="comment">//添加一个用户 密码通过new BCryptPasswordEncoder().encode(&quot;123&quot;)加密   roles 拥有的权限</span></span><br><span class="line">                .withUser(<span class="string">&quot;admin&quot;</span>).password(<span class="keyword">new</span> BCryptPasswordEncoder().encode(<span class="string">&quot;123&quot;</span>)).roles(<span class="string">&quot;1&quot;</span>,<span class="string">&quot;2&quot;</span>,<span class="string">&quot;3&quot;</span>)</span><br><span class="line">                <span class="comment">//如果想在添加一个用户只需在and方法后面添加</span></span><br><span class="line">                .and().withUser(<span class="string">&quot;xpp011&quot;</span>).password(<span class="keyword">new</span> BCryptPasswordEncoder().encode(<span class="string">&quot;123&quot;</span>)).roles(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><font color="red">从数据库得到用户认证，参考文档</font>：<a target="_blank" rel="noopener" href="https://blog.csdn.net/BLU_111/article/details/110727891">https://blog.csdn.net/BLU_111/article/details/110727891</a></p>
<p>注意<code>WebSecurityConfigurerAdapter</code>类有很多的configure重载方法，它们分别是</p>
<p><strong>2.1 认证管理器配置方法</strong></p>
<p><code>void configure(AuthenticationManagerBuilder auth)</code> 用来配置认证管理器<code>AuthenticationManager</code>。说白了就是所有 <code>UserDetails</code> 相关的它都管，包含 <code>PasswordEncoder</code> 密码机。如果你不清楚可以通过 <a target="_blank" rel="noopener" href="https://www.felord.cn/spring-security-userdetails.html">Spring Security 中的 UserDetail</a> 进行了解。本文对 <code>AuthenticationManager</code> 不做具体分析讲解，后面会有专门的文章来讲这个东西 。 可通过 <a target="_blank" rel="noopener" href="https://www.felord.cn/categories/spring-security/">Spring Security 实战系列</a> 进行学习。</p>
<p><strong>2.2 核心过滤器配置方法</strong></p>
<p><code>void configure(WebSecurity web)</code> 用来配置 <code>WebSecurity</code> 。而 <code>WebSecurity</code> 是基于 <code>Servlet Filter</code> 用来配置 <code>springSecurityFilterChain</code> 。而 <code>springSecurityFilterChain</code> 又被委托给了 <strong>Spring Security 核心过滤器 Bean</strong> <code>DelegatingFilterProxy</code> 。 相关逻辑你可以在 <code>WebSecurityConfiguration</code> 中找到。我们一般不会过多来自定义 <code>WebSecurity</code> , 使用较多的使其<code>ignoring()</code> 方法用来忽略 <strong>Spring Security</strong> 对静态资源的控制。</p>
<p><strong>2.3 安全过滤器链配置方法</strong></p>
<p><code>void configure(HttpSecurity http)</code> 这个是我们使用最多的，用来配置 <code>HttpSecurity</code> 。 <code>HttpSecurity</code> 用于构建一个安全过滤器链 <code>SecurityFilterChain</code> 。<code>SecurityFilterChain</code> 最终被注入<strong>核心过滤器</strong> 。 <code>HttpSecurity</code> 有许多我们需要的配置。我们可以通过它来进行自定义安全访问策略。所以我们单独开一章来讲解这个东西。</p>
<h3 id="13-1，SpringSecurity和thymeleaf整合">13.1，SpringSecurity和thymeleaf整合</h3>
<p>文档:<a target="_blank" rel="noopener" href="https://github.com/thymeleaf/thymeleaf-extras-springsecurity">https://github.com/thymeleaf/thymeleaf-extras-springsecurity</a></p>
<p><a target="_blank" rel="noopener" href="https://www.thymeleaf.org/doc/articles/springsecurity.html">https://www.thymeleaf.org/doc/articles/springsecurity.html</a></p>
<p>导入maven依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--thymeleaf和springsecurity5的整合包--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.thymeleaf.extras/thymeleaf-extras-springsecurity5 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.thymeleaf.extras<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>thymeleaf-extras-springsecurity5<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.4.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在html文件导入正确的约束<code>xmlns:sec=&quot;http://www.thymeleaf.org/extras/spring-security&quot;</code>是<font color="red">官方推荐的命名空间</font></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:sec</span>=<span class="string">&quot;http://www.thymeleaf.org/extras/spring-security&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>用来判断是否登录验证</p>
<img src="/.cn//win10桌面存放\Spring\笔记\SpringBoot.assets\image-20210518184646205.png" alt="image-20210518184646205" style="zoom:67%;">
<p><strong>登录页定制和记住我</strong></p>
<p><strong>定制首页</strong>只需在<code>configure(HttpSecurity http)</code>方法中加入</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http.formLogin().loginPage(<span class="string">&quot;/toLogin&quot;</span>)<span class="comment">//用户为登录时，访问的所以请求都会转跳到这个页面，即登录页面</span></span><br><span class="line">        .loginProcessingUrl(<span class="string">&quot;/login&quot;</span>)<span class="comment">//处理登录的请求地址，即登录表单的action的值</span></span><br><span class="line">        .usernameParameter(<span class="string">&quot;username&quot;</span>)<span class="comment">//登录表单用户名的name，默认username</span></span><br><span class="line">        .passwordParameter(<span class="string">&quot;password&quot;</span>)<span class="comment">//登录表单密码的name，默认password</span></span><br><span class="line">        .defaultSuccessUrl(<span class="string">&quot;/&quot;</span>);<span class="comment">//登录成功后会转跳的页面 首页</span></span><br></pre></td></tr></table></figure>
<p><strong>登录退出</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http.logout()</span><br><span class="line">        .logoutUrl(<span class="string">&quot;/logout&quot;</span>)<span class="comment">//注销表单中请求的地址路径</span></span><br><span class="line">        .logoutSuccessUrl(<span class="string">&quot;/&quot;</span>);<span class="comment">//注销成功后转跳的地址</span></span><br></pre></td></tr></table></figure>
<p>注意在<strong>登录请求</strong><code>/toLogin,/login</code>和<strong>登录退出请求</strong><code>/logout</code><font color="red">均为post请求</font>，a标签的href为get，所以<font color="red">不要使用a标签请求</font>，不然会导致404的情况</p>
<p><strong>记住我</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http.rememberMe()<span class="comment">//记住我</span></span><br><span class="line">        .rememberMeParameter(<span class="string">&quot;remember&quot;</span>)<span class="comment">//登录表单中选择记住我单选框的名字name属性</span></span><br><span class="line">        .tokenValiditySeconds(<span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span>*<span class="number">7</span>);<span class="comment">//设置cookie过期时间</span></span><br></pre></td></tr></table></figure>
<p><strong>关于数据库保存cookie的token值</strong></p>
<p>参考：<a target="_blank" rel="noopener" href="https://www.jb51.net/article/175334.htm">https://www.jb51.net/article/175334.htm</a></p>
<p><font color="red">建议以后项目实现一下，有意义</font></p>
<h2 id="14，Shiro">14，Shiro</h2>
<h3 id="简介"><strong>简介</strong></h3>
<p>Apache Shiro是一个强大且易用的Java安全框架,执行身份验证、授权、密码和会话管理。使用Shiro的易于理解的API,您可以快速、轻松地获得任何应用程序,从最小的移动应用程序到最大的网络和企业应用程序。</p>
<p>**官网：**<a target="_blank" rel="noopener" href="https://shiro.apache.org/index.html">https://shiro.apache.org/index.html</a></p>
<p>**帮助文档：**<a target="_blank" rel="noopener" href="https://www.w3cschool.cn/shiro/co4m1if2.html">https://www.w3cschool.cn/shiro/co4m1if2.html</a>  (值得一看)</p>
<p><img src="https://atts.w3cschool.cn/attachments/image/wk/shiro/1.png" alt="img"></p>
<ul>
<li><strong>Authentication</strong>：身份认证 / 登录，验证用户是不是拥有相应的身份；</li>
<li><strong>Authorization</strong>：授权，即权限验证，验证某个已认证的用户是否拥有某个权限；即判断用户是否能做事情，常见的如：验证某个用户是否拥有某个角色。或者细粒度的验证某个用户对某个资源是否具有某个权限；</li>
<li><strong>Session</strong> <strong>Management</strong>：会话管理，即用户登录后就是一次会话，在没有退出之前，它的所有信息都在会话中；会话可以是普通 JavaSE 环境的，也可以是如 Web 环境的；</li>
<li><strong>Cryptography</strong>：加密，保护数据的安全性，如密码加密存储到数据库，而不是明文存储；</li>
<li><strong>Web Support</strong>：Web 支持，可以非常容易的集成到 Web 环境；</li>
<li><strong>Caching</strong>：缓存，比如用户登录后，其用户信息、拥有的角色 / 权限不必每次去查，这样可以提高效率；</li>
<li><strong>Concurrency</strong>：shiro 支持多线程应用的并发验证，即如在一个线程中开启另一个线程，能把权限自动传播过去；</li>
<li><strong>Testing</strong>：提供测试支持；</li>
<li><strong>Run As</strong>：允许一个用户假装为另一个用户（如果他们允许）的身份进行访问；</li>
<li><strong>Remember Me</strong>：记住我，这个是非常常见的功能，即一次登录后，下次再来的话不用登录了。</li>
</ul>
<p><strong>记住一点，Shiro 不会去维护用户、维护权限；这些需要我们自己去设计 / 提供；然后通过相应的接口注入给 Shiro 即可。</strong></p>
<p><strong>架构</strong></p>
<p>接下来我们分别从外部和内部来看看 Shiro 的架构，对于一个好的框架，从外部来看应该具有非常简单易于使用的 API，且 API 契约明确；从内部来看的话，其应该有一个可扩展的架构，即非常容易插入用户自定义实现，因为任何框架都不能满足所有需求。</p>
<p>首先，我们从外部来看 Shiro 吧，即从应用程序角度的来观察如何使用 Shiro 完成工作。如下图：</p>
<p><img src="https://atts.w3cschool.cn/attachments/image/wk/shiro/2.png" alt="img"></p>
<p>可以看到：应用代码直接交互的对象是 Subject，也就是说 Shiro 的对外 API 核心就是 Subject；其每个 API 的含义：</p>
<p><strong>Subject</strong>：主体，代表了当前 “用户”，这个用户不一定是一个具体的人，与当前应用交互的任何东西都是 Subject，如网络爬虫，机器人等；即一个抽象概念；所有 Subject 都绑定到 SecurityManager，与 Subject 的所有交互都会委托给 SecurityManager；可以把 Subject 认为是一个门面；SecurityManager 才是实际的执行者；</p>
<p><strong>SecurityManager</strong>：安全管理器；即所有与安全有关的操作都会与 SecurityManager 交互；且它管理着所有 Subject；可以看出它是 Shiro 的核心，它负责与后边介绍的其他组件进行交互，如果学习过 SpringMVC，你可以把它看成 DispatcherServlet 前端控制器；</p>
<p><strong>Realm</strong>：域，Shiro 从从 Realm 获取安全数据（如用户、角色、权限），就是说 SecurityManager 要验证用户身份，那么它需要从 Realm 获取相应的用户进行比较以确定用户身份是否合法；也需要从 Realm 得到用户相应的角色 / 权限进行验证用户是否能进行操作；可以把 Realm 看成 DataSource，即安全数据源。</p>
<p>也就是说对于我们而言，最简单的一个 Shiro 应用：</p>
<ol>
<li>应用代码通过 Subject 来进行认证和授权，而 Subject 又委托给 SecurityManager；</li>
<li>我们需要给 Shiro 的 SecurityManager 注入 Realm，从而让 SecurityManager 能得到合法的用户及其权限进行判断。</li>
</ol>
<p><strong>从以上也可以看出，Shiro 不提供维护用户 / 权限，而是通过 Realm 让开发人员自己注入。</strong></p>
<p>接下来我们来从 Shiro 内部来看下 Shiro 的架构，如下图所示：</p>
<p><img src="https://atts.w3cschool.cn/attachments/image/wk/shiro/3.png" alt="img"></p>
<ul>
<li><strong>Subject</strong>：主体，可以看到主体可以是任何可以与应用交互的 “用户”；</li>
<li><strong>SecurityManager</strong>：相当于 SpringMVC 中的 DispatcherServlet 或者 Struts2 中的 FilterDispatcher；是 Shiro 的心脏；所有具体的交互都通过 SecurityManager 进行控制；它管理着所有 Subject、且负责进行认证和授权、及会话、缓存的管理。</li>
<li><strong>Authenticator</strong>：认证器，负责主体认证的，这是一个扩展点，如果用户觉得 Shiro 默认的不好，可以自定义实现；其需要认证策略（Authentication Strategy），即什么情况下算用户认证通过了；</li>
<li><strong>Authrizer</strong>：授权器，或者访问控制器，用来决定主体是否有权限进行相应的操作；即控制着用户能访问应用中的哪些功能；</li>
<li><strong>Realm</strong>：可以有 1 个或多个 Realm，可以认为是安全实体数据源，即用于获取安全实体的；可以是 JDBC 实现，也可以是 LDAP 实现，或者内存实现等等；由用户提供；注意：Shiro 不知道你的用户 / 权限存储在哪及以何种格式存储；所以我们一般在应用中都需要实现自己的 Realm；</li>
<li><strong>SessionManager</strong>：如果写过 Servlet 就应该知道 Session 的概念，Session 呢需要有人去管理它的生命周期，这个组件就是 SessionManager；而 Shiro 并不仅仅可以用在 Web 环境，也可以用在如普通的 JavaSE 环境、EJB 等环境；所以呢，Shiro 就抽象了一个自己的 Session 来管理主体与应用之间交互的数据；这样的话，比如我们在 Web 环境用，刚开始是一台 Web 服务器；接着又上了台 EJB 服务器；这时想把两台服务器的会话数据放到一个地方，这个时候就可以实现自己的分布式会话（如把数据放到 Memcached 服务器）；</li>
<li><strong>SessionDAO</strong>：DAO 大家都用过，数据访问对象，用于会话的 CRUD，比如我们想把 Session 保存到数据库，那么可以实现自己的 SessionDAO，通过如 JDBC 写到数据库；比如想把 Session 放到 Memcached 中，可以实现自己的 Memcached SessionDAO；另外 SessionDAO 中可以使用 Cache 进行缓存，以提高性能；</li>
<li><strong>CacheManager</strong>：缓存控制器，来管理如用户、角色、权限等的缓存的；因为这些数据基本上很少去改变，放到缓存中后可以提高访问的性能</li>
<li><strong>Cryptography</strong>：密码模块，Shiro 提供了一些常见的加密组件用于如密码加密 / 解密的。</li>
</ul>
<hr>
<h3 id="使用Shiro">使用Shiro</h3>
<p>首先在pom配置文件中导入Shiro依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.shiro/shiro-spring-boot-web-starter --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-spring-boot-web-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><font color="red">自定义Shiro配置类</font> <code>MyShiroConfig</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyShiroConfig</span> </span>&#123;</span><br><span class="line">    <span class="comment">//自定义过滤器</span></span><br><span class="line">    <span class="comment">//将ShiroFilterFactoryBean托管给容器，名字是shiroFilterFactoryBean</span></span><br><span class="line">    <span class="meta">@Bean(&quot;shiroFilterFactoryBean&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ShiroFilterFactoryBean <span class="title">ShiroFilterFactoryBean</span><span class="params">(<span class="meta">@Qualifier(&quot;SecurityManager&quot;)</span> DefaultWebSecurityManager defaultWebSecurityManager)</span></span>&#123;</span><br><span class="line">                ShiroFilterFactoryBean factoryBean=<span class="keyword">new</span> ShiroFilterFactoryBean();</span><br><span class="line">        <span class="comment">//设置安全管理器</span></span><br><span class="line">        factoryBean.setSecurityManager(defaultWebSecurityManager);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//定义setFilterChainDefinitionMap方法需要的参数</span></span><br><span class="line">        Map&lt;String, String&gt; filterMap=<span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        anon: 无需认证就可以访问</span></span><br><span class="line"><span class="comment">        authc:必须通过认证才能访问</span></span><br><span class="line"><span class="comment">        user:必须拥有记住我功能访问</span></span><br><span class="line"><span class="comment">        perms:拥有某个资源访问权限才能访问</span></span><br><span class="line"><span class="comment">        role: 拥有某个角色权限才能访问</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        filterMap.put(<span class="string">&quot;/add&quot;</span>,<span class="string">&quot;perms[user:add]&quot;</span>);</span><br><span class="line">        filterMap.put(<span class="string">&quot;/update&quot;</span>,<span class="string">&quot;perms[user:update]&quot;</span>);</span><br><span class="line">        filterMap.put(<span class="string">&quot;/&quot;</span>,<span class="string">&quot;anon&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//定义视图链 以map的形式</span></span><br><span class="line">        factoryBean.setFilterChainDefinitionMap(filterMap);</span><br><span class="line">        <span class="comment">//登录请求地址</span></span><br><span class="line">        factoryBean.setLoginUrl(<span class="string">&quot;/toLogin&quot;</span>);</span><br><span class="line">        <span class="comment">//设定权限不够的请求路径</span></span><br><span class="line">        factoryBean.setUnauthorizedUrl(<span class="string">&quot;toUnauthorized&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> factoryBean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义安全管理器 DefaultWebSecurityManager依赖于UserRealm</span></span><br><span class="line">    <span class="comment">//将安全管理器托管给Spring容器,名字是SecurityManager</span></span><br><span class="line">    <span class="meta">@Bean(&quot;SecurityManager&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DefaultWebSecurityManager <span class="title">DefaultWebSecurityManager</span><span class="params">(<span class="meta">@Qualifier(&quot;userRealm&quot;)</span> UserRealm userRealm)</span></span>&#123;</span><br><span class="line">        DefaultWebSecurityManager securityManager=<span class="keyword">new</span> DefaultWebSecurityManager();</span><br><span class="line">        <span class="comment">//关联Realm</span></span><br><span class="line">        securityManager.setRealm(userRealm);</span><br><span class="line">        <span class="keyword">return</span> securityManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//自定义的Realm</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserRealm <span class="title">userRealm</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> UserRealm();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置thymeleaf-和-shiro的整合包的方言</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ShiroDialect <span class="title">shiroDialect</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ShiroDialect();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>自定义的类需要三个类 分别是</p>
<ul>
<li>
<p><code>ShiroFilterFactoryBean</code></p>
<ul>
<li>
<p>它是Shiro的过滤器，/Filter工厂，设置对应的过滤条件和跳转条件</p>
</li>
<li>
<pre><code class="language-java">anon: 无需认证就可以访问
authc:必须通过认证才能访问
user:必须拥有记住我功能访问
perms:拥有某个资源访问权限才能访问
role: 拥有某个角色权限才能访问
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- `DefaultWebSecurityManager`</span><br><span class="line"></span><br><span class="line">  - 安全管理器 它负责所具体的交互，比如，身份认证，授权，控制缓存等，都由他调度</span><br><span class="line">  - 依赖于Realm</span><br><span class="line"></span><br><span class="line">- `Realm`</span><br><span class="line"></span><br><span class="line">  - Shiro 从 Realm 获取安全数据（如用户、角色、权限），就是说 SecurityManager 要验证用户身份，那么它需要从 Realm 获取相应的用户进行比较以确定用户身份是否合法；</span><br><span class="line">  - 由于Shiro是不提供用户/授权的，需要我们去自定义Realm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;font color=&#x27;red&#x27;&gt;依赖关系&lt;/font&gt;： `ShiroFilterFactoryBean`==&gt;`DefaultWebSecurityManager`==&gt;自定义`Realm`</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">//ShiroFilterFactoryBean设置安全管理器defaultWebSecurityManager</span><br><span class="line">ShiroFilterFactoryBean factoryBean=new ShiroFilterFactoryBean();</span><br><span class="line">        //设置安全管理器</span><br><span class="line">        factoryBean.setSecurityManager(defaultWebSecurityManager);       </span><br></pre></td></tr></table></figure>

</code></pre>
</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//安全管理器DefaultWebSecurityManager设置自定义Realm userRealm</span></span><br><span class="line">DefaultWebSecurityManager securityManager=<span class="keyword">new</span> DefaultWebSecurityManager();</span><br><span class="line">        <span class="comment">//关联Realm</span></span><br><span class="line">        securityManager.setRealm(userRealm);</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自定义的Realm </span></span><br><span class="line"><span class="meta">@Bean</span> <span class="comment">//将自定义Realm托管给Spring容器</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> UserRealm <span class="title">userRealm</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> UserRealm();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><font color="red">自定义Realm类 </font><code>UserRealm</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserRealm</span> <span class="keyword">extends</span> <span class="title">AuthorizingRealm</span> </span>&#123;</span><br><span class="line">    <span class="comment">//连接数据库</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//授权,查询用户是否有响应权限</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthorizationInfo <span class="title">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principals)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;执行了授权==》&quot;</span>+principals);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//取得方法的返回值 AuthorizationInfo接口的实现类SimpleAuthorizationInfo</span></span><br><span class="line">        SimpleAuthorizationInfo info=<span class="keyword">new</span> SimpleAuthorizationInfo();</span><br><span class="line">        <span class="comment">//获取当前的用户</span></span><br><span class="line">        Subject subject = SecurityUtils.getSubject();</span><br><span class="line">        <span class="comment">//获取当前用户携带的值  这个值是下面doGetAuthenticationInfo方法</span></span><br><span class="line">        <span class="comment">//new SimpleAuthenticationInfo(user,user.getPwd(),&quot;&quot;)的参数user</span></span><br><span class="line">        User currentUser = (User)subject.getPrincipal();</span><br><span class="line">        <span class="comment">//授权用户类内部属性权限值</span></span><br><span class="line">        info.addStringPermission(currentUser.getPerms());</span><br><span class="line">        <span class="keyword">return</span> info;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//身份认证</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> AuthenticationInfo <span class="title">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken token)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;执行了身份认证==》&quot;</span>+token);</span><br><span class="line">        <span class="comment">//先伪造数据 测试</span></span><br><span class="line">        <span class="comment">//String username=&quot;admin&quot;,password=&quot;123&quot;;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//将令牌 token转换为可以得到用户名和密码的类型 UsernamePasswordToken</span></span><br><span class="line">        UsernamePasswordToken token1=(UsernamePasswordToken) token;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//从数据库中获取用户</span></span><br><span class="line">        User user = userMapper.selectUserByName(token1.getUsername());</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        //注意Shiro进行授权时 我们只需要判断用户名即可，密码的匹配交给 SimpleAuthenticationInfo 保证安全</span></span><br><span class="line"><span class="comment">        if (!token1.getUsername().equals(username))&#123;</span></span><br><span class="line"><span class="comment">            //用户名不正确</span></span><br><span class="line"><span class="comment">            //当doGetAuthenticationInfo方法返回null时 会报一个UnknownAccountException异常 也就是用户名不存在</span></span><br><span class="line"><span class="comment">            return null;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//判断用户是否为空</span></span><br><span class="line">        <span class="keyword">if</span> (user==<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;<span class="comment">//用户名不存在</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//密码配对交给AuthenticationInfo接口的实现类SimpleAuthenticationInfo去做</span></span><br><span class="line">        <span class="comment">//将user存到Subject当前用户中</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SimpleAuthenticationInfo(user,user.getPwd(),<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><font color="red">Controller层的登录请求</font></p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210519221703245.png" alt="image-20210519221703245"></p>
<hr>
<h3 id="Shiro记住我">Shiro记住我</h3>
<p>参考博客：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43298012/article/details/87890956?utm_medium=distribute.wap_relevant.none-task-blog-baidujs_baidulandingword-0">https://blog.csdn.net/qq_43298012/article/details/87890956?utm_medium=distribute.wap_relevant.none-task-blog-baidujs_baidulandingword-0</a></p>
<p>​	记住我功能在各各网站是比较常见的，实现起来也都差不多，主要就是利用cookie来实现，而shiro对记住我功能的实现也是比较简单的，只需要几步即可。</p>
<p><strong>Shiro配置记住我步骤：</strong></p>
<p>在MyShiroConfig中添加以下Bean</p>
<p><strong>记住我cookie</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * cookie对象;会话Cookie模板 ,默认为: JSESSIONID 问题: 与SERVLET容器名冲突,重新定义为sid或rememberMe，自定义</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> SimpleCookie <span class="title">rememberMeCookie</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//自定义Cookie</span></span><br><span class="line">    SimpleCookie simpleCookie=<span class="keyword">new</span> SimpleCookie(<span class="string">&quot;rememberMe&quot;</span>);</span><br><span class="line">    <span class="comment">//simpleCookie的httponly属性如果设为true的话，会增加对xss防护的安全系数。它有以下特点：</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//simpleCookie()的第七个参数</span></span><br><span class="line">    <span class="comment">//设为true后，只能通过http访问，javascript无法访问</span></span><br><span class="line">    <span class="comment">//防止xss读取cookie</span></span><br><span class="line">    simpleCookie.setHttpOnly(<span class="keyword">true</span>);</span><br><span class="line">    <span class="comment">//根目录下的所有路径都可以的到该Cookie</span></span><br><span class="line">    simpleCookie.setPath(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">    <span class="comment">//Cookie的有效时间 单位秒</span></span><br><span class="line">    simpleCookie.setMaxAge(<span class="number">60</span>*<span class="number">60</span>*<span class="number">24</span>*<span class="number">3</span>);</span><br><span class="line">    <span class="keyword">return</span> simpleCookie;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>记住我Cookie的安全管理器</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * cookie管理对象;记住我功能,rememberMe管理器</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CookieRememberMeManager <span class="title">rememberMeManager</span><span class="params">()</span></span>&#123;</span><br><span class="line">    CookieRememberMeManager rememberMeManager=<span class="keyword">new</span> CookieRememberMeManager();</span><br><span class="line">    <span class="comment">//设置自定义的Cookie</span></span><br><span class="line">    rememberMeManager.setCookie(rememberMeCookie());</span><br><span class="line">    <span class="comment">//rememberMe cookie加密的密钥 建议每个项目都不一样 默认AES算法 密钥长度(128 256 512 位)</span></span><br><span class="line">    <span class="comment">//官方推荐使用Base64加密</span></span><br><span class="line">    rememberMeManager.setCipherKey(Base64.getDecoder().decode(<span class="string">&quot;4AvVhmFLUs0KTA3Kprsdag==&quot;</span>));</span><br><span class="line">    <span class="keyword">return</span> rememberMeManager;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>记住我的过滤器</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * FormAuthenticationFilter 过滤器 过滤记住我</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> FormAuthenticationFilter <span class="title">formAuthenticationFilter</span><span class="params">()</span></span>&#123;</span><br><span class="line">    FormAuthenticationFilter filter=<span class="keyword">new</span> FormAuthenticationFilter();</span><br><span class="line">    <span class="comment">//对应前端的checkbox的name = rememberMe</span></span><br><span class="line">    filter.setRememberMeParam(<span class="string">&quot;rememberMe&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> filter;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上准备完成后，开始和Shiro整合</p>
<p><strong>在核心安全管理器中配置rememberMe的安全管理器</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean(&quot;SecurityManager&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> DefaultWebSecurityManager <span class="title">DefaultWebSecurityManager</span><span class="params">(<span class="meta">@Qualifier(&quot;userRealm&quot;)</span> UserRealm userRealm)</span></span>&#123;</span><br><span class="line">    DefaultWebSecurityManager securityManager=<span class="keyword">new</span> DefaultWebSecurityManager();</span><br><span class="line">    <span class="comment">//关联Realm</span></span><br><span class="line">    securityManager.setRealm(userRealm);</span><br><span class="line">    <span class="comment">//配置记住我的安全管理器!!!</span></span><br><span class="line">    securityManager.setRememberMeManager(rememberMeManager());</span><br><span class="line">    <span class="keyword">return</span> securityManager;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>**修改shirFilter中拦截请求的规则,将/<strong>从authc 改为user</strong></p>
<p>但是注意前往登录和处理登录的请求就不是user了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自定义过滤器</span></span><br><span class="line"><span class="meta">@Bean(&quot;shiroFilterFactoryBean&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ShiroFilterFactoryBean <span class="title">ShiroFilterFactoryBean</span><span class="params">(<span class="meta">@Qualifier(&quot;SecurityManager&quot;)</span> DefaultWebSecurityManager defaultWebSecurityManager)</span></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">//定义setFilterChainDefinitionMap方法需要的参数</span></span><br><span class="line">    <span class="comment">// 配置访问权限 必须是LinkedHashMap，因为它必须保证有序</span></span><br><span class="line">    <span class="comment">// 过滤链定义，从上向下顺序执行，一般将 /**放在最为下边 --&gt; : 这是一个坑，一不小心代码就不好使了</span></span><br><span class="line">    Map&lt;String, String&gt; filterMap=<span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    anon: 无需认证就可以访问</span></span><br><span class="line"><span class="comment">    authc:必须通过认证才能访问</span></span><br><span class="line"><span class="comment">    user:必须拥有记住我功能访问</span></span><br><span class="line"><span class="comment">    perms:拥有某个资源访问权限才能访问</span></span><br><span class="line"><span class="comment">    role: 拥有某个角色权限才能访问</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    filterMap.put(<span class="string">&quot;/add&quot;</span>,<span class="string">&quot;perms[user:add]&quot;</span>);</span><br><span class="line">    filterMap.put(<span class="string">&quot;/update&quot;</span>,<span class="string">&quot;perms[user:update]&quot;</span>);</span><br><span class="line">    filterMap.put(<span class="string">&quot;/&quot;</span>,<span class="string">&quot;anon&quot;</span>);</span><br><span class="line">    <span class="comment">//设置登录请求为无需认证就可以访问</span></span><br><span class="line">    filterMap.put(<span class="string">&quot;/login&quot;</span>,<span class="string">&quot;anon&quot;</span>);</span><br><span class="line">    <span class="comment">//其他资源都需要认证  authc 表示需要认证才能进行访问 user表示配置记住我或认证通过可以访问的地址</span></span><br><span class="line">    filterMap.put(<span class="string">&quot;/**&quot;</span>,<span class="string">&quot;user&quot;</span>);</span><br><span class="line"></span><br><span class="line">....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>更改HelloController中login方法</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">(String username, String password,<span class="keyword">boolean</span> rememberMe, Model model)</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;用户信息：&quot;</span>+username+<span class="string">&quot;:&quot;</span>+password+<span class="string">&quot;:&quot;</span>+rememberMe);</span><br><span class="line">    <span class="comment">//得到当前的用户</span></span><br><span class="line">    Subject subject = SecurityUtils.getSubject();</span><br><span class="line">    <span class="comment">//将用户名和密码封装成UsernamePasswordToken 形成令牌token 同时将rememberMe加入登录验证</span></span><br><span class="line">    UsernamePasswordToken token=<span class="keyword">new</span> UsernamePasswordToken(username,password,rememberMe);</span><br><span class="line"></span><br><span class="line">   ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>登陆页面加入rememberMe功能</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">th:action</span>=<span class="string">&quot;@&#123;/login&#125;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;msg&#125;&quot;</span> <span class="attr">style</span>=<span class="string">&quot;color: red&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">    用户名: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>/&gt;</span></span><br><span class="line">    密码: <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">name</span>=<span class="string">&quot;rememberMe&quot;</span>&gt;</span>记住我</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;登录&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="Shiro和thymeleaf整合">Shiro和thymeleaf整合</h3>
<p>导入整合包</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--thymeleaf-和-shiro的整合包--&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.github.theborakompanioni/thymeleaf-extras-shiro --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.theborakompanioni<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>thymeleaf-extras-shiro<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>配置thymeleaf的Shiro的方言(可以写在Shiro的配置文件中)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置thymeleaf-和-shiro的整合包的方言</span></span><br><span class="line"><span class="meta">@Bean</span><span class="comment">//注册到Spring容器中</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ShiroDialect <span class="title">shiroDialect</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//ShiroDialect就是方言配置类</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ShiroDialect();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><font color="red">thymeleaf的命名空间</font></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xmlns:shiro=&quot;http://www.pollix.at/thymeleaf/shiro&quot;</span><br></pre></td></tr></table></figure>
<p>可以写的一些标签</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">首页</span><br><span class="line"><span class="comment">&lt;!--判断是否已认证 没认证则为false 认证则相反--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">shiro:notAuthenticated</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/toLogin&#125;&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--判断当前用户是否有user:add的权限--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/add&#125;&quot;</span> <span class="attr">shiro:hasPermission</span>=<span class="string">&quot;user:add&quot;</span>&gt;</span>添加<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">th:href</span>=<span class="string">&quot;@&#123;/update&#125;&quot;</span> <span class="attr">shiro:hasPermission</span>=<span class="string">&quot;user:update&quot;</span>&gt;</span>修改<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>浏览器中rememberMe的值</p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210520143510203.png" alt="image-20210520143510203"></p>
<p>其实是将用户信息加密后放到前台的(包含密码)，在项目中user对象信息过于庞大，不能全部存入Cookie,Cookie对长度有一定的限制。</p>
<h2 id="15，Swagger">15，Swagger</h2>
<p>帮助文档:<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/275708279">https://zhuanlan.zhihu.com/p/275708279</a> (比较高级)</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44203158/article/details/109137799">https://blog.csdn.net/weixin_44203158/article/details/109137799</a> (推荐看这个)</p>
<h4 id="1，介绍">1，介绍</h4>
<p>Swagger 是一套基于 OpenAPI 规范（OpenAPI Specification，OAS）构建的开源工具，后来成为了 Open API 标准的主要定义者。<br>
对于 Rest API 来说很重要的一部分内容就是文档，Swagger 为我们提供了一套通过代码和注解自动生成文档的方法，这一点对于保证API 文档的及时性将有很大的帮助。</p>
<p>swagger2于17年停止维护，现在最新的版本为17年发布的 Swagger3（Open Api3）。</p>
<h4 id="2，springfox介绍">2，<strong>springfox介绍</strong></h4>
<p>SpringFox是 spring 社区维护的一个项目（非官方）<br>
由于Spring的流行，Marty Pitt编写了一个基于Spring的组件swagger-springmvc，用于将swagger集成到springmvc中来，而springfox则是从这个组件发展而来。</p>
<h4 id="3，springfox-swagger-2">3，springfox-swagger 2</h4>
<p>SpringBoot项目整合swagger2需要用到两个依赖：<code>springfox-swagger2</code>和<code>springfox-swagger-ui</code>，用于自动生成swagger文档。</p>
<p>springfox-swagger2：这个组件的功能用于帮助我们自动生成描述API的json文件<br>
springfox-swagger-ui：就是将描述API的json文件解析出来，用一种更友好的方式呈现出来。</p>
<h4 id="4，SpringFox-3-0-0-发布">4，SpringFox 3.0.0 发布</h4>
<ul>
<li>Spring5，Webflux支持（仅支持请求映射，尚不支持功能端点）。</li>
<li>Spring Integration支持。</li>
<li>SpringBoot支持springfox Boot starter依赖性（零配置、自动配置支持）。</li>
<li>支持OpenApi 3.0.3。</li>
<li>零依赖。几乎只需要spring-plugin，swagger-core ，现有的swagger2注释将继续工作并丰富openapi3.0规范。</li>
</ul>
<h4 id="5，使用Swagger3-0">5，使用Swagger3.0</h4>
<p>导入依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>1,  application.yml配置</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">springfox-swagger</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="comment"># ===== 自定义swagger配置 ===== #</span></span><br><span class="line"><span class="attr">swagger:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">application-name:</span> <span class="string">$&#123;spring.application.name&#125;</span></span><br><span class="line">  <span class="attr">application-version:</span> <span class="number">1.0</span></span><br><span class="line">  <span class="attr">application-description:</span> <span class="string">springfox</span> <span class="string">swagger</span> <span class="number">3.0</span><span class="string">整合Demo</span></span><br><span class="line">  <span class="attr">try-host:</span> <span class="string">http://localhost:$&#123;server.port&#125;</span></span><br></pre></td></tr></table></figure>
<p>2,  自定义一个<font color="red">swagger配置类</font><code>SwaggerProperties.class</code></p>
<p>注意注解<code>@ConfigurationProperties</code>的使用</p>
<p>代表被修饰的类可以通过前缀<code>prefix = &quot;XXX&quot;</code>,yaml赋值.</p>
<p>同时注解<code>@ConfigurationProperties</code>需要搭配注解<code>@Component</code>托管给ioc容器</p>
<p>帮助文档:<a target="_blank" rel="noopener" href="https://www.cnblogs.com/jimoer/p/11374229.html">https://www.cnblogs.com/jimoer/p/11374229.html</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.xpp011.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * swagger的属性配置类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;swagger&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwaggerProperties</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否开启swagger，生产环境一般关闭，所以这里定义一个变量</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Boolean enable;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 项目应用名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String applicationName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 项目版本信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String applicationVersion;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 项目描述信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String applicationDescription;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 接口调试地址</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String tryHost;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Boolean <span class="title">getEnable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> enable;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEnable</span><span class="params">(Boolean enable)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.enable = enable;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getApplicationName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> applicationName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setApplicationName</span><span class="params">(String applicationName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.applicationName = applicationName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getApplicationVersion</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> applicationVersion;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setApplicationVersion</span><span class="params">(String applicationVersion)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.applicationVersion = applicationVersion;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getApplicationDescription</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> applicationDescription;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setApplicationDescription</span><span class="params">(String applicationDescription)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.applicationDescription = applicationDescription;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTryHost</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> tryHost;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTryHost</span><span class="params">(String tryHost)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.tryHost = tryHost;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3, springfox swagger3配置类<code>SwaggerConfiguration.class</code></p>
<p>注解<code>@EnableOpenApi</code>大致意思就是**「只有在配置类标注了<code>@EnableOpenApi</code>这个注解才会生成Swagger文档」**。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@EnableOpenApi</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwaggerConfiguration</span>  <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> SwaggerProperties swaggerProperties;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SwaggerConfiguration</span><span class="params">(SwaggerProperties swaggerProperties)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.swaggerProperties = swaggerProperties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Docket <span class="title">createRestApi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.OAS_30).pathMapping(<span class="string">&quot;/&quot;</span>)</span><br><span class="line">                <span class="comment">//组名字</span></span><br><span class="line">                .groupName(<span class="string">&quot;lighter&quot;</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 定义是否开启swagger，false为关闭，可以通过变量控制</span></span><br><span class="line">                .enable(swaggerProperties.getEnable())</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 将api的元信息设置为包含在json ResourceListing响应中。</span></span><br><span class="line">                .apiInfo(apiInfo(<span class="string">&quot;lighter&quot;</span>,<span class="keyword">null</span>,<span class="string">&quot;123456@gmail.com&quot;</span>))</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 接口调试地址</span></span><br><span class="line">                .host(swaggerProperties.getTryHost())</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 选择哪些接口作为swagger的doc发布</span></span><br><span class="line">                .select()</span><br><span class="line">                <span class="comment">//扫描指定包下的@controller注解 any()是所有 none()是不扫描</span></span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;cn.xpp011.controller&quot;</span>))</span><br><span class="line"></span><br><span class="line">                .paths(PathSelectors.any())</span><br><span class="line">                .build()</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 支持的通讯协议集合</span></span><br><span class="line">                .protocols(newHashSet(<span class="string">&quot;https&quot;</span>, <span class="string">&quot;http&quot;</span>))</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 授权信息设置，必要的header token等认证信息</span></span><br><span class="line">                .securitySchemes(securitySchemes())</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 授权信息全局应用</span></span><br><span class="line">                .securityContexts(securityContexts());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * API 页面上半部分展示信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> ApiInfo <span class="title">apiInfo</span><span class="params">(String name,String url,String email)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApiInfoBuilder().title(swaggerProperties.getApplicationName() + <span class="string">&quot; Api Doc&quot;</span>)</span><br><span class="line">                .description(swaggerProperties.getApplicationDescription())</span><br><span class="line">                .contact(<span class="keyword">new</span> Contact(name, url,email ))</span><br><span class="line">                .version(<span class="string">&quot;Application Version: &quot;</span> + swaggerProperties.getApplicationVersion() + <span class="string">&quot;, Spring Boot Version: &quot;</span> + SpringBootVersion.getVersion())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置授权信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;SecurityScheme&gt; <span class="title">securitySchemes</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ApiKey apiKey = <span class="keyword">new</span> ApiKey(<span class="string">&quot;BASE_TOKEN&quot;</span>, <span class="string">&quot;token&quot;</span>, In.HEADER.toValue());</span><br><span class="line">        <span class="keyword">return</span> Collections.singletonList(apiKey);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 授权信息全局应用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> List&lt;SecurityContext&gt; <span class="title">securityContexts</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Collections.singletonList(</span><br><span class="line">                SecurityContext.builder()</span><br><span class="line">                        .securityReferences(Collections.singletonList(<span class="keyword">new</span> SecurityReference(<span class="string">&quot;BASE_TOKEN&quot;</span>, <span class="keyword">new</span> AuthorizationScope[]&#123;<span class="keyword">new</span> AuthorizationScope(<span class="string">&quot;global&quot;</span>, <span class="string">&quot;&quot;</span>)&#125;)))</span><br><span class="line">                        .build()</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SafeVarargs</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> &lt;T&gt; <span class="function">Set&lt;T&gt; <span class="title">newHashSet</span><span class="params">(T... ts)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ts.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> LinkedHashSet&lt;&gt;(Arrays.asList(ts));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通用拦截器排除swagger设置，所有拦截器都会自动加swagger相关的资源排除信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Field registrationsField = FieldUtils.getField(InterceptorRegistry.class, <span class="string">&quot;registrations&quot;</span>, <span class="keyword">true</span>);</span><br><span class="line">            List&lt;InterceptorRegistration&gt; registrations = (List&lt;InterceptorRegistration&gt;) ReflectionUtils.getField(registrationsField, registry);</span><br><span class="line">            <span class="keyword">if</span> (registrations != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (InterceptorRegistration interceptorRegistration : registrations) &#123;</span><br><span class="line">                    interceptorRegistration</span><br><span class="line">                            .excludePathPatterns(<span class="string">&quot;/swagger**/**&quot;</span>)</span><br><span class="line">                            .excludePathPatterns(<span class="string">&quot;/webjars/**&quot;</span>)</span><br><span class="line">                            .excludePathPatterns(<span class="string">&quot;/v3/**&quot;</span>)</span><br><span class="line">                            .excludePathPatterns(<span class="string">&quot;/doc.html&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>配置完成后可访问：<a target="_blank" rel="noopener" href="http://localhost:8080/swagger-ui/index.html">http://localhost:8080/swagger-ui/index.html</a> 查看</p>
<h4 id="6，Swagger分组">6，Swagger分组</h4>
<p>其实在Swagger中分组就是对应着不同的Docket</p>
<p>我们只需要想IOC容器中注册不同的Docket即可</p>
<p>这里组被分成了两个，分别是root，lighter</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Docket <span class="title">rootRestApi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.OAS_30).pathMapping(<span class="string">&quot;/&quot;</span>)</span><br><span class="line">                <span class="comment">//组名字</span></span><br><span class="line">                .groupName(<span class="string">&quot;root&quot;</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 定义是否开启swagger，false为关闭，可以通过变量控制</span></span><br><span class="line">                .enable(swaggerProperties.getEnable())</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 将api的元信息设置为包含在json ResourceListing响应中。得到个人信息</span></span><br><span class="line">                .apiInfo(apiInfo(<span class="string">&quot;root&quot;</span>,<span class="string">&quot;https://xpp011.xn&quot;</span>,<span class="string">&quot;2500176776@qq.com&quot;</span>))</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 接口调试地址</span></span><br><span class="line">                .host(swaggerProperties.getTryHost())</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 选择哪些接口作为swagger的doc发布</span></span><br><span class="line">                .select()</span><br><span class="line">                <span class="comment">//扫描指定包下的@controller注解 any()是所有 none()是不扫描</span></span><br><span class="line">                .apis(RequestHandlerSelectors.any())</span><br><span class="line"></span><br><span class="line">                .paths(PathSelectors.any())</span><br><span class="line">                .build()</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 支持的通讯协议集合</span></span><br><span class="line">                .protocols(newHashSet(<span class="string">&quot;https&quot;</span>, <span class="string">&quot;http&quot;</span>))</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 授权信息设置，必要的header token等认证信息</span></span><br><span class="line">                .securitySchemes(securitySchemes())</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 授权信息全局应用</span></span><br><span class="line">                .securityContexts(securityContexts());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Docket <span class="title">createRestApi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.OAS_30).pathMapping(<span class="string">&quot;/&quot;</span>)</span><br><span class="line">                <span class="comment">//组名字</span></span><br><span class="line">                .groupName(<span class="string">&quot;lighter&quot;</span>)</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 定义是否开启swagger，false为关闭，可以通过变量控制</span></span><br><span class="line">                .enable(swaggerProperties.getEnable())</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 将api的元信息设置为包含在json ResourceListing响应中。</span></span><br><span class="line">                .apiInfo(apiInfo(<span class="string">&quot;lighter&quot;</span>,<span class="keyword">null</span>,<span class="string">&quot;123456@gmail.com&quot;</span>))</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 接口调试地址</span></span><br><span class="line">                .host(swaggerProperties.getTryHost())</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 选择哪些接口作为swagger的doc发布</span></span><br><span class="line">                .select()</span><br><span class="line">                <span class="comment">//扫描指定包下的@controller注解 any()是所有 none()是不扫描</span></span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;cn.xpp011.controller&quot;</span>))</span><br><span class="line"></span><br><span class="line">                .paths(PathSelectors.any())</span><br><span class="line">                .build()</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 支持的通讯协议集合</span></span><br><span class="line">                .protocols(newHashSet(<span class="string">&quot;https&quot;</span>, <span class="string">&quot;http&quot;</span>))</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 授权信息设置，必要的header token等认证信息</span></span><br><span class="line">                .securitySchemes(securitySchemes())</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 授权信息全局应用</span></span><br><span class="line">                .securityContexts(securityContexts());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="7，测试注解">7，测试注解</h4>
<p>帮助文档：<a target="_blank" rel="noopener" href="http://c.biancheng.net/view/5533.html">http://c.biancheng.net/view/5533.html</a></p>
<ol>
<li>
<p>@Api</p>
<p>@Api 用在类上，说明该类的作用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Api(tags = &quot;用户登录控制类&quot;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ApiOperation</p>
</li>
</ol>
<p>@ApiOperation 用在 Controller 里的方法上，说明方法的作用，每一个接口的定义。</p>
   <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ApiOperation(&quot;首页请求&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(&#123;&quot;/&quot;,&quot;/index&quot;&#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;index&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>
<p>ApiParam</p>
<p>@ApiParam 用于 Controller 中方法的参数说明。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;处理登录请求&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">(<span class="meta">@ApiParam(&quot;用户名字&quot;)</span> String username,<span class="meta">@ApiParam(&quot;用户密码&quot;)</span> String password,<span class="meta">@ApiParam(&quot;是否勾选记得我&quot;)</span> <span class="keyword">boolean</span> rememberMe, Model model)</span></span>&#123;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>@ApiModel</p>
<p>@ApiModel 用在实体类上</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiModel(value = &quot;用户类&quot;,discriminator = &quot;实体类&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ApiModelProperty</p>
</li>
</ol>
<p>@ApiModelProperty() 用于实体类的字段</p>
   <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiModelProperty(&quot;用户id&quot;)</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line"><span class="meta">@ApiModelProperty(&quot;用户名字&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String name;</span><br><span class="line"><span class="meta">@ApiModelProperty(&quot;用户密码&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String pwd;</span><br><span class="line"><span class="meta">@ApiModelProperty(&quot;用户权限&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String perms;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="16，异步任务">16，异步任务</h2>
<p>异步任务主要帮助用户提升体验，比如发送邮件，后台发送邮件是比较慢的过程，需要联网等等，而用户就会需要等待多时，而我们开启异步任务时，将邮件发送变成一个多线程任务，让用户先做其他事情，就会大大增加用户体验</p>
<p><strong>如何开启异步任务</strong></p>
<p>在需要异步的类上加上一个注解<code>@Async</code>声明这是一个异步任务，那样程序调用该类时就会开启异步</p>
<p>该注解可以加在类上或者方法上</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Async</span><span class="comment">//该类是一个异步任务</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在SpringBoot主启动类上加上<code>@EnableAsync</code>注解,启动异步</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableAsync</span><span class="comment">//开启异步任务</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringbootAsyncApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(SpringbootAsyncApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="17，文件上传，邮件发送">17，文件上传，邮件发送</h2>
<h3 id="邮件发送">邮件发送</h3>
<p>参考文档:<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43647359/article/details/104638599">https://blog.csdn.net/qq_43647359/article/details/104638599</a></p>
<p>首先导入依赖</p>
<p>由于我发现springBoot启动器mail的依赖包中，<code>javax.mail.internet.MimeMessage</code>是缺失的，所有还需要额外导入<code>javax.mail</code>的mail依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-mail --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-mail<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/javax.mail/mail --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.mail<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mail<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>yaml配置文件中配置发送邮件需要的信息</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">mail:</span></span><br><span class="line">    <span class="comment">#服务器地址</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">smtp.qq.com</span></span><br><span class="line">    <span class="comment">#邮件编码</span></span><br><span class="line">    <span class="attr">default-encoding:</span> <span class="string">utf-8</span></span><br><span class="line">    <span class="comment">#发送邮件用户名</span></span><br><span class="line">    <span class="attr">username:</span> <span class="number">2500176776</span><span class="string">@qq.com</span></span><br><span class="line">    <span class="comment">#发送邮件的密码，防止密码暴露，填写授权码</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">ddkrojojfylldhic</span></span><br><span class="line">    <span class="comment">#设置ssl加密</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">mail:</span></span><br><span class="line">        <span class="attr">smtp:</span></span><br><span class="line">          <span class="attr">socketFactoryClass:</span> <span class="string">javax.net.ssl.SSLSocketFactory</span></span><br></pre></td></tr></table></figure>
<p>一个简单的邮件</p>
<p>项目中要把它提成一个方法，这里先偷懒</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">SimpleMailSend</span><span class="params">()</span></span>&#123;</span><br><span class="line">    String msg=<span class="string">&quot;邮件发送成功&quot;</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//创建一个简单邮件实例</span></span><br><span class="line">        SimpleMailMessage message=<span class="keyword">new</span> SimpleMailMessage();</span><br><span class="line">        <span class="comment">//邮件主题</span></span><br><span class="line">        message.setSubject(<span class="string">&quot;主题&quot;</span>);</span><br><span class="line">        <span class="comment">//邮件内容</span></span><br><span class="line">        message.setText(<span class="string">&quot;邮件内容&quot;</span>);</span><br><span class="line">        <span class="comment">//接收人,可以写多个</span></span><br><span class="line">        message.setTo(<span class="string">&quot;2500176776@qq.com&quot;</span>);</span><br><span class="line">        <span class="comment">//发送人 ，注意这里一定要和配置文件中的发送人地址一致</span></span><br><span class="line">        message.setFrom(<span class="string">&quot;2500176776@qq.com&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//通过自带的邮件发送类发送</span></span><br><span class="line">        javaMailSender.send(message);</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">        msg=<span class="string">&quot;邮件发送失败&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一个复杂邮件</p>
<p>项目中要把它提成一个方法，这里先偷懒</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">MimeMailSend</span><span class="params">()</span>  </span>&#123;</span><br><span class="line">    String msg=<span class="string">&quot;邮件发送成功&quot;</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//复杂邮件实例</span></span><br><span class="line">        MimeMessage mimeMessage = javaMailSender.createMimeMessage();</span><br><span class="line">        <span class="comment">//复杂邮件的助手实例 构造方法中的Boolean值为是否支持多文件</span></span><br><span class="line">        MimeMessageHelper helper=<span class="keyword">new</span> MimeMessageHelper(mimeMessage,<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">//邮件主题</span></span><br><span class="line">        helper.setSubject(<span class="string">&quot;附件邮件主题&quot;</span>);</span><br><span class="line">        <span class="comment">//邮件内容 Boolean为是否支持html语法</span></span><br><span class="line">        helper.setText(<span class="string">&quot;&lt;h1&gt;你好&lt;/h1&gt;&quot;</span>,<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">//接收人,可以写多个</span></span><br><span class="line">        helper.setTo(<span class="string">&quot;2500176776@qq.com&quot;</span>);</span><br><span class="line">        <span class="comment">//发送人 ，注意这里一定要和配置文件中的发送人地址一致</span></span><br><span class="line">        helper.setFrom(<span class="string">&quot;2500176776@qq.com&quot;</span>);</span><br><span class="line">        <span class="comment">//添加附件 名字 File中是附件的绝对地址</span></span><br><span class="line">        helper.addAttachment(<span class="string">&quot;1.png&quot;</span>,<span class="keyword">new</span> File(<span class="string">&quot;D:\\win10桌面存放\\java\\赫夫曼思想.png&quot;</span>));</span><br><span class="line">        <span class="comment">//代理类发送</span></span><br><span class="line">        javaMailSender.send(mimeMessage);</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">        msg=<span class="string">&quot;邮件发送失败&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将图片插入在邮件中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendImgResMail</span><span class="params">()</span> <span class="keyword">throws</span> MessagingException </span>&#123;</span><br><span class="line">        MimeMessage mimeMessage = javaMailSender.createMimeMessage();</span><br><span class="line">        MimeMessageHelper helper = <span class="keyword">new</span> MimeMessageHelper(mimeMessage,<span class="keyword">true</span>);</span><br><span class="line">        helper.setSubject(<span class="string">&quot;这是一封测试邮件&quot;</span>);</span><br><span class="line">        helper.setFrom(<span class="string">&quot;bai211425401@qq.com&quot;</span>);</span><br><span class="line">        helper.setTo(<span class="string">&quot;1712900841@qq.com&quot;</span>);</span><br><span class="line">        helper.setSentDate(<span class="keyword">new</span> Date());</span><br><span class="line">        helper.setText(<span class="string">&quot;&lt;p&gt;hello 大家好,我是一封测试邮件,我包含了两张图片,分别如下&lt;/p&gt;&lt;p&gt;第一张图片：&lt;/p&gt;&lt;img src=&#x27;cid:p01&#x27;/&gt;&lt;p&gt;第二张图片：&lt;/p&gt;&lt;img src=&#x27;cid:p02&#x27;/&gt;&quot;</span>,<span class="keyword">true</span>);</span><br><span class="line">    </span><br><span class="line">        helper.addInline(<span class="string">&quot;p01&quot;</span>,<span class="keyword">new</span> FileSystemResource(<span class="keyword">new</span> File(<span class="string">&quot;C:\\Users\\bai\\Pictures\\Camera Roll\\img\\1.png&quot;</span>)));</span><br><span class="line">    </span><br><span class="line">        helper.addInline(<span class="string">&quot;p02&quot;</span>,<span class="keyword">new</span> FileSystemResource(<span class="keyword">new</span> File(<span class="string">&quot;C:\\Users\\bai\\Pictures\\Camera Roll\\img\\2.png&quot;</span>)));</span><br><span class="line">        javaMailSender.send(mimeMessage);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong></p>
<p>在实际开发中，我们不可能让用户等待邮件发送完毕，所以我们要将邮件发送变成一个异步任务</p>
<p>在邮件发送的类上加入注解<code>@Async</code>声明是一个异步任务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Async</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MailSend</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>在SpringBoot主启动类中加入注解<code>@EnableAsync</code>开启异步任务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableAsync</span><span class="comment">//开启异步任务</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringbootAsyncApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(SpringbootAsyncApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="文件上传">文件上传</h3>
<p>前端</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/fileUpload&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;上传&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>后端接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/fileUpload&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">fileUpload</span><span class="params">(MultipartFile file, HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">    String format = sdf.format(<span class="keyword">new</span> Date());</span><br><span class="line">    <span class="comment">//getServletContext获取服务器的项目地址 SpringBoot集成的tomcat的地址</span></span><br><span class="line">    String path = request.getServletContext().getRealPath(<span class="string">&quot;/img/&quot;</span>) + format;</span><br><span class="line">    System.out.println(<span class="string">&quot;文件保存路径:&quot;</span> + path);</span><br><span class="line">    File realPath = <span class="keyword">new</span> File(path);</span><br><span class="line">    <span class="keyword">if</span> (!realPath.exists()) &#123;</span><br><span class="line">        realPath.mkdirs();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//得到文件名</span></span><br><span class="line">    String oldName = file.getOriginalFilename();</span><br><span class="line">    <span class="comment">//设置新文件名更具uuid</span></span><br><span class="line">    String newName = UUID.randomUUID().toString() + oldName.substring(oldName.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//将文件转移到realPath路径 文件名为newName</span></span><br><span class="line">        file.transferTo(<span class="keyword">new</span> File(realPath, newName));</span><br><span class="line">        <span class="comment">//前端可访问的地址  getScheme()得到项目的协议使http还是https</span></span><br><span class="line">        <span class="comment">// getServerName()得到项目名</span></span><br><span class="line">        <span class="comment">//getServerPort() 得到项目端口</span></span><br><span class="line">        String overPath = request.getScheme() + <span class="string">&quot;://&quot;</span> + request.getServerName() + <span class="string">&quot;:&quot;</span> + request.getServerPort() + <span class="string">&quot;/img/&quot;</span> + format + newName;</span><br><span class="line">        <span class="keyword">return</span> overPath;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;error&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ajax请求</strong></p>
<p>axaj请求后端接口基本不用变</p>
<p>前端（记住需要导入jquery）</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;msg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">id</span>=<span class="string">&quot;file&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;UpLoad()&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">UpLoad</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> file=$(<span class="string">&quot;#file&quot;</span>)[<span class="number">0</span>].files[<span class="number">0</span>];</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> formDate=<span class="keyword">new</span> FormData();</span></span><br><span class="line"><span class="javascript">        formDate.append(<span class="string">&quot;file&quot;</span>,file);</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">&quot;开始&quot;</span>);</span></span><br><span class="line"><span class="javascript">        $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">                <span class="attr">type</span>:<span class="string">&quot;post&quot;</span>,</span></span><br><span class="line"><span class="javascript">                <span class="attr">url</span>:<span class="string">&quot;/fileUpload&quot;</span>,</span></span><br><span class="line"><span class="javascript">                <span class="comment">/*!!!!!</span></span></span><br><span class="line"><span class="comment"><span class="javascript">                 processData：处理数据</span></span></span><br><span class="line"><span class="comment"><span class="javascript">                 默认情况下，processData 的值是 true，其代表以对象的形式上传的数据都会被转换为字符串的形式上传。而当上传文件的时候，则不需要把其转换为字符串，因此要改成false  */</span></span></span><br><span class="line"><span class="javascript">                <span class="attr">processData</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">                <span class="comment">/*!!!!!</span></span></span><br><span class="line"><span class="comment"><span class="javascript">                * contentType：发送数据的格式</span></span></span><br><span class="line"><span class="comment"><span class="javascript">                  和 contentType 有个类似的属性是 dataType ， 代表的是期望从后端收到的数据的格式，一般会有 json 、text……等</span></span></span><br><span class="line"><span class="comment"><span class="javascript">                  而 contentType 则是与 dataType 相对应的，其代表的是 前端发送数据的格式</span></span></span><br><span class="line"><span class="comment"><span class="javascript">                  </span></span></span><br><span class="line"><span class="comment"><span class="javascript">                  默认值：application/x-www-form-urlencoded</span></span></span><br><span class="line"><span class="comment"><span class="javascript">                  代表的是 ajax 的 data 是以字符串的形式 如 id=2019&amp;password=123456</span></span></span><br><span class="line"><span class="comment"><span class="javascript">                  使用这种传数据的格式，无法传输复杂的数据，比如多维数组、文件等</span></span></span><br><span class="line"><span class="comment"><span class="javascript">                  </span></span></span><br><span class="line"><span class="comment"><span class="javascript">                  有时候要注意，自己所传输的数据格式和ajax的contentType格式是否一致，如果不一致就要想办法对数据进行转换</span></span></span><br><span class="line"><span class="comment"><span class="javascript">                  把contentType 改成 false 就会改掉之前默认的数据格式，在上传文件时就不会报错了。*/</span></span></span><br><span class="line"><span class="javascript">                <span class="attr">contentType</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">                <span class="attr">data</span>:formDate,</span></span><br><span class="line"><span class="javascript">                <span class="attr">success</span>:<span class="function"><span class="keyword">function</span> (<span class="params">msg</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                    $(<span class="string">&quot;#msg&quot;</span>).html(msg);</span></span><br><span class="line"><span class="javascript">                &#125;</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        )</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>多文件上传</strong></p>
<p>前端</p>
<p>前端只需要设置 input标案加入属性 multiple 实现多文件上传</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/fileUploads&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    multiple选择多个值  在file中也就是选择多个文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;files&quot;</span> <span class="attr">multiple</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;上传&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>后端</p>
<p>后端大致一样</p>
<p>接收的MultipartFile改为数组形式 存储多个文件</p>
<p>最后遍历该数组并保存</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/fileUploads&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">fileUploads</span><span class="params">(MultipartFile[] files, HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">    String format = sdf.format(<span class="keyword">new</span> Date());</span><br><span class="line">    <span class="comment">//getServletContext获取服务器的项目地址 SpringBoot集成的tomcat的地址</span></span><br><span class="line">    String path = request.getServletContext().getRealPath(<span class="string">&quot;/img/&quot;</span>) + format;</span><br><span class="line">    System.out.println(<span class="string">&quot;文件保存路径:&quot;</span> + path);</span><br><span class="line">    File realPath = <span class="keyword">new</span> File(path);</span><br><span class="line">    <span class="keyword">if</span> (!realPath.exists()) &#123;</span><br><span class="line">        realPath.mkdirs();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (MultipartFile file : files) &#123;</span><br><span class="line"></span><br><span class="line">        String oldName = file.getOriginalFilename();</span><br><span class="line">        String newName = UUID.randomUUID().toString() + oldName.substring(oldName.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            file.transferTo(<span class="keyword">new</span> File(realPath, newName));</span><br><span class="line">            String overPath = request.getScheme() + <span class="string">&quot;://&quot;</span> + request.getServerName() + <span class="string">&quot;:&quot;</span> + request.getServerPort() + <span class="string">&quot;/img/&quot;</span> + format + newName;</span><br><span class="line">            System.out.println(overPath);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="18，定时任务">18，定时任务</h2>
<p><strong>注解</strong><code>@EnableScheduling</code></p>
<p>开启定时任务,在主启动类上加</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableScheduling</span><span class="comment">//开启定时任务</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringbootAsyncApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(SpringbootAsyncApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注解</strong><code>@scheduled</code></p>
<p>通过cron表达式进行定时,作用域在方法上，不要加在类上</p>
<p>星期天到星期六的每月每日每时每分每秒执行hello方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@org</span>.springframework.scheduling.annotation.Scheduled(cron = <span class="string">&quot;* * * * * 0-6 &quot;</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>cron表达式</strong></p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210522161627705.png" alt="image-20210522161627705"></p>
<p><strong>常用表达式例子</strong></p>
<p>（1）<strong>0 0 2 1 * ? *</strong>  表示在每月的1日的凌晨2点调整任务</p>
<p>（2）<strong>0 15 10 ? * MON-FRI</strong>  表示周一到周五每天上午10:15执行作业</p>
<p>（3）<strong>0 15 10 ? 6L 2002-2006</strong>  表示2002-2006年的每个月的最后一个星期五上午10:15执行作</p>
<p>（4）<strong>0 0 10,14,16 * * ?</strong>  每天上午10点，下午2点，4点</p>
<p>（5）<strong>0 0/30 9-17 * * ?</strong>  朝九晚五工作时间内每半小时</p>
<p>（6）<strong>0 0 12 ? * WED</strong>   表示每个星期三中午12点</p>
<p>（7）<strong>0 0 12 * * ?</strong>  每天中午12点触发</p>
<p>（8）<strong>0 15 10 ? * *</strong>   每天上午10:15触发</p>
<p>（9）<strong>0 15 10 * * ?</strong>   每天上午10:15触发</p>
<p>（10）<strong>0 15 10 * * ? *</strong>   每天上午10:15触发</p>
<p>（11）<strong>0 15 10 * * ? 2005</strong>   2005年的每天上午10:15触发</p>
<p>（12）<strong>0 * 14 * * ?</strong>   在每天下午2点到下午2:59期间的每1分钟触发</p>
<p>（13）<strong>0 0/5 14 * * ?</strong>   在每天下午2点到下午2:55期间的每5分钟触发</p>
<p>（14）<strong>0 0/5 14,18 * * ?</strong>   在每天下午2点到2:55期间和下午6点到6:55期间的每5分钟触发</p>
<p>（15）<strong>0 0-5 14 * * ?</strong>   在每天下午2点到下午2:05期间的每1分钟触发</p>
<p>（16）<strong>0 10,44 14 ? 3 WED</strong>   每年三月的星期三的下午2:10和2:44触发</p>
<p>（17）<strong>0 15 10 ? * MON-FRI</strong>   周一至周五的上午10:15触发</p>
<p>（18）<strong>0 15 10 15 * ?</strong>   每月15日上午10:15触发</p>
<p>（19）<strong>0 15 10 L * ?</strong>   每月最后一日的上午10:15触发</p>
<p>（20）<strong>0 15 10 ? * 6L</strong>   每月的最后一个星期五上午10:15触发</p>
<p>（21）<strong>0 15 10 ? * 6L 2002-2005</strong>  2002年至2005年的每月的最后一个星期五上午10:15触发</p>
<p>（22）<strong>0 15 10 ? * 6#3</strong>  每月的第三个星期五上午10:15触发</p>
<p>学习网址：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/javahr/p/8318728.html">https://www.cnblogs.com/javahr/p/8318728.html</a></p>
<p>在线转换器网址:<a target="_blank" rel="noopener" href="https://qqe2.com/cron">https://qqe2.com/cron</a>  也可以将cron表达式转为看得懂的文字</p>
<h2 id="19，Dubbo">19，Dubbo</h2>
<p>​	Dubbo(读音[ˈdʌbəʊ])是阿里巴巴公司开源的一个高性能优秀的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%9C%8D%E5%8A%A1%E6%A1%86%E6%9E%B6">服务框架</a>，使得应用可通过高性能的 RPC 实现服务的输出和输入功能，可以和 [1] <a target="_blank" rel="noopener" href="https://baike.baidu.com/item/Spring">Spring</a>框架无缝集成。</p>
<p>​	Dubbo是一款高性能、轻量级的开源Java RPC框架，它提供了三大核心能力：面向接口的远程方法调用，智能容错和负载均衡，以及服务自动注册和发现。</p>
<h3 id="架构">架构</h3>
<p>Dubbo 架构</p>
<p><img src="https://dubbo.apache.org/imgs/user/dubbo-architecture.jpg" alt="dubbo-architucture"></p>
<p><strong>节点角色说明</strong></p>
<table>
<thead>
<tr>
<th>节点</th>
<th>角色说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Provider</code></td>
<td>暴露服务的服务提供方</td>
</tr>
<tr>
<td><code>Consumer</code></td>
<td>调用远程服务的服务消费方</td>
</tr>
<tr>
<td><code>Registry</code></td>
<td>服务注册与发现的注册中心</td>
</tr>
<tr>
<td><code>Monitor</code></td>
<td>统计服务的调用次数和调用时间的监控中心</td>
</tr>
<tr>
<td><code>Container</code></td>
<td>服务运行容器</td>
</tr>
</tbody>
</table>
<p><strong>调用关系说明</strong></p>
<ol>
<li>服务容器负责启动，加载，运行服务提供者。</li>
<li>服务提供者在启动时，向注册中心注册自己提供的服务。</li>
<li>服务消费者在启动时，向注册中心订阅自己所需的服务。</li>
<li>注册中心返回服务提供者地址列表给消费者，如果有变更，注册中心将基于长连接推送变更数据给消费者。</li>
<li>服务消费者，从提供者地址列表中，基于软负载均衡算法，选一台提供者进行调用，如果调用失败，再选另一台调用。</li>
<li>服务消费者和提供者，在内存中累计调用次数和调用时间，定时每分钟发送一次统计数据到监控中心。</li>
</ol>
<h3 id="实现Dubbo和zookeeper">实现Dubbo和zookeeper</h3>
<h4 id="zookeeper">zookeeper</h4>
<ol>
<li>前往zookeeper官网下载：<a target="_blank" rel="noopener" href="https://zookeeper.apache.org/releases.html">https://zookeeper.apache.org/releases.html</a>  3.6.3为稳定版
<ul>
<li>​	下载完成后解压，并运行<code>/bin</code>目录下的<code>zkServer.cmd</code>文件启动zookeeper</li>
<li><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210522214910199.png" alt="image-20210522214910199"></li>
</ul>
</li>
</ol>
<h4 id="dubbo-admin">dubbo-admin</h4>
<ol>
<li>
<p>前往下载dubbo在GetHub上托管的dubbo-admin</p>
<ul>
<li>dubbo-admin是是一个可视化管理dubbo和zookeeper注册中心的网页</li>
<li>网址:<a target="_blank" rel="noopener" href="https://github.com/apache/dubbo-admin/tree/master">https://github.com/apache/dubbo-admin/tree/master</a> 建议下载master分支的debbo，最新版是vue分离的比较折腾</li>
<li>在项目<code>dubbo-admin-master</code>下，运行cmd，执行<code>mvn clean package -Dmaven.test.skip=true</code>将项目打成jar包</li>
<li>在子项目<code>dubbo-admin</code>的target目录运行打包好的jar包</li>
</ul>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210522215827776.png" alt="image-20210522215827776"></p>
</li>
</ol>
<h4 id="构建项目">构建项目</h4>
<ol>
<li>在IDEA中构建两个项目，分别是提供者<code>Provider</code>和消费者<code>Consumer</code></li>
</ol>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5Cimage-20210522220052435.png" alt="image-20210522220052435"></p>
<p>配置端口，避免端口冲突</p>
<p><code>server.port=XXXX</code></p>
<p>分别在两个项目中导入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--zkclient客户端--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.github.mxsm/zkclient-spring-boot-starter --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.mxsm<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zkclient-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--dubbo依赖--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.dubbo/dubbo-spring-boot-starter --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.dubbo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--解决日志冲突--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.curator/curator-framework --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-framework<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.curator/curator-recipes --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-recipes<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.zookeeper/zookeeper --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--剔除log4日志--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<hr>
<p><strong>springboot-provider</strong></p>
<p>编写配置</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">8081</span></span><br><span class="line"><span class="comment">#服务器的名字</span></span><br><span class="line"><span class="meta">dubbo.application.name</span>=<span class="string">provider-server</span></span><br><span class="line"><span class="comment">#注册中心的地址</span></span><br><span class="line"><span class="meta">dubbo.registry.address</span>=<span class="string">zookeeper://127.0.0.1:2181</span></span><br><span class="line"><span class="comment">#该项目下的那些服务被注册,并暴露给注册中心zookeeper</span></span><br><span class="line"><span class="meta">dubbo.scan.base-packages</span>=<span class="string">cn.xpp011.service</span></span><br></pre></td></tr></table></figure>
<p>在提供者springboot-provider项目中书写想要暴露的服务</p>
<p>注意TicketServiceImpl类实现接口TicketService，接口TicketService中就一个方法ticket</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.xpp011.service;</span><br><span class="line"><span class="meta">@DubboService</span><span class="comment">//将该服务类在注册中心注册</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TicketServiceImpl</span> <span class="keyword">implements</span> <span class="title">TicketService</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">ticket</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;《成都--&gt;上海》&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在主启动类中加入注解<code>@EnableDubbo</code>启动Dubbo</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDubbo</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringbootProviderApplication</span> </span>&#123;...&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>springboot-consumer</strong></p>
<p>编写配置</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">8082</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#消费者服务的名字</span></span><br><span class="line"><span class="meta">dubbo.application.name</span>=<span class="string">consumer-server</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#注册中心的地址</span></span><br><span class="line"><span class="meta">dubbo.registry.address</span>=<span class="string">zookeeper://127.0.0.1:2181</span></span><br></pre></td></tr></table></figure>
<p>在消费者类中编写服务类，同时调用提供者<strong>springboot-provider</strong>项目中暴露的服务类</p>
<p>注意如果想要拿到别的项目暴露的服务类，需要编写该服务类实现的接口，包路径也必须相同</p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210522221032294.png" alt="image-20210522221032294"></p>
<p>拿到其他项目暴露服务类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsumerTicket</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DubboReference</span><span class="comment">//从注册中心拿取类型为TicketService，同时包路径为cn.xpp011.service</span></span><br><span class="line">    </span><br><span class="line">    TicketService ticketService;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">consumer</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String ticket = ticketService.ticket();</span><br><span class="line">        System.out.println(<span class="string">&quot;购买了:&quot;</span>+ticket);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行消费者<strong>springboot-consumer</strong></p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210522221316160.png" alt="image-20210522221316160"></p>
<hr>
<p>最后可以在dubbo-admin的网页地址<code>http://localhost:7001</code></p>
<p>可视化的看到暴露的服务类</p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210522221433991.png" alt="image-20210522221433991"></p>
<h3 id="思考">思考</h3>
<p>1，为什么dubbo-admin可以可视化的看到提供者暴露的服务类呢</p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210522222006051.png" alt="image-20210522222006051"></p>
<p>在dubbo-admin-master的配置文件中我们看到了，它已经配置了zookeeper注册中心的地址。所以dubbo-admin拿到了注册中心的数据。</p>
<p>所以我们zookeeper注册中心的端口修改时，我们的dubbo-admin-master的配置文件也要修改哦；</p>
<p>2，那zookeeper注册中心是怎么拿到提供者暴露的服务类的呢</p>
<p>其实在提供者<strong>springboot-provider</strong> 项目中配置了注册中心的地址</p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210522222331445.png" alt="image-20210522222331445"></p>
<p>并提供服务类的注解<code>@DubboService</code>将该服务类在注册中心注册</p>
<p>3，那消费者是怎么拿到暴露的服务的呢</p>
<p>这就比较简单了</p>
<p>消费者<strong>springboot-consumer</strong>项目也配置了zookeeper注册中心的地址</p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210522222545148.png" alt="image-20210522222545148"></p>
<p>并通过注解<code>@DubboReference</code>从注册中心拿取相应类型，相应包路径的服务类</p>
<h2 id="20，跨域请求（cors）">20，跨域请求（cors）</h2>
<h3 id="1-什么是跨域？">1.什么是跨域？</h3>
<p>跨域：指的是浏览器不能执行其他网站的脚本。它是由浏览器的同源策略造成的，是浏览器对javascript施加的安全限制。</p>
<p>例如：a页面想获取b页面资源，如果a、b页面的协议、域名、端口、子域名不同，所进行的访问行动都是跨域的，而浏览器为了安全问题一般都限制了跨域访问，也就是不允许跨域请求资源。注意：跨域限制访问，其实是<strong>浏览器的限制</strong>。理解这一点很重要！！！</p>
<p>同源策略：是指协议，域名，端口都要相同，其中有一个不同都会产生跨域；</p>
<p><img src="https://upload-images.jianshu.io/upload_images/9487719-d9eb2035e204d817.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/717/format/webp" alt="img"></p>
<p><strong>那SpringBoot如何解决跨域请求呢</strong></p>
<p><strong>注解</strong></p>
<p>在SpringBoot中解决跨域请求是相当简单的</p>
<p>只需要注解@CrossOrigin(“域名地址:端口”)</p>
<p>当我们加上<strong>该注解的使用那么该方法或者类下的所有方法</strong>  都会<strong>被指定</strong>域名:端口允许方法</p>
<p>实现Cors  跨域资源共享</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//加上该注解后表示该方法 支持地址为http://localhost:8082的跨域请求   作用域为类和方法</span></span><br><span class="line">    <span class="comment">//@CrossOrigin(&quot;http://localhost:8082&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">gethello</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello cors:get&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">puthello</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello cors:put&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>配置类</strong></p>
<p>但是在项目很大的使用，加注解的方式就显得不是很明智了，那么通过Java配置类的方式解救跨域请求</p>
<p>实现WebMvcConfigurer接口，并实现跨域资源共享映射方法addCorsMappings方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//由于注解方式可能在项目大时比较繁琐</span></span><br><span class="line"><span class="comment">//所以这里可以使用配置类的方式实现 就不需要加很多注解</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CorsConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="comment">//实现跨域资源共享映射方法addCorsMappings</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCorsMappings</span><span class="params">(CorsRegistry registry)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//addMapping 设置请求地址</span></span><br><span class="line">        registry.addMapping(<span class="string">&quot;/**&quot;</span>)</span><br><span class="line">                <span class="comment">//设置请求域名</span></span><br><span class="line">                .allowedOrigins(<span class="string">&quot;http://localhost:8082&quot;</span>)</span><br><span class="line">                <span class="comment">//设置跨域的请求头  *表示任何请求头都可以</span></span><br><span class="line">                .allowedHeaders(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">                <span class="comment">//设置请求的方法 get,post,del *表示任何请求方式都可以</span></span><br><span class="line">                .allowedMethods(<span class="string">&quot;*&quot;</span>)</span><br><span class="line">                <span class="comment">//设置探测请求后多少秒不需要再探测  默认1800秒</span></span><br><span class="line">                .maxAge(<span class="number">3</span> * <span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>关于探测请求</strong></p>
<p>在put请求方式中，它第一次会发送两次请求</p>
<p>第一次是探测请求，判断服务器是否支持该请求地址，如果支持那么就会发送第二次正式请求</p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210530131140246.png" alt="image-20210530131140246"></p>
<p>那探测请求其实不用每次都发，我们可以设置一个探测请求有效期，在该有效期内就不用每次都发探测请求了,也就是配置类的<code>maxAge()</code>方法</p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210530131253860.png" alt="image-20210530131253860"></p>
<h2 id="21，系统启动任务">21，系统启动任务</h2>
<h3 id="CommandLineRunner"><strong>CommandLineRunner</strong></h3>
<p>系统启动任务，可以在系统启动之前做一些事情，比如初始化参数等等</p>
<p>自定义Java配置类   实现启动命令接口<code>CommandLineRunner</code></p>
<p>实现run方法在其中可以做一些系统启动任务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Order(100)</span><span class="comment">//系统启动任务的优先级   默认为2的31次方减一  数字越小优先级越高</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyComm</span> <span class="keyword">implements</span> <span class="title">CommandLineRunner</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(String... args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//这里的参数args为主启动类run方法传递的参数</span></span><br><span class="line">        System.out.println(<span class="string">&quot;系统启动任务1,参数:&quot;</span>+ Arrays.toString(args));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意注解<code>@Order</code>当我们有多个系统启动任务类时，设置优先级就很必要</p>
<p>系统启动任务的优先级   默认为2的31次方减一  数字越小优先级越高</p>
<h3 id="ApplicationRunner">ApplicationRunner</h3>
<p>ApplicationRunner也是一个系统启动类，只不过它可以获取kv键值对形式的参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Order(99)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApplicationRunner</span> <span class="keyword">implements</span> <span class="title">ApplicationRunner</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(ApplicationArguments args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String[] sourceArgs = args.getSourceArgs();</span><br><span class="line">        <span class="comment">//获取全部参数 包括kv键值对的形式</span></span><br><span class="line">        System.out.println(<span class="string">&quot;sourceArgs : &quot;</span>+ Arrays.toString(sourceArgs));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取值  只包括kv键值对的形式</span></span><br><span class="line">        List&lt;String&gt; nonOptionArgs = args.getNonOptionArgs();</span><br><span class="line">        nonOptionArgs.forEach((v)-&gt;&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;v : &quot;</span>+v);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取kv键值对的形式的key</span></span><br><span class="line">        Set&lt;String&gt; optionNames = args.getOptionNames();</span><br><span class="line">        optionNames.forEach((k)-&gt;&#123;</span><br><span class="line">            <span class="comment">//getOptionValues更具key得到value值</span></span><br><span class="line">            System.out.println(k+<span class="string">&quot; : &quot;</span>+args.getOptionValues(k));</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>执行效果</strong></p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210531135600115.png" alt="image-20210531135600115"></p>
<h2 id="22，SpringBoot—Aop">22，SpringBoot—Aop</h2>
<p><strong>前置</strong></p>
<h3 id="JoinPoint-对象">JoinPoint 对象</h3>
<p><strong>JoinPoint</strong>对象****封装了SpringAop中切面方法的信息*<em><strong>,在切面方法中添加</strong></em>*JoinPoint参数*<em><strong>,就可以获取到封装了该方法信息的</strong></em>*JoinPoint对象.****<br>
<strong>常用api:</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">方法名</th>
<th style="text-align:left">功能</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Signature getSignature();</td>
<td style="text-align:left"><strong>获取封装了署名信息的对象,在该对象中可以获取到目标方法名,所属类的Class等信息</strong></td>
</tr>
<tr>
<td style="text-align:left">Object[] getArgs();</td>
<td style="text-align:left"><strong>获取传入目标方法的参数对象</strong></td>
</tr>
<tr>
<td style="text-align:left">Object getTarget();</td>
<td style="text-align:left"><strong>获取被代理的对象</strong></td>
</tr>
<tr>
<td style="text-align:left">Object getThis();</td>
<td style="text-align:left"><strong>获取代理对象</strong></td>
</tr>
</tbody>
</table>
<h3 id="ProceedingJoinPoint对象">ProceedingJoinPoint对象</h3>
<p><em><strong>*ProceedingJoinPoint对象是JoinPoint的子接口,该对象只用在@Around的切面方法中,*</strong></em><br>
添加了<br>
<code>Object proceed() throws Throwable //执行目标方法</code><br>
<code>Object proceed(Object[] var1) throws Throwable //传入的新的参数去执行目标方法</code><br>
两个方法.</p>
<h3 id="导入aop依赖">导入aop依赖</h3>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="自定义切面类">自定义切面类</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.xpp011.Config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.JoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span><span class="comment">//切面</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> </span>&#123;</span><br><span class="line">    <span class="comment">//定制方法规则  这个方法只是单纯的指定方法规则 指定一个切点</span></span><br><span class="line">    <span class="comment">//返回值  指定包   指定方法  指定参数</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* cn.xpp011.Service.*.*(..))&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pc1</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//方法执行前</span></span><br><span class="line">    <span class="meta">@Before(&quot;pc1()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">(JoinPoint jp)</span></span>&#123;</span><br><span class="line">        String name = jp.getSignature().getName();</span><br><span class="line">        System.out.println(name+<span class="string">&quot;方法执行前&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//方法执行后</span></span><br><span class="line">    <span class="meta">@After(&quot;pc1()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">After</span><span class="params">(JoinPoint jp)</span></span>&#123;</span><br><span class="line">        String name = jp.getSignature().getName();</span><br><span class="line">        System.out.println(name+<span class="string">&quot;方法执行后&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//方法有返回值的aop returning指定返回参数</span></span><br><span class="line">    <span class="meta">@AfterReturning(value = &quot;pc1()&quot;,returning = &quot;o&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">AfterReturning</span><span class="params">(JoinPoint jp,Object o)</span></span>&#123;</span><br><span class="line">        String name = jp.getSignature().getName();</span><br><span class="line">        System.out.println(name+<span class="string">&quot;方法的返回值:&quot;</span>+o);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> o;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//方法异常aop e为该方法报出的异常  Throwing抛出什么异常</span></span><br><span class="line">    <span class="meta">@AfterThrowing(value = &quot;pc1()&quot;,throwing = &quot;e&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AfterThrowing</span><span class="params">(JoinPoint jp,Exception e)</span></span>&#123;</span><br><span class="line">        String name = jp.getSignature().getName();</span><br><span class="line">        System.out.println(name+<span class="string">&quot;方法报出的异常:&quot;</span>+e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//环绕通知</span></span><br><span class="line">    <span class="meta">@Around(&quot;pc1()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">a</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;环绕通知&quot;</span>);</span><br><span class="line">        <span class="comment">//需要在方法执行前做什么只需要在这里写就可以了</span></span><br><span class="line">        Object proceed = pjp.proceed();<span class="comment">//proceed执行该方法 返回值就是这个方法的返回值</span></span><br><span class="line">        <span class="comment">//需要在方法执行后做什么只需要在这里写就可以了</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//需要加入异常只需try catch包裹即可</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//这里可以对返回值进行修改</span></span><br><span class="line">        <span class="keyword">return</span> proceed;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="23，整合Redis">23，整合Redis</h2>
<h3 id="Linux安装redis">Linux安装redis</h3>
<p>1.首先下载 Redis，下载地址https://redis.io/，下载获得 redis-4.0.8.tar.gz 后将它放入我们的 Linux 目录 /opt</p>
<p><a target="_blank" rel="noopener" href="http://www.javaboy.org/images/redis/p285.png"><img src="http://www.javaboy.org/images/redis/p285.png" alt="img"></a></p>
<p>2./opt 目录下，对文件进行解压，解压命令: tar -zxvf redis-4.0.8.tar.gz ，如下：</p>
<p><a target="_blank" rel="noopener" href="http://www.javaboy.org/images/redis/p286.png"><img src="http://www.javaboy.org/images/redis/p286.png" alt="img"></a></p>
<p>3.解压完成后出现文件夹：redis-4.0.8，进入到该目录中: cd redis-4.0.8</p>
<p><a target="_blank" rel="noopener" href="http://www.javaboy.org/images/redis/p287.png"><img src="http://www.javaboy.org/images/redis/p287.png" alt="img"></a></p>
<p>4.在 redis-4.0.8 目录下执行 make 命令进行编译</p>
<p><a target="_blank" rel="noopener" href="http://www.javaboy.org/images/redis/p288.png"><img src="http://www.javaboy.org/images/redis/p288.png" alt="img"></a></p>
<p>5.如果 make 完成后继续执行 make install 进行安装</p>
<p><a target="_blank" rel="noopener" href="http://www.javaboy.org/images/redis/p289.png"><img src="http://www.javaboy.org/images/redis/p289.png" alt="img"></a></p>
<p>OK，至此，我们的 redis 就算安装成功了。</p>
<p>6.在我们启动之前，需要先做一个简单的配置：修改 redis.conf 文件，将里面的 daemonize no 改成 yes，让服务在后台启动，如下：</p>
<p><a target="_blank" rel="noopener" href="http://www.javaboy.org/images/redis/p290.png"><img src="http://www.javaboy.org/images/redis/p290.png" alt="img"></a><br>
<a target="_blank" rel="noopener" href="http://www.javaboy.org/images/redis/p291.png"><img src="http://www.javaboy.org/images/redis/p291.png" alt="img"></a></p>
<p>7.启动，通过<code>redis-server redis.conf</code>命令启动redis，如下：</p>
<p><a target="_blank" rel="noopener" href="http://www.javaboy.org/images/redis/p292.png"><img src="http://www.javaboy.org/images/redis/p292.png" alt="img"></a></p>
<p>8.测试</p>
<p>首先我们可以通过 <code>redis-cli</code> 命令进入到控制台，然后通过 <code>ping</code> 命令进行连通性测试，如果看到 pong ，表示连接成功了，如下：</p>
<p><a target="_blank" rel="noopener" href="http://www.javaboy.org/images/redis/p293.png"><img src="http://www.javaboy.org/images/redis/p293.png" alt="img"></a></p>
<p>9.关闭，通过 <code>shutdown</code> 命令我们可以关闭实例，如下：</p>
<p><a target="_blank" rel="noopener" href="http://www.javaboy.org/images/redis/p294.png"><img src="http://www.javaboy.org/images/redis/p294.png" alt="img"></a></p>
<h3 id="远程连接">远程连接</h3>
<p>1，修改redis服务器的配置文件<br>
<code>vim redis.conf</code></p>
<p>2，注释以下绑定的主机地址</p>
<p>#bind 127.0.0.1</p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210608143105417.png" alt="image-20210608143105417"></p>
<p>3，关闭保护模式</p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210608143204943.png" alt="image-20210608143204943"></p>
<p>组合拳</p>
<p>4，开启端口6379 <code>firewall-cmd --zone=public --add-port=6379/tcp --permanent</code></p>
<p>5，重启防火墙 <code>firewall-cmd --reload</code></p>
<p>6，重启redis</p>
<h3 id="整合redis">整合redis</h3>
<p>加入依赖</p>
<p>redis必须和security一起使用</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>配置文件</p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210608143650149.png" alt="image-20210608143650149"></p>
<p>业务类</p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210608143522343.png" alt="image-20210608143522343"></p>
<h2 id="24，Linux安装Nginx">24，Linux安装Nginx</h2>
<ol>
<li>首先下载 Nginx（可去官网nginx.org获取最新下载地址）</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://nginx.org/download/nginx-1.17.0.tar.gz</span><br></pre></td></tr></table></figure>
<p>然后解压下载的目录，进入解压目录中，在编译安装之前，需要安装两个依赖：(如果没有安装C++编译环境则需要先安装C++编译环境)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y install pcre-devel</span><br><span class="line">yum -y install openssl openssl-devel</span><br></pre></td></tr></table></figure>
<p>然后开始编译安装：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<p>装好之后，默认安装位置在 ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/nginx/sbin/nginx</span><br></pre></td></tr></table></figure>
<p>进入到该目录的 <code>sbin</code> 目录下，执行 <code>nginx</code> 即可启动 <code>Nginx</code> ：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/GvtDGKK4uYkpibiahNwFHSibibEXSgsIC66z1FRY3ib9y4egeVGJr6MmC4VXdQWb4lsicrpKHxqcNNUbJjszIBQNjgNw/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>Nginx 启动成功之后，在浏览器中直接访问 Nginx 地址：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/GvtDGKK4uYkpibiahNwFHSibibEXSgsIC66zd9ibwfNAHRttia7PNjUSUlSdSPd9ggLLeeV89kVQX91uuqdQGSicOX5GQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="图片"></p>
<p>看到如上页面，表示 Nginx 已经安装成功了。</p>
<p>如果修改了 Nginx 配置，则可以通过如下命令重新加载 Nginx 配置文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./nginx -s reload</span><br></pre></td></tr></table></figure>
<h2 id="25，Session共享">25，Session共享</h2>
<p>Session共享的前提是有两个及以上的服务器，这里就涉及到分布式等操作</p>
<img src="/.cn//win10桌面存放\Spring\笔记\SpringBoot.assets\image-20210608145652056.png" alt="image-20210608145652056" style="zoom:33%;">
<p>在我们创建项目时，记住需要勾选Spring Session依赖，这样SpringBoot就可以帮助我们自动配置一些Session配置</p>
<p>我们启动两个tomcat，这两个tomcat配置了同一个redis</p>
<p>此时我们访问这两个项目就会得到相同的session</p>
<img src="/.cn//win10桌面存放\Spring\笔记\SpringBoot.assets\image-20210608151109024.png" alt="image-20210608151109024" style="zoom:33%;">
<p>我们查看redis，发现他已经存放了相关的session信息</p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210608151244337.png" alt="image-20210608151244337"></p>
<h3 id="使用Nginx进行负载均衡">使用Nginx进行负载均衡</h3>
<p>将jar包上传至linux，启动两个tomcat，判断tomcat是否可以正常访问</p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210608154457549.png" alt="image-20210608154457549"></p>
<p>配置Nginx，实现负载均衡，</p>
<p>加入Nginx的默认路径</p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210608154553630.png" alt="image-20210608154553630"></p>
<p>修改配置文件Nginx.config</p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210608154624680.png" alt="image-20210608154624680"></p>
<img src="/.cn//win10桌面存放\Spring\笔记\SpringBoot.assets\image-20210608154338339.png" alt="image-20210608154338339" style="zoom: 50%;">
<p><strong>解释：</strong></p>
<p>在这段配置中：</p>
<ol>
<li>upstream 表示配置上游服务器</li>
<li><a target="_blank" rel="noopener" href="http://javaboy.org">javaboy.org</a> 表示服务器集群的名字，这个可以随意取名字</li>
<li>upstream 里边配置的是一个个的单独服务</li>
<li>weight 表示服务的权重，意味者将有多少比例的请求从 Nginx 上转发到该服务上</li>
<li>location 中的 proxy_pass 表示请求转发的地址，<code>/</code> 表示拦截到所有的请求，转发转发到刚刚配置好的服务集群中</li>
<li>proxy_redirect 表示设置当发生重定向请求时，nginx 自动修正响应头数据（默认是 Tomcat 返回重定向，此时重定向的地址是 Tomcat 的地址，我们需要将之修改使之成为 Nginx 的地址）。</li>
</ol>
<p>配置完成后，将本地的 Spring Boot 打包好的 jar 上传到 Linux ，然后在 Linux 上分别启动两个 Spring Boot 实例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nohup java -jar sessionshare-0.0.1-SNAPSHOT.jar --server.port=8080 &amp;</span><br><span class="line">nohup java -jar sessionshare-0.0.1-SNAPSHOT.jar --server.port=8081 &amp;</span><br></pre></td></tr></table></figure>
<p>其中</p>
<ul>
<li>nohup 表示当终端关闭时，Spring Boot 不要停止运行</li>
<li>&amp; 表示让 Spring Boot 在后台启动</li>
</ul>
<p>配置完成后，重启 Nginx：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/nginx/sbin/nginx -s reload</span><br></pre></td></tr></table></figure>
<p>Nginx 启动成功后，我们首先手动清除 Redis 上的数据，然后访问 <code>192.168.66.128/set</code> 表示向 <code>session</code> 中保存数据，这个请求首先会到达 <code>Nginx</code> 上，再由 <code>Nginx</code> 转发给某一个 <code>Spring Boot</code> 实例：</p>
<p><a target="_blank" rel="noopener" href="http://www.javaboy.org/images/boot/14-8.png"><img src="http://www.javaboy.org/images/boot/14-8.png" alt="img"></a></p>
<p>如上，表示端口为 <code>8081</code> 的 <code>Spring Boot</code> 处理了这个 <code>/set</code> 请求，再访问 <code>/get</code> 请求：</p>
<p><a target="_blank" rel="noopener" href="http://www.javaboy.org/images/boot/14-9.png"><img src="http://www.javaboy.org/images/boot/14-9.png" alt="img"></a></p>
<p>可以看到，<code>/get</code> 请求是被端口为 8080 的服务所处理的。</p>
<h2 id="26，SpringBoot集成RabbitMQ">26，SpringBoot集成RabbitMQ</h2>
<h3 id="简介-2">简介</h3>
<p><strong>RabbitMQ 是一个由 Erlang 语言开发的 AMQP 的开源实现。</strong></p>
<p>AMQP ：Advanced Message Queue，高级消息队列协议。它是应用层协议的一个开放标准，为面向消息的中间件设计，基于此协议的客户端与消息中间件可传递消息，并不受产品、开发语言等条件的限制。</p>
<p>RabbitMQ 最初起源于金融系统，用于在分布式系统中存储转发消息，在易用性、扩展性、高可用性等方面表现不俗。具体特点包括：</p>
<ol>
<li>可靠性（Reliability）<br>
RabbitMQ 使用一些机制来保证可靠性，如持久化、传输确认、发布确认。</li>
<li>灵活的路由（Flexible Routing）<br>
在消息进入队列之前，通过 Exchange 来路由消息的。对于典型的路由功能，RabbitMQ 已经提供了一些内置的 Exchange 来实现。针对更复杂的路由功能，可以将多个 Exchange 绑定在一起，也通过插件机制实现自己的 Exchange 。</li>
<li>消息集群（Clustering）<br>
多个 RabbitMQ 服务器可以组成一个集群，形成一个逻辑 Broker 。</li>
<li>高可用（Highly Available Queues）<br>
队列可以在集群中的机器上进行镜像，使得在部分节点出问题的情况下队列仍然可用。</li>
<li>多种协议（Multi-protocol）<br>
RabbitMQ 支持多种消息队列协议，比如 STOMP、MQTT 等等。</li>
<li>多语言客户端（Many Clients）<br>
RabbitMQ 几乎支持所有常用语言，比如 Java、.NET、Ruby 等等。</li>
<li>管理界面（Management UI）<br>
RabbitMQ 提供了一个易用的用户界面，使得用户可以监控和管理消息 Broker 的许多方面。</li>
<li>跟踪机制（Tracing）<br>
如果消息异常，RabbitMQ 提供了消息跟踪机制，使用者可以找出发生了什么。</li>
<li>插件机制（Plugin System）<br>
RabbitMQ 提供了许多插件，来从多方面进行扩展，也可以编写自己的插件。</li>
</ol>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5C20190903141227300.png" alt="20190903141227300"></p>
<h3 id="安装和使用"><strong>安装和使用</strong></h3>
<p>首先在Linux中使用docker安装RabbitMQ ——执行以下命令</p>
<blockquote>
<p>docker run -d --hostname my-rabbit --name some-rabbit -p 15672:15672 -p 5672:5672   rabbitmq:3-management</p>
</blockquote>
<p><strong>说明：</strong></p>
<p>-p　　端口映射</p>
<p>–name　　容器实例名称</p>
<p>-d　　后台运行</p>
<p>5672　　客户端与rabbitmq通信端口</p>
<p>15672　　rabbitmq web管理端口　　访问http://ip:15672　　默认用户：guest　　默认密码：guest</p>
<p><strong>docker查看运行状态</strong></p>
<blockquote>
<p>docker ps</p>
</blockquote>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210611225137212.png" alt="image-20210611225137212"></p>
<p><strong>端口说明</strong></p>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">4369 -- erlang发现口</span><br><span class="line"></span><br><span class="line">5672 --client端通信口</span><br><span class="line"></span><br><span class="line">15672 -- 管理界面ui端口</span><br><span class="line"></span><br><span class="line">25672 -- server间内部通信口</span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong>在防火墙中开放指定端口</strong></p>
<p>开启指定端口</p>
<blockquote>
<p>firewall-cmd --zone=public --add-port=15672/tcp --permanent</p>
</blockquote>
<p>重启防火墙</p>
<blockquote>
<p>firewall-cmd --reload</p>
</blockquote>
<h3 id="交换机模式">交换机模式</h3>
<p>常用的交换机有以下三种，因为消费者是从队列获取信息的，队列是绑定交换机的（一般），所以对应的消息推送/接收模式也会有以下几种：</p>
<h4 id="Direct-Exchange">Direct Exchange</h4>
<p>直连型交换机，根据消息携带的路由键将消息投递给对应队列。</p>
<p>大致流程，有一个队列绑定到一个直连交换机上，同时赋予一个路由键 routing key 。<br>
然后当一个消息携带着路由值为X，这个消息通过生产者发送给交换机时，交换机就会根据这个路由值X去寻找绑定值也是X的队列。</p>
<h4 id="Fanout-Exchange">Fanout Exchange</h4>
<p>扇型交换机，这个交换机没有路由键概念，就算你绑了路由键也是无视的。 这个交换机在接收到消息后，会直接转发到绑定到它上面的所有队列。</p>
<h4 id="Topic-Exchange">Topic Exchange</h4>
<p>主题交换机，这个交换机其实跟直连交换机流程差不多，但是它的特点就是在它的路由键和绑定键之间是有规则的。<br>
简单地介绍下规则：</p>
<ul>
<li>(星号) 用来表示一个单词 (必须出现的)</li>
</ul>
<p>(井号) <strong>用来表示任意数量</strong>（零个或多个）单词</p>
<p>通配的绑定键是跟队列进行绑定的，举个小例子<br>
队列Q1 绑定键为 <em>.TT.</em>          队列Q2绑定键为  TT.#<br>
如果一条消息携带的路由键为 A.TT.B，那么队列Q1将会收到；<br>
<a target="_blank" rel="noopener" href="http://xn--TT-uu2cyis92cyrg89d7xjqsh2qag53cpvv53d9v2ibzwa.AA.BB">如果一条消息携带的路由键为TT.AA.BB</a>，那么队列Q2将会收到；</p>
<p>主题交换机是非常强大的，为啥这么膨胀？<br>
当一个队列的绑定键为 “#”（井号） 的时候，这个队列将会无视消息的路由键，接收所有的消息。<br>
当 * (星号) 和 # (井号) 这两个特殊字符都未在绑定键中出现的时候，此时主题交换机就拥有的直连交换机的行为。<br>
所以主题交换机也就实现了扇形交换机的功能，和直连交换机的功能。</p>
<p>另外还有 Header Exchange 头交换机 ，Default Exchange 默认交换机，Dead Letter Exchange 死信交换机，这几个该篇暂不做讲述。</p>
<h3 id="SpringBoot配置信息">SpringBoot配置信息</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">spring.rabbitmq.host=<span class="number">192.168</span><span class="number">.32</span><span class="number">.131</span></span><br><span class="line">spring.rabbitmq.username=xpp011</span><br><span class="line">spring.rabbitmq.password=xpp011</span><br><span class="line">spring.rabbitmq.port=<span class="number">5672</span></span><br></pre></td></tr></table></figure>
<h3 id="代码实现">代码实现</h3>
<h4 id="直连交换机模式（Direct-Exchange）"><strong>直连交换机模式（Direct Exchange）</strong></h4>
<p>RabbitDirectConfig</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//直连交换机配置</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RabbitDirectConfig</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DIRECTNAME=<span class="string">&quot;directExchange&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">queue</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//消息队列名字</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">&quot;directQueue&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">DirectExchange <span class="title">directExchange</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//DIRECTNAME 消息队列交换机的名字   true 重启后交换机是否有效   false  长期未使用是否删除</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DirectExchange(DIRECTNAME,<span class="keyword">true</span>,<span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将消息队列和交换机绑定在一起</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">Binding <span class="title">binding</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//bind消息队列     to 交换机   with 绑定后的名字</span></span><br><span class="line">        <span class="keyword">return</span>  BindingBuilder.bind(queue()).to(directExchange()).with(<span class="string">&quot;direct&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>消费者</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//消费者监听者</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DirectReceiver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//监听那个队列</span></span><br><span class="line">    <span class="meta">@RabbitListener( queues = &quot;directQueue&quot;)</span></span><br><span class="line">    <span class="comment">//处理方法1</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handler1</span><span class="params">(String msg)</span></span>&#123;			</span><br><span class="line">        System.out.println(<span class="string">&quot;handler1 -&gt; &quot;</span>+ msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//通过SpringBoot自带的模板进行消息发送  exchange 交换机的名字   routingKey 路由的名字      object 发送的消息体</span></span><br><span class="line">    rabbitTemplate.convertAndSend(<span class="string">&quot;directExchange&quot;</span>,<span class="string">&quot;direct&quot;</span>,<span class="string">&quot;你好 rabbit消息队列&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="扇形交换机（Fanout-Exchange）"><strong>扇形交换机（Fanout Exchange）</strong></h4>
<p>RabbitFanoutConfig配置类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RabbitFanoutConfig</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String FANOUTNAME=<span class="string">&quot;fanoutExchange&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">queueOne</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">&quot;fanoutQueueOne&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">queueTwo</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">&quot;fanoutQueueTwo&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">FanoutExchange <span class="title">fanoutExchange</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> FanoutExchange(FANOUTNAME,<span class="keyword">true</span>,<span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//扇形交换机转发时不需要绑定routingKey  它是直接群发到它绑定的路由上</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">Binding <span class="title">bindingOne</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  BindingBuilder.bind(queueOne()).to(fanoutExchange());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">Binding <span class="title">bindingTwo</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  BindingBuilder.bind(queueTwo()).to(fanoutExchange());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>监听类FanoutReceiver</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FanoutReceiver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;fanoutQueueOne&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ListenerOne</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ListenerOne -&gt; &quot;</span>+ msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;fanoutQueueTwo&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ListenerTwo</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ListenerTwo -&gt; &quot;</span>+ msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">FanoutTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//扇形交换机  无效写入routingKey</span></span><br><span class="line">    rabbitTemplate.convertAndSend(RabbitFanoutConfig.FANOUTNAME,<span class="keyword">null</span>,<span class="string">&quot;你好  扇形交换机转发&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="主题交换机-Topic-Exchange"><strong>主题交换机(Topic Exchange)</strong></h4>
<p>* <strong>(星号) 用来表示一个单词 (必须出现的)</strong><br>
# <strong>(井号) 用来表示任意数量（零个或多个）单词</strong></p>
<p>同时我们在写入toutingKey时，<font color="red">通配符连接点必须加.</font>  不然无法识别通配符</p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210612110138478.png" alt="image-20210612110138478"></p>
<p>RabbitTopicConfig配置类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RabbitTopicConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TOPICNAME=<span class="string">&quot;topicExchange&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">queueXiaoMi</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">&quot;XiaoMiQueue&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">queueSanXin</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">&quot;SanXinQueue&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">queueHuaVei</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">&quot;HuaWeiQueue&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">Topicqueue</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">&quot;TopicQueue&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">TopicExchange <span class="title">topicExchange</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> TopicExchange(TOPICNAME,<span class="keyword">true</span>,<span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">Binding <span class="title">Topicbinding</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(Topicqueue()).to(topicExchange()).with(<span class="string">&quot;Topic#&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">Binding <span class="title">XiaoMibinding</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queueXiaoMi()).to(topicExchange()).with(<span class="string">&quot;#.XiaoMi&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">Binding <span class="title">SanXinbinding</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queueSanXin()).to(topicExchange()).with(<span class="string">&quot;#.SanXin&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">Binding <span class="title">HuaVeibinding</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(queueHuaVei()).to(topicExchange()).with(<span class="string">&quot;#.HuaWei&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>监听类TopicReceiver</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TopicReceiver</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;XiaoMiQueue&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">XiaoMi</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;XiaoMi -&gt; &quot;</span>+ msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;SanXinQueue&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SanXin</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;SanXin -&gt; &quot;</span>+ msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;HuaWeiQueue&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">HuaWei</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;HuaWei -&gt; &quot;</span>+ msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;TopicQueue&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">queue</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;queue -&gt; &quot;</span>+ msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试类</p>
<p>当我们写入toutingKey时  它会去寻找符合匹配的toutingKey,并发送到绑定的路由上</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">TopicTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">    rabbitTemplate.convertAndSend(RabbitTopicConfig.TOPICNAME,<span class="string">&quot;Topic.XiaoMi&quot;</span>,<span class="string">&quot;你好小米&quot;</span>);</span><br><span class="line">    rabbitTemplate.convertAndSend(RabbitTopicConfig.TOPICNAME,<span class="string">&quot;Topic.HuaWei&quot;</span>,<span class="string">&quot;你好华为&quot;</span>);</span><br><span class="line">    rabbitTemplate.convertAndSend(RabbitTopicConfig.TOPICNAME,<span class="string">&quot;Topic.SanXin&quot;</span>,<span class="string">&quot;你好三星&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="SpringSecurity">SpringSecurity</h2>
<p><code>configure(HttpSecurity http)</code>方法设置登录成功处理器和登录失败处理器，返回JSON数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        http.authorizeRequests()</span><br><span class="line">                .antMatchers(<span class="string">&quot;/admin/**&quot;</span>).hasRole(<span class="string">&quot;admin&quot;</span>)</span><br><span class="line">                .antMatchers(<span class="string">&quot;/user/**&quot;</span>).hasAnyRole(<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;user&quot;</span>)</span><br><span class="line">                .anyRequest().authenticated()</span><br><span class="line">                .and()</span><br><span class="line">                .formLogin()</span><br><span class="line">                .loginProcessingUrl(<span class="string">&quot;/doLogin&quot;</span>)</span><br><span class="line">                .loginPage(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">                .usernameParameter(<span class="string">&quot;username&quot;</span>)</span><br><span class="line">                .passwordParameter(<span class="string">&quot;password&quot;</span>)</span><br><span class="line">                .successHandler(<span class="keyword">new</span> AuthenticationSuccessHandler() &#123;<span class="comment">//登录成功处理器</span></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAuthenticationSuccess</span><span class="params">(HttpServletRequest req, HttpServletResponse resp, Authentication authentication)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">                        resp.setContentType(<span class="string">&quot;application/json;charset=utf-8&quot;</span>);<span class="comment">//前后端分离返回JSON</span></span><br><span class="line">                        Map&lt;String,Object&gt; map=<span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">                        map.put(<span class="string">&quot;status&quot;</span>,<span class="number">200</span>);</span><br><span class="line">                        map.put(<span class="string">&quot;msg&quot;</span>,authentication.getPrincipal());</span><br><span class="line">                        PrintWriter out = resp.getWriter();</span><br><span class="line">                        out.write(<span class="keyword">new</span> ObjectMapper().writeValueAsString(map));</span><br><span class="line">                        out.flush();</span><br><span class="line">                        out.close();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">                .failureHandler(<span class="keyword">new</span> AuthenticationFailureHandler() &#123;<span class="comment">//登录失败处理器</span></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAuthenticationFailure</span><span class="params">(HttpServletRequest req, HttpServletResponse resp, AuthenticationException e)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">                        resp.setContentType(<span class="string">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class="line">                        Map&lt;String,Object&gt; map=<span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">                        map.put(<span class="string">&quot;status&quot;</span>,<span class="number">401</span>);<span class="comment">//登录失败  状态吗401</span></span><br><span class="line">                        <span class="keyword">if</span> (e <span class="keyword">instanceof</span> LockedException)&#123;</span><br><span class="line">                            map.put(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;账户被锁住，登录失败&quot;</span>);</span><br><span class="line">                        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> BadCredentialsException)&#123;</span><br><span class="line">                            map.put(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;用户名或者密码错误，登录失败&quot;</span>);</span><br><span class="line">                        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> DisabledException)&#123;</span><br><span class="line">                            map.put(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;账户被锁定，登录失败&quot;</span>);</span><br><span class="line">                        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                            map.put(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;登录失败&quot;</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                        PrintWriter out = resp.getWriter();</span><br><span class="line">                        out.write(<span class="keyword">new</span> ObjectMapper().writeValueAsString(map));</span><br><span class="line">                        out.flush();</span><br><span class="line">                        out.close();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">                .permitAll()<span class="comment">//注意书写顺序 permitAll一定放在最后</span></span><br><span class="line">                .and()</span><br><span class="line">                .csrf().disable();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="角色继承">角色继承</h3>
<p>该方法直接写在Security的配置类中即可</p>
<p>意思为角色为admin的可以干角色user的事</p>
<p>角色user的可以干visitor的事</p>
<p>注意两个关系之间需要以<code>\n</code>风格,可以看一眼源码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Security角色继承</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> RoleHierarchy <span class="title">roleHierarchy</span><span class="params">()</span></span>&#123;</span><br><span class="line">    RoleHierarchyImpl roleHierarchy=<span class="keyword">new</span> RoleHierarchyImpl();</span><br><span class="line">    String role=<span class="string">&quot;ROLE_admin &gt; ROLE_user \n ROLE_user &gt; ROLE_visitor&quot;</span>;</span><br><span class="line">    roleHierarchy.setHierarchy(role);</span><br><span class="line">    <span class="keyword">return</span> roleHierarchy;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Security动态权限管理">Security动态权限管理</h3>
<p><font color="red">关键类</font></p>
<ul>
<li><code>AntPathMatcher</code>            --Spring自带的路径匹配类</li>
<li><code>FilterInvocation</code>        --调用过滤器类，可获得请求地址</li>
<li><code>Authentication</code>            --包含用户登录信息</li>
<li><code>UserDetails</code>                --用户的详细说明接口，创建用户实体类时继承该接口</li>
<li><code>UserDetailsService</code>    --用户的服务层接口</li>
<li><code>WebSecurityConfigurerAdapter</code>      --自定义Security配置类需要继承的类</li>
<li><code>FilterInvocationSecurityMetadataSource</code>    --自定义过滤器类实现的接口(匹配当前路径的权限)</li>
<li><code>AccessDecisionManager</code>         --访问决策管理器（做出最终的访问控制（授权）决定。）</li>
</ul>
<p><strong>AuthenticationException子类异常详解</strong></p>
<p>这个异常是在登录的时候出现错误时抛出的异常，比如账户锁定，证书失效等，先来看下AuthenticationException常用的的子类：</p>
<p><code>UsernameNotFoundException</code> 用户找不到</p>
<p><code>BadCredentialsException </code>坏的凭据</p>
<p><code>AccountStatusException </code>用户状态异常它包含如下子类</p>
<p><code>AccountExpiredException</code> 账户过期</p>
<p><code>LockedException</code>账户锁定</p>
<p><code>DisabledException</code> 账户不可用</p>
<p><code>CredentialsExpiredException</code> 证书过期</p>
<p>User</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">UserDetails</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> Boolean enabled;</span><br><span class="line">    <span class="keyword">private</span> Boolean locked;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Role&gt; roles;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//getAuthorities获取权限</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Collection&lt;? extends GrantedAuthority&gt; getAuthorities() &#123;</span><br><span class="line">        List&lt;SimpleGrantedAuthority&gt; list=<span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Role role : roles) &#123;</span><br><span class="line">            list.add(<span class="keyword">new</span> SimpleGrantedAuthority(role.getName()));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//账户是否过期  true是没有</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isAccountNonExpired</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//用户是否被锁住 true是没有</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isAccountNonLocked</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> !locked;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//凭证是否过期 true是没有</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isCredentialsNonExpired</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//用户是否被激活 true是被激活</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEnabled</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> enabled;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//get  and set    .....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>UserService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> <span class="keyword">implements</span> <span class="title">UserDetailsService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//调用dao层接口  得到用户</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserDetails <span class="title">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException </span>&#123;</span><br><span class="line">        <span class="comment">//根据用户名得到用户</span></span><br><span class="line">        User user=userMapper.loadUserByUsername(username);</span><br><span class="line">        <span class="comment">//用户不存在抛异常</span></span><br><span class="line">        <span class="keyword">if</span> (user==<span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> UsernameNotFoundException(<span class="string">&quot;用户不存在&quot;</span>);</span><br><span class="line">        <span class="comment">//根据方法得到用户的权限</span></span><br><span class="line">        user.setRoles(userMapper.getRoleById(user.getId()));</span><br><span class="line">        <span class="comment">//返回用户</span></span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><font color="red">MyFilert</font></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="comment">//Security的过滤器管理器 调用</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFilter</span>  <span class="keyword">implements</span> <span class="title">FilterInvocationSecurityMetadataSource</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    MenuMapper menuMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Spring自带的路径匹配列类  支持通配符</span></span><br><span class="line">    <span class="keyword">static</span> AntPathMatcher antPathMatcher=<span class="keyword">new</span> AntPathMatcher();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Collection&lt;ConfigAttribute&gt; <span class="title">getAttributes</span><span class="params">(Object object)</span> <span class="keyword">throws</span> IllegalArgumentException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//转换为过滤器</span></span><br><span class="line">        FilterInvocation invocation=(FilterInvocation) object;</span><br><span class="line">        <span class="comment">//得到当前的请求地址</span></span><br><span class="line">        <span class="comment">//注意这里不用调用getFullRequestUrl方法  会得到全路径导致匹配不成功</span></span><br><span class="line">        String requestUrl=invocation.getRequestUrl();</span><br><span class="line">        System.out.println(<span class="string">&quot;当前请求地址 : &quot;</span>+requestUrl);</span><br><span class="line">        <span class="comment">//得到数据所有请求地址所需要的权限</span></span><br><span class="line">        List&lt;Menu&gt; menuAll = menuMapper.getMenuAll();</span><br><span class="line">        <span class="keyword">for</span> (Menu menu : menuAll) &#123;</span><br><span class="line">            <span class="comment">//判断当前的请求地址是否在数据库中记录</span></span><br><span class="line">            <span class="comment">//由于我们存在数据中的路径是带通配符的，所以使用antPathMatcher匹配</span></span><br><span class="line">            <span class="keyword">if</span> (antPathMatcher.match(menu.getPattern(),requestUrl))&#123;</span><br><span class="line">                <span class="comment">//得到当前地址需要的权限</span></span><br><span class="line">                List&lt;Role&gt; roles = menu.getRoles();</span><br><span class="line">                <span class="comment">//由于该方法返回Collection类型  所以先将权限的名字取出 放到String数组中</span></span><br><span class="line">                String [] res=<span class="keyword">new</span> String[roles.size()];</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; roles.size(); i++) &#123;</span><br><span class="line">                    res[i]=roles.get(i).getName();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//通过SecurityConfig的createList的类型转换后得到Collection类型</span></span><br><span class="line">                <span class="keyword">return</span> SecurityConfig.createList(res);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//如果当前地址不在数据库记录  则该地址只需要登录即可浏览</span></span><br><span class="line">        <span class="keyword">return</span> SecurityConfig.createList(<span class="string">&quot;ROLE_login&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Collection&lt;ConfigAttribute&gt; <span class="title">getAllConfigAttributes</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//返回值为true</span></span><br><span class="line">    <span class="comment">//这里clazz表示安全对象的类型，该方法用于告知调用者当前SecurityMetadataSource是否支持此类安全对象，只有支持的时候，才能对这类安全对象调用getAttributes方法。</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supports</span><span class="params">(Class&lt;?&gt; clazz)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><font color="red">MyAccessDecisionManager</font></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//访问决策管理器</span></span><br><span class="line"><span class="comment">//做出最终的访问控制（授权）决定。</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAccessDecisionManager</span> <span class="keyword">implements</span> <span class="title">AccessDecisionManager</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//configAttributes参数 即MyFilter类的getAttributes方法返回的权限名字</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">decide</span><span class="params">(Authentication authentication, Object object, Collection&lt;ConfigAttribute&gt; configAttributes)</span> <span class="keyword">throws</span> AccessDeniedException, InsufficientAuthenticationException </span>&#123;</span><br><span class="line">        <span class="comment">//获取当前用户的权限</span></span><br><span class="line">        Collection&lt;? extends GrantedAuthority&gt; authorities = authentication.getAuthorities();</span><br><span class="line">        <span class="keyword">for</span> (ConfigAttribute configAttribute : configAttributes) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">&quot;ROLE_login&quot;</span>.equals(configAttribute.getAttribute()))&#123;</span><br><span class="line">                <span class="comment">//AnonymousAuthenticationToken匿名认证失败的令牌</span></span><br><span class="line">                <span class="keyword">if</span> (authentication <span class="keyword">instanceof</span> AnonymousAuthenticationToken)&#123;</span><br><span class="line">                    <span class="comment">//拒绝访问异常</span></span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> AccessDeniedException(<span class="string">&quot;非法请求&quot;</span>);</span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (GrantedAuthority authority : authorities) &#123;</span><br><span class="line">                <span class="comment">//configAttribute.getAttribute() 获取属性</span></span><br><span class="line">                <span class="comment">//authority.getAuthority()  获取权限</span></span><br><span class="line">                <span class="keyword">if</span> (configAttribute.getAttribute().equals(authority.getAuthority()))&#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> AccessDeniedException(<span class="string">&quot;非法请求&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//支持安全类型对象</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supports</span><span class="params">(ConfigAttribute attribute)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supports</span><span class="params">(Class&lt;?&gt; clazz)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><font color="red">SecurityConfig</font></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    PasswordEncoder passwordEncoder;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    MyAccessDecisionManager myAccessDecisionManager;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    MyFilter myFilter;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function">PasswordEncoder <span class="title">passwordEncoder</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  PasswordEncoderFactories.createDelegatingPasswordEncoder();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//配置加密方式</span></span><br><span class="line">        auth.userDetailsService(userService).passwordEncoder(passwordEncoder);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//withObjectPostProcessor  写入处理器</span></span><br><span class="line">        <span class="comment">//FilterSecurityInterceptor Security的调用过滤器</span></span><br><span class="line">        http.authorizeRequests().withObjectPostProcessor(<span class="keyword">new</span> ObjectPostProcessor&lt;FilterSecurityInterceptor&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> &lt;O extends FilterSecurityInterceptor&gt; <span class="function">O <span class="title">postProcess</span><span class="params">(O object)</span> </span>&#123;</span><br><span class="line">                <span class="comment">//设置自定的访问决策管理器</span></span><br><span class="line">                object.setAccessDecisionManager(myAccessDecisionManager);</span><br><span class="line">                <span class="comment">//设置Security的数据源  即从数据库中的得到访问地址所需权限</span></span><br><span class="line">                object.setSecurityMetadataSource(myFilter);</span><br><span class="line">                <span class="keyword">return</span> object;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        .and()</span><br><span class="line">        .formLogin()</span><br><span class="line">        .permitAll()</span><br><span class="line">        .and().csrf().disable();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="Security-JSON登录">Security  JSON登录</h3>
<p>通过阅读<code>UsernamePasswordAuthenticationFilter</code>源码,我们得知，Security是通过request请求得到Username的，这种形式经常在servlet出现,那也就是Security是能通过表单登录，而无法通过JSON登录，这样对前后端分离是不友好的</p>
<p><img src="/.cn//D:%5Cwin10%E6%A1%8C%E9%9D%A2%E5%AD%98%E6%94%BE%5CSpring%5C%E7%AC%94%E8%AE%B0%5CSpringBoot.assets%5Cimage-20210610182151951.png" alt="image-20210610182151951"></p>
<p>更改<code>UsernamePasswordAuthenticationFilter</code>，使其支持JSON登录，注意只是扩展功能，不是重写</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自定义的Username和Password过滤器 增加了JSON登录的格式</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyUsernamePasswordAuthenticationFilter</span> <span class="keyword">extends</span> <span class="title">UsernamePasswordAuthenticationFilter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Authentication <span class="title">attemptAuthentication</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!request.getMethod().equals(<span class="string">&quot;POST&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> AuthenticationServiceException(<span class="string">&quot;Authentication method not supported: &quot;</span> + request.getMethod());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//判断前端是否传递过来的格式是否为JSON格式</span></span><br><span class="line">        <span class="keyword">if</span> (request.getContentType().equals(MediaType.APPLICATION_JSON_VALUE))&#123;</span><br><span class="line">            Map&lt;String,String&gt; map;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//通过IO的形式解析request的Username和Password数据</span></span><br><span class="line">                map = <span class="keyword">new</span> ObjectMapper().readValue(request.getInputStream(), Map.class);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> AuthenticationServiceException(<span class="string">&quot;Authentication method not supported: &quot;</span> + request.getMethod());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            String username = map.get(<span class="string">&quot;username&quot;</span>);</span><br><span class="line"></span><br><span class="line">            username = (username != <span class="keyword">null</span>) ? username : <span class="string">&quot;&quot;</span>;</span><br><span class="line">            username = username.trim();</span><br><span class="line">            String password = map.get(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">            password = (password != <span class="keyword">null</span>) ? password : <span class="string">&quot;&quot;</span>;</span><br><span class="line">            System.out.println(<span class="string">&quot;JSON解析：&quot;</span>+username+<span class="string">&quot;:&quot;</span>+password);</span><br><span class="line">            UsernamePasswordAuthenticationToken authRequest = <span class="keyword">new</span> UsernamePasswordAuthenticationToken(username, password);</span><br><span class="line">            <span class="comment">// Allow subclasses to set the &quot;details&quot; property</span></span><br><span class="line">            setDetails(request, authRequest);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.getAuthenticationManager().authenticate(authRequest);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.attemptAuthentication(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编写好自定的登录过滤器后，将其添加在<code>UsernamePasswordAuthenticationFilter</code>内部</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"> ...</span><br><span class="line">        <span class="comment">//添加自定义过滤器到UsernamePasswordAuthenticationFilter</span></span><br><span class="line">        http.addFilterAt(myAuthenticationFilter(),UsernamePasswordAuthenticationFilter.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将自定义的登录过滤器创建</span></span><br><span class="line">    <span class="function">MyUsernamePasswordAuthenticationFilter <span class="title">myAuthenticationFilter</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        MyUsernamePasswordAuthenticationFilter filter = <span class="keyword">new</span> MyUsernamePasswordAuthenticationFilter();</span><br><span class="line">        <span class="comment">//设置权限管理</span></span><br><span class="line">        filter.setAuthenticationManager(authenticationManagerBean());</span><br><span class="line">        <span class="keyword">return</span> filter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Security整合WebSocket">Security整合WebSocket</h3>
<p>文档参考：<a target="_blank" rel="noopener" href="https://developer.aliyun.com/article/763747">https://developer.aliyun.com/article/763747</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/achenyuan/article/details/80851512#java-config%E9%85%8D%E7%BD%AE">https://blog.csdn.net/achenyuan/article/details/80851512#java-config配置</a></p>
<p>HTTP 协议是一种无状态的、无连接的、单向的应用层协议。它采用了请求/响应模型。通信请求只能由客户端发起，服务端对请求做出应答处理。这种通信模型有一个弊端：HTTP 协议无法实现服务器主动向客户端发起消息。<br>
这种单向请求的缺点，如果服务器有连续的状态变化，客户端要获知就非常麻烦。大多数 Web 应用程序将通过频繁的异步JavaScript和XML（AJAX）请求实现长轮询。轮询的效率低，非常浪费资源（因为必须不停连接，或者 HTTP 连接始终打开）。</p>
<p>WebSocket 连接允许客户端和服务器之间进行全双工通信，以便任一方都可以通过建立的连接将数据推送到另一端。WebSocket 只需要建立一次连接，就可以一直保持连接状态。这相比于轮询方式的不停建立连接显然效率要大大提高。</p>
<p><font color="red">点对面</font>(对所有在线的用户广播消息)</p>
<p>首先导入依赖，maven导入方便管理</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--导入WebSocket的依赖包  maven导入方便管理--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.webjars/sockjs-client --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.webjars<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sockjs-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.webjars/jquery --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.webjars<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jquery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.6.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.webjars/stomp-websocket --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.webjars<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>stomp-websocket<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.webjars/webjars-locator-core --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.webjars<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>webjars-locator-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.47<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>WebSocket的配置类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//WebSocket的配置类</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">//开启对WebSocket的支持</span></span><br><span class="line"><span class="meta">@EnableWebSocketMessageBroker</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSocketConfig</span> <span class="keyword">implements</span> <span class="title">WebSocketMessageBrokerConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//配置消息代理</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureMessageBroker</span><span class="params">(MessageBrokerRegistry registry)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//配置一个广播式的消息代理  前缀是&quot;/topic&quot;</span></span><br><span class="line">        registry.enableSimpleBroker(<span class="string">&quot;/topic&quot;</span>);</span><br><span class="line">        <span class="comment">//上面的是通过代理类处理消息  而这里是配置使用方法处理消息 凡是前缀为/app开头的就是通过方法处理消息</span></span><br><span class="line">        registry.setApplicationDestinationPrefixes(<span class="string">&quot;/app&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//配置连接点  注册STOMP协议的节点，并映射到指定的URL</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerStompEndpoints</span><span class="params">(StompEndpointRegistry registry)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//注册一个STOMP协议的endpoint,并指定使用SockJS协议</span></span><br><span class="line">        registry.addEndpoint(<span class="string">&quot;/chat&quot;</span>).withSockJS();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>处理消息的Controller类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GreetingController</span> </span>&#123;</span><br><span class="line">    <span class="comment">//当浏览器向服务器发送STOMP请求时，通过@MessageMapping注解来映射/hello地址</span></span><br><span class="line">    <span class="meta">@MessageMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="comment">//当服务器有消息时，会对订阅了@SenfTo的路径的客户端发送消息</span></span><br><span class="line">    <span class="meta">@SendTo(&quot;/topic/greetings&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Message <span class="title">greeting</span><span class="params">(Message message)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>前端页面</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/webjars/jquery/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/webjars/sockjs-client/sockjs.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/webjars/stomp-websocket/stomp.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>请输入用户名<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;name&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">id</span>=<span class="string">&quot;connect&quot;</span> <span class="attr">value</span>=<span class="string">&quot;连接&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">disabled</span>=<span class="string">&quot;disabled&quot;</span> <span class="attr">id</span>=<span class="string">&quot;disconnect&quot;</span> <span class="attr">value</span>=<span class="string">&quot;断开连接&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;chat&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>请输入聊天内容<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;content&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">id</span>=<span class="string">&quot;send&quot;</span> <span class="attr">value</span>=<span class="string">&quot;发送&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;conversation&quot;</span>&gt;</span>群聊进行中....<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">        $(<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;#connect&quot;</span>).click(</span></span><br><span class="line"><span class="javascript">                <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="comment">/*开启连接方法*/</span></span></span><br><span class="line"><span class="javascript">                    connect()</span></span><br><span class="line"><span class="javascript">                &#125;</span></span><br><span class="line"><span class="javascript">            )</span></span><br><span class="line"><span class="javascript">            <span class="comment">//断开连接点击事件</span></span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;#disconnect&quot;</span>).click(</span></span><br><span class="line"><span class="javascript">                <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">if</span> (stompClient != <span class="literal">null</span>)&#123;</span></span><br><span class="line"><span class="javascript">                        <span class="comment">//断开连接</span></span></span><br><span class="line"><span class="javascript">                        stompClient.disconnect();</span></span><br><span class="line"><span class="javascript">                    &#125;</span></span><br><span class="line"><span class="javascript">                    <span class="comment">//设置连接和断开连接按钮的状态</span></span></span><br><span class="line"><span class="javascript">                    setConnected(<span class="literal">false</span>);</span></span><br><span class="line"><span class="javascript">                &#125;</span></span><br><span class="line"><span class="javascript">            )</span></span><br><span class="line"><span class="javascript">            <span class="comment">//发送按钮点击事件</span></span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;#send&quot;</span>).click(</span></span><br><span class="line"><span class="javascript">                <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="comment">//连接点代理类 发送连接          将JSON解析成字符串</span></span></span><br><span class="line"><span class="javascript">                    stompClient.send(<span class="string">&quot;/app/hello&quot;</span>,&#123;&#125;,<span class="built_in">JSON</span>.stringify(&#123;<span class="string">&quot;name&quot;</span>:$(<span class="string">&quot;#name&quot;</span>).val(),<span class="string">&quot;content&quot;</span>:$(<span class="string">&quot;#content&quot;</span>).val()&#125;))</span></span><br><span class="line"><span class="javascript">                &#125;</span></span><br><span class="line"><span class="javascript">            )</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">        )</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> stompClient =<span class="literal">null</span>;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">connect</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">/*name为空时直接返回*/</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (!$(<span class="string">&quot;#name&quot;</span>).val())&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">return</span>;</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">            <span class="comment">//创建SockJS 并连接 连接点（/chat）</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> socket=<span class="keyword">new</span> SockJS(<span class="string">&quot;/chat&quot;</span>);</span></span><br><span class="line"><span class="javascript">            <span class="comment">//创建STOMP客户端代理 地址为chat的代理</span></span></span><br><span class="line"><span class="javascript">            stompClient=Stomp.over(socket);</span></span><br><span class="line"><span class="javascript">            <span class="comment">//开启连接</span></span></span><br><span class="line"><span class="javascript">            stompClient.connect(&#123;&#125;,<span class="function"><span class="keyword">function</span> (<span class="params">success</span>)</span>&#123;<span class="comment">//成功的回调函数</span></span></span><br><span class="line"><span class="javascript">                <span class="comment">//调整连接按钮和断开连接按钮</span></span></span><br><span class="line"><span class="javascript">                setConnected(<span class="literal">true</span>);</span></span><br><span class="line"><span class="javascript">                <span class="comment">//订阅广播地址   当该地址发送消息时 回调函数 msg</span></span></span><br><span class="line"><span class="javascript">                stompClient.subscribe(<span class="string">&quot;/topic/greetings&quot;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">msg</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="comment">//将msg的body的信息解析成JSON</span></span></span><br><span class="line"><span class="javascript">                    <span class="comment">//showGreeting方法 将接收的信息设置到页面上</span></span></span><br><span class="line"><span class="javascript">                    showGreeting(<span class="built_in">JSON</span>.parse(msg.body));</span></span><br><span class="line"><span class="javascript">                &#125;);</span></span><br><span class="line"><span class="javascript">            &#125;)</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">//连接和断开连接按钮的状态</span></span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">setConnected</span>(<span class="params">flag</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;#connect&quot;</span>).prop(<span class="string">&quot;disabled&quot;</span>,flag);</span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;#disconnect&quot;</span>).prop(<span class="string">&quot;disabled&quot;</span>,!flag);</span></span><br><span class="line"><span class="javascript">            <span class="comment">//消息列表的隐藏和显示</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (flag)&#123;</span></span><br><span class="line"><span class="javascript">                $(<span class="string">&quot;#chat&quot;</span>).show();</span></span><br><span class="line"><span class="javascript">            &#125;<span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">                $(<span class="string">&quot;#chat&quot;</span>).hide();</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">//将消息添加到末尾</span></span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">showGreeting</span>(<span class="params">msg</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;#conversation&quot;</span>).append(<span class="string">&quot;&lt;div&gt;&quot;</span>+msg.name+<span class="string">&quot;:&quot;</span>+msg.content+<span class="string">&quot;&lt;/div&gt;&quot;</span>);</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><font color="red">点对点</font>（将消息发送到指定用户上）</p>
<p>由于引入了用户的概念  ，导入 Security依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>配置点对点发送的请求路径</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//WebSocket的配置类</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">//开启对WebSocket的支持</span></span><br><span class="line"><span class="meta">@EnableWebSocketMessageBroker</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSocketConfig</span> <span class="keyword">implements</span> <span class="title">WebSocketMessageBrokerConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//配置消息代理</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureMessageBroker</span><span class="params">(MessageBrokerRegistry registry)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//配置一个广播式的消息代理  前缀是&quot;/topic&quot;  点对点消息路径  前缀是/queue</span></span><br><span class="line">        registry.enableSimpleBroker(<span class="string">&quot;/topic&quot;</span>,<span class="string">&quot;/queue&quot;</span>);</span><br><span class="line">        <span class="comment">//上面的是通过代理类处理消息  而这里是配置使用方法处理消息 凡是前缀为/app开头的就是通过方法处理消息</span></span><br><span class="line">        registry.setApplicationDestinationPrefixes(<span class="string">&quot;/app&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//配置连接点  注册STOMP协议的节点，并映射到指定的URL</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerStompEndpoints</span><span class="params">(StompEndpointRegistry registry)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//注册一个STOMP协议的endpoint,并指定使用SockJS协议</span></span><br><span class="line">        registry.addEndpoint(<span class="string">&quot;/chat&quot;</span>).withSockJS();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>点对点的Controller类</p>
<p>这里使用了SpringBoot的自动配置类 ，SimpMessagingTemplate消息模板，它可以指定用户发送</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GreetingController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Spring自带的消息模板</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    SimpMessagingTemplate messagingTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//当浏览器向服务器发送STOMP请求时，通过@MessageMapping注解来映射/hello地址</span></span><br><span class="line">    <span class="meta">@MessageMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="comment">//当服务器有消息时，会对订阅了@SenfTo的路径的客户端发送消息</span></span><br><span class="line">    <span class="meta">@SendTo(&quot;/topic/greetings&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Message <span class="title">greeting</span><span class="params">(Message message)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@MessageMapping(&quot;/one&quot;)</span></span><br><span class="line">    <span class="comment">//点对点聊天</span></span><br><span class="line">    <span class="comment">//Principal当前用户</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">one</span><span class="params">(Principal principal, Chat chat)</span></span>&#123;</span><br><span class="line">        <span class="comment">//设置当前用户的名字</span></span><br><span class="line">        chat.setFrom(principal.getName());</span><br><span class="line">        <span class="comment">//通过convertAndSendToUser方法将消息发送给指定用户名字  接收人的名字   发送的请求  发送的请求体</span></span><br><span class="line">        messagingTemplate.convertAndSendToUser(chat.getTo(),<span class="string">&quot;/queue/greetings&quot;</span>,chat);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>前端页面</p>
<p><font color="red">注意一旦使用点对点  就要在指定的发送路径上加上/user前缀!!!</font></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/webjars/jquery/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/webjars/sockjs-client/sockjs.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/webjars/stomp-websocket/stomp.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">id</span>=<span class="string">&quot;connect&quot;</span> <span class="attr">value</span>=<span class="string">&quot;连接&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">disabled</span>=<span class="string">&quot;disabled&quot;</span> <span class="attr">id</span>=<span class="string">&quot;disconnect&quot;</span> <span class="attr">value</span>=<span class="string">&quot;断开连接&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>接送人<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;toname&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;chat&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span>请输入聊天内容<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;content&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">id</span>=<span class="string">&quot;send&quot;</span> <span class="attr">value</span>=<span class="string">&quot;发送&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;conversation&quot;</span>&gt;</span>群聊进行中....<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">        $(<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;#connect&quot;</span>).click(</span></span><br><span class="line"><span class="javascript">                <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="comment">/*开启连接方法*/</span></span></span><br><span class="line"><span class="javascript">                    connect()</span></span><br><span class="line"><span class="javascript">                &#125;</span></span><br><span class="line"><span class="javascript">            )</span></span><br><span class="line"><span class="javascript">            <span class="comment">//断开连接点击事件</span></span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;#disconnect&quot;</span>).click(</span></span><br><span class="line"><span class="javascript">                <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">if</span> (stompClient != <span class="literal">null</span>)&#123;</span></span><br><span class="line"><span class="javascript">                        <span class="comment">//断开连接</span></span></span><br><span class="line"><span class="javascript">                        stompClient.disconnect();</span></span><br><span class="line"><span class="javascript">                    &#125;</span></span><br><span class="line"><span class="javascript">                    <span class="comment">//设置连接和断开连接按钮的状态</span></span></span><br><span class="line"><span class="javascript">                    setConnected(<span class="literal">false</span>);</span></span><br><span class="line"><span class="javascript">                &#125;</span></span><br><span class="line"><span class="javascript">            )</span></span><br><span class="line"><span class="javascript">            <span class="comment">//发送按钮点击事件</span></span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;#send&quot;</span>).click(</span></span><br><span class="line"><span class="javascript">                <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="comment">//接收人未指定直接返回</span></span></span><br><span class="line"><span class="javascript">                    <span class="keyword">if</span> (!$(<span class="string">&quot;#toname&quot;</span>).val())&#123;</span></span><br><span class="line"><span class="javascript">                        <span class="keyword">return</span>;</span></span><br><span class="line"><span class="javascript">                    &#125;</span></span><br><span class="line"><span class="javascript">                    <span class="comment">//连接点代理类 发送连接          将JSON解析成字符串</span></span></span><br><span class="line"><span class="javascript">                    stompClient.send(<span class="string">&quot;/app/one&quot;</span>,&#123;&#125;,<span class="built_in">JSON</span>.stringify(&#123;<span class="string">&quot;to&quot;</span>:$(<span class="string">&quot;#toname&quot;</span>).val(),<span class="string">&quot;content&quot;</span>:$(<span class="string">&quot;#content&quot;</span>).val()&#125;))</span></span><br><span class="line"><span class="javascript">                &#125;</span></span><br><span class="line"><span class="javascript">            )</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">        )</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> stompClient =<span class="literal">null</span>;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">connect</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">//创建SockJS 并连接 连接点（/chat）</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> socket=<span class="keyword">new</span> SockJS(<span class="string">&quot;/chat&quot;</span>);</span></span><br><span class="line"><span class="javascript">            <span class="comment">//创建STOMP客户端代理 地址为chat的代理</span></span></span><br><span class="line"><span class="javascript">            stompClient=Stomp.over(socket);</span></span><br><span class="line"><span class="javascript">            <span class="comment">//开启连接</span></span></span><br><span class="line"><span class="javascript">            stompClient.connect(&#123;&#125;,<span class="function"><span class="keyword">function</span> (<span class="params">success</span>)</span>&#123;<span class="comment">//成功的回调函数</span></span></span><br><span class="line"><span class="javascript">                <span class="comment">//调整连接按钮和断开连接按钮</span></span></span><br><span class="line"><span class="javascript">                setConnected(<span class="literal">true</span>);</span></span><br><span class="line"><span class="javascript">                <span class="comment">//订阅广播地址   当该地址发送消息时 回调函数 msg</span></span></span><br><span class="line"><span class="javascript">                <span class="comment">//注意一旦使用点对点  就要在指定的发送路径上加上/user前缀!!!!!!!!</span></span></span><br><span class="line"><span class="javascript">                stompClient.subscribe(<span class="string">&quot;/user/queue/greetings&quot;</span>,<span class="function"><span class="keyword">function</span> (<span class="params">msg</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="comment">//将msg的body的信息解析成JSON</span></span></span><br><span class="line"><span class="javascript">                    <span class="comment">//showGreeting方法 将接收的信息设置到页面上</span></span></span><br><span class="line"><span class="javascript">                    showGreeting(<span class="built_in">JSON</span>.parse(msg.body));</span></span><br><span class="line"><span class="javascript">                &#125;);</span></span><br><span class="line"><span class="javascript">            &#125;)</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">//连接和断开连接按钮的状态</span></span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">setConnected</span>(<span class="params">flag</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;#connect&quot;</span>).prop(<span class="string">&quot;disabled&quot;</span>,flag);</span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;#disconnect&quot;</span>).prop(<span class="string">&quot;disabled&quot;</span>,!flag);</span></span><br><span class="line"><span class="javascript">            <span class="comment">//消息列表的隐藏和显示</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span> (flag)&#123;</span></span><br><span class="line"><span class="javascript">                $(<span class="string">&quot;#chat&quot;</span>).show();</span></span><br><span class="line"><span class="javascript">            &#125;<span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">                $(<span class="string">&quot;#chat&quot;</span>).hide();</span></span><br><span class="line"><span class="javascript">            &#125;</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">//将消息添加到末尾</span></span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">showGreeting</span>(<span class="params">msg</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;#conversation&quot;</span>).append(<span class="string">&quot;&lt;div&gt;&quot;</span>+msg.from+<span class="string">&quot;:&quot;</span>+msg.content+<span class="string">&quot;&lt;/div&gt;&quot;</span>);</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="报错">报错</h2>
<h3 id="There-is-no-PasswordEncoder-mapped-for-the-id-“null”">There is no PasswordEncoder mapped for the id “null”</h3>
<p>该报错是因为我们在往数据库写入密码是没有加上<code>BCryptPasswordEncoder</code><font color="red">特有的ID加密方式</font></p>
<p>在每一个经过<code>BCryptPasswordEncoder</code>加密的字符串都会有{id}</p>
<p>我们来看一下官方文档:</p>
<p>The general format for a password is:</p>
<p>{id}encodedPassword</p>
<p>这样，id是一个标识符，用于查找应该使用哪个PasswordEncoder，而encodedPassword是所选PasswordEncoder的原始编码密码。id必须在密码的开头，以{开头，密码}结尾。如果找不到id, 密码将为空。例如，下面可能是使用不同id编码的密码列表。所有原始密码都是“password”</p>
<p>{bcrypt}$2a$10$dXJ3SW6G7P50lGmMkkmwe.20cQQubK3.HZWzG3YB1tlRy.fqvM/BG</p>
<p>{noop}password</p>
<p>{pbkdf2}5d923b44a6d129f3ddf3e3c8d29412723dcbde72445e8ef6bf3b508fbf17fa4ed4d6b99ca763d8dc</p>
<p>{scrypt}$e0801$8bWJaSu2IKSn9Z9kM+TPXfOc/9bdYSrN1oD9qfVThWEwdRTnO7re7Ei+fUZRJ68k9lTyuTeUp4of4g24hHnazw==$OAOec05+bXxvuu/1qZ6NUR+xQYvYv7BeL1QxwRpY5Pc=</p>
<p>{sha256}97cde38028ad898ebc02e690819fa220e88c62e0699403e94fff291cfffaf8410849f27605abcbc0</p>
<p><font color="red">解决方法</font></p>
<p>在数据库的密码字段上{id}的方式</p>
<p>尝试{bcrypt},{pbkdf2},{scrypt}</p>

    </div>

    
    
    
    
    <div>
	    
		    
<div class="my_post_copyright">
  <script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

  <script src="https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js"></script>
   <!-- JS库 sweetalert 引用本地路径 -->
  <script src="/js/sweetalert.min.js"></script>
  <p><span>文章作者:</span><a href="/" title="访问 xpp011 的个人博客">xpp011</a></p>
  <p><span>发布时间:</span>2021年11月06日 - 15:11</p>
  <p><span>原始链接:</span><a href="/2021/11/06/SpringBoot%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="SpringBoot学习笔记">http://xpp011.cn/2021/11/06/SpringBoot%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</a>
    <span class="copy-path"  title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="http://xpp011.cn/2021/11/06/SpringBoot%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"  aria-label="复制成功！"></i></span>
  </p>
  <p><span>许可协议:</span> 转载请保留原文链接及作者。</p>  
</div>
<script> 
    var clipboard = new Clipboard('.fa-clipboard');
      $(".fa-clipboard").click(function(){
      clipboard.on('success', function(){
        swal({   
          title: "",   
          text: '复制成功',
          icon: "success", 
          showConfirmButton: true
          });
        });
    });  
</script>


	    
    </div>
        <div class="reward-container">
  <div></div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    赏个鸡腿? 半个也行!
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.png" alt="xpp011 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.png" alt="xpp011 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>


      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/%E7%AC%94%E8%AE%B0/" rel="tag"><i class="fa fa-tag"></i> 笔记</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/11/06/Spring%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="prev" title="Spring学习笔记">
      <i class="fa fa-chevron-left"></i> Spring学习笔记
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/11/06/SpringMVC%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="next" title="SpringMVC学习笔记">
      SpringMVC学习笔记 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-text">SpringBoot</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1%EF%BC%8C%E4%BB%80%E4%B9%88%E6%98%AFSpringboot"><span class="nav-text">1，什么是Springboot</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2%EF%BC%8C%E4%BB%80%E4%B9%88%E6%98%AF%E5%BE%AE%E6%9C%8D%E5%8A%A1"><span class="nav-text">2，什么是微服务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1"><span class="nav-text">微服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A3%8E%E6%A0%BC%E7%9A%84%E7%89%B9%E6%80%A7"><span class="nav-text">微服务风格的特性</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3%EF%BC%8C%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AASpringBoot%E9%A1%B9%E7%9B%AE"><span class="nav-text">3，创建一个SpringBoot项目</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4%EF%BC%8CSpringBoot%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D%E5%8E%9F%E7%90%86"><span class="nav-text">4，SpringBoot自动装配原理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E4%BE%9D%E8%B5%96"><span class="nav-text">核心依赖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8%E5%99%A8"><span class="nav-text">启动器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D"><span class="nav-text">自动装配</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5%EF%BC%8C%E5%A4%9A%E7%8E%AF%E5%A2%83%E5%A4%9A%E9%85%8D%E7%BD%AE"><span class="nav-text">5，多环境多配置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6%EF%BC%8CSpringBoot%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D%E5%86%8D%E7%90%86%E8%A7%A3"><span class="nav-text">6，SpringBoot自动装配再理解</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7%EF%BC%8C-Conditional%E6%B3%A8%E8%A7%A3"><span class="nav-text">7，@Conditional注解</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8%EF%BC%8CWEB%E5%BC%80%E5%8F%91"><span class="nav-text">8，WEB开发</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%84%E7%90%86%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90"><span class="nav-text">处理静态资源</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9%EF%BC%8C%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E"><span class="nav-text">9，模板引擎</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Thymeleaf"><span class="nav-text">使用Thymeleaf</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%89%8D%E6%8F%90"><span class="nav-text">前提</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8"><span class="nav-text">使用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E9%85%8D%E7%BD%AE%E7%B1%BB"><span class="nav-text">查看配置类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%AD%E6%B3%95"><span class="nav-text">语法</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10%EF%BC%8C%E6%89%A9%E5%B1%95SpringMVC%E9%85%8D%E7%BD%AE"><span class="nav-text">10，扩展SpringMVC配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E4%BA%8E%E6%B3%A8%E8%A7%A3-EnableWebMvc"><span class="nav-text">关于注解@EnableWebMvc</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11%EF%BC%8C%E7%BB%83%E4%B9%A0"><span class="nav-text">11，练习</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%EF%BC%8C%E5%9B%BD%E9%99%85%E5%8C%96"><span class="nav-text">1，国际化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%EF%BC%8C%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="nav-text">2，拦截器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12%EF%BC%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%BF%9E%E6%8E%A5%E4%B8%8E%E9%85%8D%E7%BD%AE"><span class="nav-text">12，数据库的连接与配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%EF%BC%8CJDBC"><span class="nav-text">1，JDBC</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%EF%BC%8C%E9%9B%86%E6%88%90Druid"><span class="nav-text">2，集成Druid</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Druid-%E7%AE%80%E4%BB%8B"><span class="nav-text">Druid 简介</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E7%89%B9%E7%82%B9"><span class="nav-text">基本特点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-text">应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Druid"><span class="nav-text">使用Druid</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%EF%BC%8C%E6%95%B4%E5%90%88Mybatis%E6%A1%86%E6%9E%B6"><span class="nav-text">3，整合Mybatis框架</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Mapper%E6%B3%A8%E8%A7%A3%E7%9A%84%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="nav-text">@Mapper注解的的作用</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13%EF%BC%8CSpringSecurity"><span class="nav-text">13，SpringSecurity</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#13-1%EF%BC%8CSpringSecurity%E5%92%8Cthymeleaf%E6%95%B4%E5%90%88"><span class="nav-text">13.1，SpringSecurity和thymeleaf整合</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#14%EF%BC%8CShiro"><span class="nav-text">14，Shiro</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B"><span class="nav-text">简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Shiro"><span class="nav-text">使用Shiro</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Shiro%E8%AE%B0%E4%BD%8F%E6%88%91"><span class="nav-text">Shiro记住我</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Shiro%E5%92%8Cthymeleaf%E6%95%B4%E5%90%88"><span class="nav-text">Shiro和thymeleaf整合</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#15%EF%BC%8CSwagger"><span class="nav-text">15，Swagger</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1%EF%BC%8C%E4%BB%8B%E7%BB%8D"><span class="nav-text">1，介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2%EF%BC%8Cspringfox%E4%BB%8B%E7%BB%8D"><span class="nav-text">2，springfox介绍</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3%EF%BC%8Cspringfox-swagger-2"><span class="nav-text">3，springfox-swagger 2</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4%EF%BC%8CSpringFox-3-0-0-%E5%8F%91%E5%B8%83"><span class="nav-text">4，SpringFox 3.0.0 发布</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5%EF%BC%8C%E4%BD%BF%E7%94%A8Swagger3-0"><span class="nav-text">5，使用Swagger3.0</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6%EF%BC%8CSwagger%E5%88%86%E7%BB%84"><span class="nav-text">6，Swagger分组</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7%EF%BC%8C%E6%B5%8B%E8%AF%95%E6%B3%A8%E8%A7%A3"><span class="nav-text">7，测试注解</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#16%EF%BC%8C%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1"><span class="nav-text">16，异步任务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#17%EF%BC%8C%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%EF%BC%8C%E9%82%AE%E4%BB%B6%E5%8F%91%E9%80%81"><span class="nav-text">17，文件上传，邮件发送</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%82%AE%E4%BB%B6%E5%8F%91%E9%80%81"><span class="nav-text">邮件发送</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="nav-text">文件上传</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#18%EF%BC%8C%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="nav-text">18，定时任务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#19%EF%BC%8CDubbo"><span class="nav-text">19，Dubbo</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9E%B6%E6%9E%84"><span class="nav-text">架构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0Dubbo%E5%92%8Czookeeper"><span class="nav-text">实现Dubbo和zookeeper</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#zookeeper"><span class="nav-text">zookeeper</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#dubbo-admin"><span class="nav-text">dubbo-admin</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="nav-text">构建项目</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%9D%E8%80%83"><span class="nav-text">思考</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#20%EF%BC%8C%E8%B7%A8%E5%9F%9F%E8%AF%B7%E6%B1%82%EF%BC%88cors%EF%BC%89"><span class="nav-text">20，跨域请求（cors）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E4%BB%80%E4%B9%88%E6%98%AF%E8%B7%A8%E5%9F%9F%EF%BC%9F"><span class="nav-text">1.什么是跨域？</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#21%EF%BC%8C%E7%B3%BB%E7%BB%9F%E5%90%AF%E5%8A%A8%E4%BB%BB%E5%8A%A1"><span class="nav-text">21，系统启动任务</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#CommandLineRunner"><span class="nav-text">CommandLineRunner</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ApplicationRunner"><span class="nav-text">ApplicationRunner</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#22%EF%BC%8CSpringBoot%E2%80%94Aop"><span class="nav-text">22，SpringBoot—Aop</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#JoinPoint-%E5%AF%B9%E8%B1%A1"><span class="nav-text">JoinPoint 对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ProceedingJoinPoint%E5%AF%B9%E8%B1%A1"><span class="nav-text">ProceedingJoinPoint对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%BC%E5%85%A5aop%E4%BE%9D%E8%B5%96"><span class="nav-text">导入aop依赖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%87%E9%9D%A2%E7%B1%BB"><span class="nav-text">自定义切面类</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#23%EF%BC%8C%E6%95%B4%E5%90%88Redis"><span class="nav-text">23，整合Redis</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Linux%E5%AE%89%E8%A3%85redis"><span class="nav-text">Linux安装redis</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5"><span class="nav-text">远程连接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B4%E5%90%88redis"><span class="nav-text">整合redis</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#24%EF%BC%8CLinux%E5%AE%89%E8%A3%85Nginx"><span class="nav-text">24，Linux安装Nginx</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#25%EF%BC%8CSession%E5%85%B1%E4%BA%AB"><span class="nav-text">25，Session共享</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Nginx%E8%BF%9B%E8%A1%8C%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="nav-text">使用Nginx进行负载均衡</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#26%EF%BC%8CSpringBoot%E9%9B%86%E6%88%90RabbitMQ"><span class="nav-text">26，SpringBoot集成RabbitMQ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B-2"><span class="nav-text">简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8"><span class="nav-text">安装和使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%A4%E6%8D%A2%E6%9C%BA%E6%A8%A1%E5%BC%8F"><span class="nav-text">交换机模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Direct-Exchange"><span class="nav-text">Direct Exchange</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Fanout-Exchange"><span class="nav-text">Fanout Exchange</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Topic-Exchange"><span class="nav-text">Topic Exchange</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SpringBoot%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF"><span class="nav-text">SpringBoot配置信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="nav-text">代码实现</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%B4%E8%BF%9E%E4%BA%A4%E6%8D%A2%E6%9C%BA%E6%A8%A1%E5%BC%8F%EF%BC%88Direct-Exchange%EF%BC%89"><span class="nav-text">直连交换机模式（Direct Exchange）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%89%87%E5%BD%A2%E4%BA%A4%E6%8D%A2%E6%9C%BA%EF%BC%88Fanout-Exchange%EF%BC%89"><span class="nav-text">扇形交换机（Fanout Exchange）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%BB%E9%A2%98%E4%BA%A4%E6%8D%A2%E6%9C%BA-Topic-Exchange"><span class="nav-text">主题交换机(Topic Exchange)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SpringSecurity"><span class="nav-text">SpringSecurity</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%92%E8%89%B2%E7%BB%A7%E6%89%BF"><span class="nav-text">角色继承</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Security%E5%8A%A8%E6%80%81%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86"><span class="nav-text">Security动态权限管理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Security-JSON%E7%99%BB%E5%BD%95"><span class="nav-text">Security  JSON登录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Security%E6%95%B4%E5%90%88WebSocket"><span class="nav-text">Security整合WebSocket</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8A%A5%E9%94%99"><span class="nav-text">报错</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#There-is-no-PasswordEncoder-mapped-for-the-id-%E2%80%9Cnull%E2%80%9D"><span class="nav-text">There is no PasswordEncoder mapped for the id “null”</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="xpp011"
      src="/images/tx.png">
  <p class="site-author-name" itemprop="name">xpp011</p>
  <div class="site-description" itemprop="description">欢迎来到我的博客，希望你能在这里找到有用的东西</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">5</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/xpp011" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;xpp011" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:xpp011.com@gmail.com" title="E-Mail → mailto:xpp011.com@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="tencent://AddContact/?fromId=45&fromSubId=1&subcmd=all&uin=2500176776&website=www.oicqzone.com" title="QQ → tencent:&#x2F;&#x2F;AddContact&#x2F;?fromId&#x3D;45&amp;fromSubId&#x3D;1&amp;subcmd&#x3D;all&amp;uin&#x3D;2500176776&amp;website&#x3D;www.oicqzone.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-qq"></i>QQ</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        
  <div class="beian"><a href="http://beian.miit.gov.cn/" rel="noopener" target="_blank">沪ICP备2020031160号 </a>
      <img src="http://www.beian.gov.cn/portal/download" style="display: inline-block;">
  </div>

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">xpp011</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    <span title="站点总字数">280k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">4:14</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> & <a href="/" class="theme-link">本人舔着脸皮</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'eVNijxVeOcgiNTyd7VSPh2gf-9Nh9j0Va',
      appKey     : 'Hw6LYhLKzYKiM1S4mmWuJpg4',
      placeholder: "吐槽点什么吧,如果你想被回复时得到邮件通知就把邮箱地址填上吧^_^。",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>

<script type="text/javascript" src="/js/background.js"></script>
</html>
